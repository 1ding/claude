# 恢复中断的编写/修订任务

从计划文件恢复上次中断的编写或修订任务，跳过阶段零，按需加载。

## 适用场景

-   上次编写/修订因容量不足中断，需要继续
-   上次会话结束时有未完成的计划文件
-   从交接文件恢复工作上下文

## 输入

$ARGUMENTS

用户须指定计划文件路径，如：
-   "请按 plans/编写计划_03-领域设计.md 继续"
-   "请按 plans/修订计划_05-详细需求.md 继续"

## 先决条件检查

**在执行任何步骤前，先完成以下检查：**

确认 $ARGUMENTS 中包含计划文件路径（含 `编写计划_` 或 `修订计划_` 关键词）。

如未指定，输出以下提示并**立即中止**：

> ⚠️ 请指定计划文件路径，例如：
> `/doc-resume plans/编写计划_03-领域设计.md`

## 执行步骤

### 1. 读取计划文件

-   读取用户指定的计划文件（`plans/编写计划_*.md` 或 `plans/修订计划_*.md`）
-   识别任务类型：编写 or 修订
-   提取进度信息：已完成项、剩余项、当前批次

### 2. 读取交接文件（如有）

-   检查 `plans/` 下是否存在对应的交接文件（`plans/交接_{文档名}_*.md`）
-   如有，读取交接文件获取：决策记录、开放问题、生效假设、断点位置

### 3. 按需加载

恢复模式下自动加载必要文件（`.claude/rules/version-management.md` 由 Claude Code 自动加载，无需重复读取）：

| 加载项                                 | 条件                                                           |
| -------------------------------------- | -------------------------------------------------------------- |
| drafts/ 中的工作文档                   | 始终加载（计划中记录的最新版本）                               |
| decisions.md                           | 始终加载                                                       |
| `.claude/rules-ext/capacity-management.md`   | 始终加载                                                       |
| `.claude/rules-ext/structure-constraints.md` | 始终加载                                                       |
| 规范文件                               | 仅当剩余项涉及规范检查时加载（从会话历史或计划文件中识别路径） |
| 关联文档                               | 仅当剩余项涉及一致性驱动或版本升级驱动时加载                   |
| `.claude/rules-ext/quality-checklist.md`     | 仅最后一批或汇总阶段加载                                       |

> 提示：如在执行 /doc-resume 前已通过 /load-* 加载了规范或关联文档，直接使用会话中已有内容，无需重复加载。

### 4. 输出恢复确认

```
---恢复确认---

计划文件：{文件名}
任务类型：{编写/修订}
总进度：已完成 M/N 项（第 X 批 / 共 Y 批）
关键基准变更：已理解 X 条
下一批：第 X+1 批，处理项 {列出}
策略：{从计划文件读取}
剩余：X 项

已加载文件：
- {列出实际加载的文件}

即将执行第 X+1 批，是否继续？
```

### 5. 继续执行

-   收到确认后，按 `/doc-write` 或 `/doc-revise` 定义的批次流程继续执行
-   遵循计划文件中记录的基准变更（硬约束）
-   每批完成后更新计划文件

## 与 /doc-write、/doc-revise 的关系

-   `/doc-write` 和 `/doc-revise` 专注于**新建模式**（从阶段零开始）
-   `/doc-resume` 专注于**恢复模式**（跳过阶段零，从断点继续）
-   恢复模式下不重复执行输入识别、内部准备、方案确认等阶段零步骤
