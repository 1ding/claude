# 生成会话纪要

将当前会话的讨论、决策和上下文压缩为结构化纪要文件，用于迁移到新会话继续工作。

## 适用场景

-   会话容量紧张（`/cap-status` 显示 ⚠️ 或 🔴），需要迁移到新会话
-   阶段性工作完成，需要留存决策记录
-   多轮讨论后需要整理共识

## 不适用场景

-   恢复上次中断的**文档编写/修订任务** → `/doc-resume`（从计划文件恢复，更精确）
-   当前会话已完全无法响应（必须在会话还能响应时执行）

## 输入

$ARGUMENTS

可选参数：
-   **输出路径**：指定纪要文件保存位置，默认为 `sessions/纪要_{时间戳}.md`
-   **重点范围**：如 "重点记录文档决策" / "只记录开放问题"（不指定则全面记录）

## 执行步骤

### 1. 扫描会话上下文

从当前会话历史中提取：

**已加载文档**：
-   扫描所有 `[LOADED *]` 记录，列出文档路径、类型、加载顺序

**当前工作目标**：
-   识别用户在本次会话开始时的任务说明或目标
-   识别当前正在处理的文档/任务

**已完成工作**：
-   本次会话中已执行的 skill（`/doc-write`、`/doc-revise` 等）
-   已完成的修订批次（从计划文件更新记录识别）
-   已生成或修改的文件

**决策记录**：
-   用户明确确认的方案选择
-   被否定的方案及原因
-   规范解读或术语约定

**开放问题**：
-   用户提出但尚未解决的问题
-   AI 提出的待确认事项
-   当前会话中的分歧或存疑点

**下一步**：
-   当前任务的剩余工作
-   用户提及的后续计划

### 2. 生成纪要文件

创建纪要文件，保存到 `sessions/` 目录（如不存在则创建）。

文件命名：`纪要_{YYYYMMDD_HHmm}.md`（或用户指定路径）

文件内容结构：

```markdown
# 会话纪要

**生成时间**：{YYYY-MM-DD HH:mm}
**会话主题**：{一句话概括本次会话的核心任务}

---

## 上下文：已加载文档

| 类型 | 文件路径 | 说明 |
| ---- | -------- | ---- |
| target | ... | 目标文档（当前正在编写/修订） |
| spec | ... | 约束规范 |
| ... | ... | ... |

---

## 当前进度

**任务**：{当前任务描述}
**状态**：{已完成 X / 共 Y 步；或文字描述}
**断点**：{当前停在哪里，下一步要做什么}

---

## 决策记录

| 议题 | 决策 | 备注 |
| ---- | ---- | ---- |
| {议题描述} | {达成的决策} | {原因/约束} |

---

## 开放问题

-   [ ] {问题1}（提出人：用户/AI）
-   [ ] {问题2}

---

## 下一步

1.  {具体的下一步操作}
2.  {后续计划}

---

## 新会话启动指引

> 将此纪要发送给新会话，并附加以下指令：

```
请阅读以下会话纪要，理解当前工作背景，然后按照"下一步"继续：

{粘贴本文件内容}

[在此补充新的指令]
```

**需要重新加载的文件**（按顺序执行）：
{列出 /load-* 命令，按原来加载顺序排列}
```

### 3. 输出确认

```
---纪要已生成---

文件：{文件路径}
会话主题：{主题}
记录内容：已加载文档 X 个 / 决策 X 条 / 开放问题 X 条
下一步：{列出}

迁移方式：
1. 开启新会话
2. 将纪要文件内容粘贴到新会话开头
3. 按纪要中的"需要重新加载的文件"依次执行 /load-* 命令
4. 继续工作
```

## 注意

-   纪要是对会话历史的**压缩重建**，不保证完整性，关键决策应在生成后由用户确认
-   如当前会话有计划文件（`plans/编写计划_*.md` 或 `plans/修订计划_*.md`），新会话应优先使用 `/doc-resume` 恢复，纪要作为补充上下文
-   本 skill 消耗上下文较少，**容量紧张时仍可执行**
