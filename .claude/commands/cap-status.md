# 查看当前会话容量状态

估算当前会话的上下文使用情况，判断是否还有空间继续加载或执行复杂任务。

## 用法

```
/cap-status
```

无参数。

## 执行步骤

1.   扫描会话历史中所有 `[LOADED *]` 记录，汇总已加载文件的估算 tokens
2.   估算会话固定开销（系统 prompt、对话历史、工具调用记录）：
-   基础固定开销：~6,500 tokens（系统 prompt ~4K + version-management.md ~2K + claude.md ~0.5K）
-   辅助规范开销：~4.5K tokens（若会话中已执行 /doc-write、/doc-revise 或 /doc-resume，否则为 0）
-   每轮对话额外累计：~500 tokens/轮（轻量交互适用；执行 /doc-write 或 /doc-revise 时，每批实际约消耗 3,000–8,000 tokens，此处估算会系统性偏低，建议以输出侧计划文件的进度为容量参考）
-   当前会话轮数估算：根据消息数量推算
3.   输出容量报告：

```
会话容量状态
─────────────────────────────────────────────
项目                           估算 tokens
已加载文档（/load-* 合计）     ~60,130
辅助规范（doc-write/revise）   ~4,500（已执行则计入，否则为 0）
固定开销（系统+对话记录）      ~12,000
─────────────────────────────────────────────
总计使用估算                   ~75,630
─────────────────────────────────────────────
基准容量：200K tokens（~75,630 / 200,000 = 38%）

状态：✅ 容量充裕，可继续加载或执行复杂任务
```

容量状态判断：
-   < 60%（< 120K）→ ✅ 充裕
-   60%–80%（120K–160K）→ ⚠️ 谨慎，可继续但避免加载大文档
-   > 80%（> 160K）→ 🔴 紧张，建议仅执行必要操作，避免新增大量内容

> 注：实际 token 数以 Anthropic 计量为准，此处为估算值（误差约 ±20%）。
