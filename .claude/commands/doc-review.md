# 文档质量评审

对指定文档执行文档内部的系统性质量检查，输出评审报告。跨文档一致性检查请使用 `/doc-align`。

## 适用场景

-   编写完成后的质量检查
-   修订完成后的验收检查
-   定期质量审查

## 不适用场景（请改用对应 skill）

-   跨文档一致性检查 → `/doc-align`
-   只检查格式问题 → `/doc-fmt`
-   发现问题后需要修订 → `/doc-revise`

## 输入

$ARGUMENTS

用户可指定：
-   **评审范围**（可选）：全文 / 指定章节
-   **评审重点**（可选）：特定检查维度

## 先决条件检查

**在执行任何步骤前，先完成以下检查：**

扫描当前会话历史中的 `[LOADED *]` 记录，确认：
-   [ ] 已存在 `[LOADED target]` 记录（通过 `/load-target` 加载了目标文档）

如未满足，输出以下提示并**立即中止**，不执行后续任何步骤：

> ⚠️ 请先执行 `/load-target /path/to/目标文档` 后再运行本命令
>
> 如需加载规范作为检查基准，还可选择执行 `/load-spec`、`/load-layout` 或 `/load-style`

## 执行步骤

### 1. 确认目标文档与可用约束

-   从会话历史最近一条 `[LOADED target]` 记录获取目标文档
-   扫描会话历史，识别已加载的规范文档（`[LOADED spec]`、`[LOADED layout]`、`[LOADED style]` 等），作为检查基准
-   读取 `.claude/rules-ext/quality-checklist.md`

### 2. 执行质量检查

按质量检查清单中的**文档内部检查维度**逐项检查：

1.   **术语一致性检查** - 全文术语统一性（内部）
2.   **交叉引用一致性检查** - 引用正确性、编号连续性
3.   **数据流一致性检查** - 字段/参数定义内部一致性
4.   **逻辑一致性检查** - 内部逻辑矛盾、流程一致性
5.   **格式一致性检查** - 格式统一性
6.   **显性约束符合性检查** - 已加载规范文档要求的满足程度（无规范时跳过）
7.   **表述清晰度检查** - 歧义、模糊用语
8.   **内容完整性检查** - 编写完成度、信息链完整性
9.   **结构约束检查** - 单章容量、标题层级等
10.   **脚本验证** - 调用验证脚本进行自动化检查：
    ```
.claude/scripts/validate-all.sh {文档路径} {术语表路径（如有）} --schema {对应schema文件（如有）}
    ```
    将脚本输出结果整合到评审报告的对应维度中

### 3. 输出评审报告

```
---评审报告---

目标文档：{文档名}
评审范围：{全文 / 指定章节}
评审日期：{日期}
已加载规范：{列出已加载的规范文件，无则标注"未加载"}

检查结果汇总：
| 检查维度           | 结果   | 问题数 | 说明       |
| ------------------ | ------ | ------ | ---------- |
| 术语一致性         | [OK]   | 0      |            |
| 交叉引用一致性     | [!]    | 2      | 见详情     |
| ...                | ...    | ...    | ...        |

[!!] 严重问题（须立即修正）：
{逐条列出}

[!] 一般问题（建议处理）：
{逐条列出}

总体评价：{一句话结论}

建议后续操作：
- 使用 /doc-fix 处理少量简单问题
- 使用 /doc-revise 处理系统性问题
- 使用 /doc-align 检查跨文档一致性
- 使用 /doc-fmt 处理格式问题
```

## 不执行

-   **不加载**规范文档（使用会话中已加载的规范）
-   **不加载**关联文档（跨文档一致性由 /doc-align 负责）
-   **不执行**容量评估
-   **不执行**修订操作（仅报告，不修改文档）
