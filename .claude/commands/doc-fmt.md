# 格式规范修订

对文档执行格式层面的规范性修订。

## 适用场景

-   文档内容基本完成，需要按规范调整格式
-   表格、标题层级、编号、代码块等格式不统一
-   表述风格不符合规范要求
-   Markdown 排版不规范
-   编写规范中的结构要求未满足

## 不适用场景（请改用对应 skill）

-   内容层面的修订 → `/doc-revise`
-   改一两处格式小问题 → `/doc-fix`
-   跨文档一致性问题 → `/doc-align`

## 输入

$ARGUMENTS

用户可指定：
-   **格式修订范围**（可选）：全文 / 指定章节
-   **重点规范**（可选）：如"重点检查表格格式"、"重点检查标题层级"

## 先决条件检查

**在执行任何步骤前，先完成以下检查：**

扫描当前会话历史中的 `[LOADED *]` 记录，确认：
-   [ ] 已存在 `[LOADED target]` 记录（通过 `/load-target` 加载了目标文档）

如未满足，输出以下提示并**立即中止**，不执行后续任何步骤：

> ⚠️ 请先执行 `/load-target /path/to/目标文档` 后再运行本命令
>
> 建议同时执行 `/load-layout` 以加载格式规范作为检查依据

## 执行步骤

### 1. 确认目标文档与已加载规范

-   从会话历史最近一条 `[LOADED target]` 记录获取目标文档
-   扫描会话历史，识别已加载的格式规范（`[LOADED layout]`、`[LOADED spec]`），作为检查依据
-   如未加载任何格式规范，仅按通用 Markdown 格式规范执行检查（无规范约束来源）

### 2. 执行格式检查

逐项检查以下维度：

| 检查维度 | 来源规范                         | 检查内容                               |
| -------- | -------------------------------- | -------------------------------------- |
| 标题层级 | 已加载的 layout / spec           | 层级是否正确、编号是否连续             |
| 表格格式 | 已加载的 layout                  | 表格是否统一、列宽是否合理             |
| 列表格式 | 已加载的 layout                  | 缩进是否一致、符号是否统一             |
| 代码块   | 已加载的 layout                  | 语言标记是否正确、格式是否统一         |
| 表述风格 | 已加载的 style                   | 用语是否符合风格要求                   |
| 结构要求 | 已加载的 spec（有时）            | 必要章节是否齐全、章节顺序是否符合规范 |

### 3. 输出格式检查报告

```
---格式检查报告---

目标文档：{文档名}
检查范围：{全文 / 指定章节}
参照规范：{已加载的规范文件列表，或"未加载（通用 Markdown 格式检查）"}

检查结果：
| 序号 | 维度     | 位置 | 问题描述             | 严重程度 |
| ---- | -------- | ---- | -------------------- | -------- |
| 1    | 标题层级 | 3.2  | 跳级：二级直接到四级 | [!]      |
| 2    | 表格格式 | 4.1  | 表格缺少表头分隔行   | [!!]     |

总计：[!!] X 项，[!] X 项
```

### 4. 执行修正

```
是否自动修正？
- 回复"修正" → 自动修正所有问题，创建新版本
- 回复"修正 + 序号" → 只修正指定项
- 回复"不修正" → 仅保留报告
```

修正时：
-   按版本管理规范创建新版本
-   在修订记录中标注"格式修订"
-   输出修正结果简报

## 不执行

-   **不加载**关联文档
-   **不执行**容量评估
-   **不执行**内容层面的质量检查（术语、逻辑、数据流等）
