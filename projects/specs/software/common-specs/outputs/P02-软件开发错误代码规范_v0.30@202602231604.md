# 1 适用范围

+   文档编号：P02
+   文档名称：软件开发错误代码规范
+   适用对象：所有后端 RESTful API 的错误响应设计、前端应用的错误拦截与展示逻辑、微服务间调用的错误传递与转换，以及技术文档中的错误码引用与描述
+   管辖范围：错误码编码格式与命名规则、错误码分配与扩展机制、统一错误响应格式、错误处理实现参考
+   不管辖的范围：通用语言写法和用语风格（见《C01-内容表达规范》）、排版格式（见《C02-排版格式规范》）
+   文档密级：【机密】 -- 外发必追责。

# 2 设计原则

+   错误码设计原则

    | 原则     | 说明                                                                      | 反例                                    |
    | -------- | ------------------------------------------------------------------------- | --------------------------------------- |
    | 唯一性   | 每个错误码全局唯一，不同 BC 不得复用同一编号                              | 两个 BC 同时使用 E-4000101 表示不同含义 |
    | 自解释性 | 错误信息面向终端用户，以自然语言描述，不暴露技术实现细节                  | 返回 NullPointerException 给用户        |
    | 可追溯性 | 错误码能关联到具体业务规则或校验逻辑，便于从报错快速定位根因              | 错误码与业务逻辑无对应关系              |
    | 可国际化 | 错误码作为 i18n（即国际化）资源文件的消息 Key，运行时按客户端语言动态加载 | 硬编码中文错误信息                      |
    | 安全性   | 错误响应不得暴露 SQL 语句、堆栈跟踪、内部文件路径、数据库结构             | 返回 SQL syntax error near 'password'   |
    | 稳定性   | 已发布错误码不得变更含义或删除，只可废弃并标注替代方案                    | 静默修改已上线错误码的 HTTP 状态码      |
    | 最小化   | 仅在前端需差异化处理或业务确需细分时新增，避免过度拆分                    | 为同一校验的不同字段各创建独立错误码    |

# 3 错误码编码体系

## 3.1 编码格式

+   错误码采用 `E-XXXBBSS` 格式，由固定前缀和 7 位数字组成

    ```text
    E-XXXBBSS
    |  |  | |
    |  |  | +-- SS：错误序号（01-99），BC 内自增
    |  |  +---- BB：BC 编码（00=通用，01-99=各 BC）
    |  +------- XXX：HTTP 状态码（400/401/403/404/409/422/429/500/503）
    +---------- E-：错误码固定前缀
    ```

+   编码规则
    -   BB=00 为通用错误码，由平台统一定义，所有 BC 直接复用，不得重复定义。通用错误码的完整定义见第 4 章
    -   BB=01~99 为各 BC（限界上下文）专属错误码，由各 BC 在本编码段内自行管理
    -   SS 从 01 开始自增，每个 BC 在每个 HTTP 状态码下最多定义 99 个错误码

+   各编码段的解读示例如下

    | 错误码    | 解读                                            |
    | --------- | ----------------------------------------------- |
    | E-4000001 | 400 类 / 通用（BB=00）/ 第 01 号 → 参数校验失败 |
    | E-4010002 | 401 类 / 通用（BB=00）/ 第 02 号 → Token 过期   |
    | E-4000301 | 400 类 / BC03 / 第 01 号 → BC03 的首个 400 错误 |
    | E-5000501 | 500 类 / BC05 / 第 01 号 → BC05 的首个 500 错误 |

## 3.2 HTTP 状态码映射

+   错误码的 XXX 段应严格对应实际返回的 HTTP 状态码

    | HTTP 状态码 | 语义                  | 适用场景                                         |
    | ----------- | --------------------- | ------------------------------------------------ |
    | 400         | Bad Request           | 请求格式错误、参数缺失、类型不匹配、格式校验失败 |
    | 401         | Unauthorized          | 未认证、Token 无效或过期、账户被禁用             |
    | 403         | Forbidden             | 已认证但无操作权限、跨租户访问被拒绝             |
    | 404         | Not Found             | 请求的资源不存在或已被删除                       |
    | 409         | Conflict              | 数据冲突、乐观锁冲突、唯一约束冲突、重复提交     |
    | 422         | Unprocessable Entity  | 请求格式合法但业务逻辑不允许执行                 |
    | 429         | Too Many Requests     | 请求频率超过限流阈值                             |
    | 500         | Internal Server Error | 未预期的系统异常、未分类的运行时错误             |
    | 503         | Service Unavailable   | 服务暂时不可用、依赖服务不可达、维护模式         |

+   400 与 422 的区分标准：400 用于请求本身格式或参数不合法（如必填字段为空、邮箱格式错误）；422 用于请求合法但因业务规则限制无法处理（如余额不足、状态不允许操作）。

## 3.3 枚举命名规则

+   每个错误码应同时定义英文枚举名称（Enum Name），用于代码中的常量引用

    | 规则 | 说明                                     | 正确示例                 | 错误示例                           |
    | ---- | ---------------------------------------- | ------------------------ | ---------------------------------- |
    | 大写 | 全大写，单词间下划线分隔                 | TOKEN_EXPIRED            | tokenExpired                       |
    | 语义 | 名称准确反映错误原因，具备自解释性       | FILE_SIZE_EXCEEDED       | ERROR_01                           |
    | 前缀 | 不添加冗余前缀（错误码本身已含类型信息） | PARAM_INVALID            | ERR_PARAM_INVALID                  |
    | 长度 | 宜不超过 40 个字符                       | OPTIMISTIC_LOCK_CONFLICT | THE_DATA_HAS_ALREADY_BEEN_MODIFIED |

## 3.4 BC 专属错误码分配（BB=01~99）

+   每个 BC（限界上下文）拥有固定的 BB 编码（01-99），无需额外计算号段。错误码中的 BB 段直接等于《P01-软件开发编号规范》中该 BC 短号的数字部分（如 BC01- 的 BB 值为 01）。

+   BC 编码分配示例（以下 BC 名称仅为格式示意，实际 BC 编码及名称以《P01-软件开发编号规范》中的 BC 定义表为准）

    | BC 编码 | BC 名称（示意） | BB 值 | 400 类错误码示例      | 422 类错误码示例      |
    | ------- | --------------- | ----- | --------------------- | --------------------- |
    | BC01-   | 认证            | 01    | E-4000101 ~ E-4000199 | E-4220101 ~ E-4220199 |
    | BC02    | 用户资料        | 02    | E-4000201 ~ E-4000299 | E-4220201 ~ E-4220299 |
    | BC03    | 权限            | 03    | E-4000301 ~ E-4000399 | E-4220301 ~ E-4220399 |
    | ...     | ...             | ...   | ...                   | ...                   |
    | BC99    | --              | 99    | E-4009901 ~ E-4009999 | E-4229901 ~ E-4229999 |

+   分配规则
    -   集中管理：BC 编码由架构师或 Tech Lead 统一分配，禁止 BC 自行占用
    -   BC 编码唯一：每个 BC 编码全局唯一且不可变更，BC 废弃后编码不得复用
    -   容量：每个 BC 在每个 HTTP 状态码下可定义 01-99 共 99 个错误码，足够绝大多数业务场景

## 3.5 BB 段扩展方案

+   BB 段默认支持 01~99 共 99 个 BC。若项目 BC 数量超过 99 个，BB 段可扩展为双字母编码（如 aa、ab、…、zz），此时错误码总长度增加至 9 位数字+字母。扩展方案应在项目启动时由架构师评估并统一约定，且应与《P01-软件开发编号规范》中 BC 短号的扩展方案保持一致。

## 3.6 自定义错误码扩展判断

+   当通用错误码无法覆盖业务需求时，允许各 BC 在本 BC 编码段内（BB=本BC编号）自定义错误码。扩展判断标准如下

    | 场景                           | 是否需要新增 | 处理方式                               |
    | ------------------------------ | ------------ | -------------------------------------- |
    | 现有错误码完全匹配当前业务场景 | 否           | 直接复用现有错误码                     |
    | 错误提示信息需要调整           | 否           | 通过参数化消息模板定制（见附录B §B.4） |
    | 新业务规则的校验失败           | 是           | 在 BC 编码段内新增错误码               |
    | 前端需区分处理的细分场景       | 是           | 同类错误需不同 UI 处理时新增           |
    | 相似场景但不同错误原因         | 视情况       | 优先使用 details 字段区分              |

===SPLIT===

# 4 通用错误码定义

+   通用错误码（BB=00）由平台统一定义，所有 BC 直接复用，不得重复定义。

## 4.1 参数校验类（400）

+   参数校验类通用错误码

    | 错误码    | 枚举名称              | HTTP | 错误描述            | 触发条件                                     |
    | --------- | --------------------- | ---- | ------------------- | -------------------------------------------- |
    | E-4000001 | PARAM_INVALID         | 400  | 参数校验失败        | 请求参数不满足校验约束（如 @Valid 注解失败） |
    | E-4000002 | REQUEST_BODY_EMPTY    | 400  | 请求体不能为空      | POST/PUT 请求未携带请求体                    |
    | E-4000003 | PARAM_TYPE_MISMATCH   | 400  | 参数类型错误        | 参数值无法转换为目标类型                     |
    | E-4000004 | PARAM_OUT_OF_RANGE    | 400  | 参数值超出允许范围  | 数值参数超出定义的最小/最大值                |
    | E-4000005 | PARAM_LENGTH_EXCEEDED | 400  | 参数长度超限        | 字符串参数长度超过定义的最大长度             |
    | E-4000006 | DATE_FORMAT_INVALID   | 400  | 日期格式错误        | 日期参数不符合要求的格式（如 ISO 8601）      |
    | E-4000007 | ENUM_VALUE_INVALID    | 400  | 枚举值无效          | 参数值不在允许的枚举值列表中                 |
    | E-4000008 | JSON_FORMAT_INVALID   | 400  | JSON 格式错误       | 请求体不是合法的 JSON                        |
    | E-4000009 | PARAM_REQUIRED        | 400  | 缺少必填参数        | 必填参数未传入或值为空                       |
    | E-4000010 | FILE_TYPE_INVALID     | 400  | 文件类型不支持      | 上传文件 MIME 类型或扩展名不在允许列表中     |
    | E-4000011 | FILE_SIZE_EXCEEDED    | 400  | 文件大小超限        | 上传文件大小超过系统允许的最大值             |
    | E-4000012 | CONTENT_TYPE_INVALID  | 400  | Content-Type 不支持 | 请求头 Content-Type 不在允许的类型列表中     |
    | E-4000013 | CHARSET_UNSUPPORTED   | 400  | 字符编码不支持      | 请求使用了不支持的字符编码                   |
    | E-4000014 | PAGE_PARAM_INVALID    | 400  | 分页参数无效        | 页码 <= 0 或每页数量超出允许范围             |
    | E-4000015 | SORT_PARAM_INVALID    | 400  | 排序参数无效        | 排序字段不存在或排序方向不合法               |

## 4.2 认证类（401）

+   认证类通用错误码

    | 错误码    | 枚举名称              | HTTP | 错误描述         | 触发条件                              |
    | --------- | --------------------- | ---- | ---------------- | ------------------------------------- |
    | E-4010001 | NOT_LOGGED_IN         | 401  | 未登录           | 请求未携带认证凭证（Token / Session） |
    | E-4010002 | TOKEN_EXPIRED         | 401  | Token 已过期     | 访问令牌超过有效期                    |
    | E-4010003 | TOKEN_INVALID         | 401  | Token 格式无效   | Token 签名校验失败或格式不合法        |
    | E-4010004 | ACCOUNT_DISABLED      | 401  | 账户已被禁用     | 用户账户处于禁用或冻结状态            |
    | E-4010005 | CREDENTIALS_INVALID   | 401  | 用户名或密码错误 | 登录时认证信息不匹配                  |
    | E-4010006 | SESSION_EXPIRED       | 401  | 会话已过期       | 服务端会话已失效，需重新登录          |
    | E-4010007 | REFRESH_TOKEN_INVALID | 401  | 刷新令牌无效     | 刷新令牌已过期或已被使用              |

## 4.3 权限类（403）

+   权限类通用错误码

    | 错误码    | 枚举名称              | HTTP | 错误描述             | 触发条件                                 |
    | --------- | --------------------- | ---- | -------------------- | ---------------------------------------- |
    | E-4030001 | PERMISSION_DENIED     | 403  | 无操作权限           | 当前用户不具备该功能的操作权限           |
    | E-4030002 | DATA_ACCESS_DENIED    | 403  | 无数据权限           | 当前用户不具备目标数据的访问权限         |
    | E-4030003 | TENANT_ACCESS_DENIED  | 403  | 跨租户访问被拒绝     | 尝试访问其他租户的数据                   |
    | E-4030004 | IP_BLOCKED            | 403  | IP 访问被限制        | 请求 IP 不在白名单内或处于黑名单中       |
    | E-4030005 | OPERATION_NOT_ALLOWED | 403  | 当前环境不允许此操作 | 操作在当前部署环境（如生产环境）下被禁止 |

## 4.4 资源不存在类（404）

+   资源不存在类通用错误码

    | 错误码    | 枚举名称                   | HTTP | 错误描述       | 触发条件                                   |
    | --------- | -------------------------- | ---- | -------------- | ------------------------------------------ |
    | E-4040001 | RESOURCE_NOT_FOUND         | 404  | 资源不存在     | 按 ID 或唯一标识查询的资源不存在或已被删除 |
    | E-4040002 | RELATED_RESOURCE_NOT_FOUND | 404  | 关联资源不存在 | 主资源存在但其依赖的关联资源不存在         |
    | E-4040003 | API_NOT_FOUND              | 404  | 接口不存在     | 请求的 API 路径未注册                      |

## 4.5 冲突类（409）

+   冲突类通用错误码

    | 错误码    | 枚举名称                 | HTTP | 错误描述     | 触发条件                                         |
    | --------- | ------------------------ | ---- | ------------ | ------------------------------------------------ |
    | E-4090001 | OPTIMISTIC_LOCK_CONFLICT | 409  | 数据已被修改 | 更新时版本号与数据库当前版本不一致（乐观锁冲突） |
    | E-4090002 | DUPLICATE_KEY            | 409  | 数据重复     | 违反唯一约束（如名称、编码已存在）               |
    | E-4090003 | CONCURRENT_CONFLICT      | 409  | 并发操作冲突 | 同一资源被多个请求同时修改                       |
    | E-4090004 | DUPLICATE_SUBMISSION     | 409  | 重复提交     | 相同幂等键在短时间内被多次提交                   |

## 4.6 业务逻辑类（422）

+   业务逻辑类通用错误码

    | 错误码    | 枚举名称                  | HTTP | 错误描述               | 触发条件                                |
    | --------- | ------------------------- | ---- | ---------------------- | --------------------------------------- |
    | E-4220001 | STATUS_TRANSITION_INVALID | 422  | 当前状态不允许此操作   | 资源状态机不允许从当前状态执行目标操作  |
    | E-4220002 | PRECONDITION_NOT_MET      | 422  | 前置条件未满足         | 操作的业务前置条件未达成                |
    | E-4220003 | QUOTA_EXCEEDED            | 422  | 配额已用尽             | 操作所需资源配额不足（如存储/次数配额） |
    | E-4220004 | DEPENDENCY_CONSTRAINT     | 422  | 存在依赖关系，无法操作 | 资源被其他资源引用，无法删除或停用      |

## 4.7 限流类（429）

+   限流类通用错误码

    | 错误码    | 枚举名称            | HTTP | 错误描述       | 触发条件                                |
    | --------- | ------------------- | ---- | -------------- | --------------------------------------- |
    | E-4290001 | RATE_LIMIT_EXCEEDED | 429  | 请求过于频繁   | 请求频率超过限流策略的阈值              |
    | E-4290002 | CONCURRENT_LIMIT    | 429  | 并发请求数超限 | 同一用户/租户的并发请求数超过允许的上限 |

## 4.8 系统错误类（500/503）

+   系统错误类通用错误码

    | 错误码    | 枚举名称                   | HTTP | 错误描述         | 触发条件                         |
    | --------- | -------------------------- | ---- | ---------------- | -------------------------------- |
    | E-5000001 | INTERNAL_ERROR             | 500  | 系统内部错误     | 未预期的运行时异常（兜底错误码） |
    | E-5000002 | DATABASE_ERROR             | 500  | 数据库操作异常   | 数据库连接失败、查询超时、死锁等 |
    | E-5000003 | CACHE_ERROR                | 500  | 缓存服务异常     | Redis 等缓存服务不可用或操作失败 |
    | E-5000004 | MQ_ERROR                   | 500  | 消息队列异常     | 消息发送/消费失败                |
    | E-5000005 | DEPENDENCY_SERVICE_FAILED  | 500  | 依赖服务调用失败 | 调用外部/下游服务返回错误        |
    | E-5000006 | DEPENDENCY_SERVICE_TIMEOUT | 500  | 依赖服务调用超时 | 调用外部/下游服务超过超时阈值    |
    | E-5030001 | SERVICE_UNAVAILABLE        | 503  | 服务暂时不可用   | 系统维护中或服务实例不健康       |
    | E-5030002 | SERVICE_DEGRADED           | 503  | 服务已降级       | 非核心功能因依赖故障被主动降级   |

# 附录A（资料性）统一响应格式

## A.1 成功响应结构

+   成功响应格式

    ```json
    {
      "code": 0,
      "message": "success",
      "data": {},
      "timestamp": 1706000000000
    }
    ```

+   成功响应字段说明

    | 字段      | 类型   | 必有 | 说明                             |
    | --------- | ------ | ---- | -------------------------------- |
    | code      | Number | 是   | 业务状态码，0 表示成功           |
    | message   | String | 是   | 状态描述，成功时固定为 "success" |
    | data      | Object | 是   | 响应数据，无数据时为 null 或 {}  |
    | timestamp | Number | 是   | 服务端响应时间戳（Unix 毫秒）    |

+   分页数据的 data 结构

    ```json
    {
      "list": [],
      "total": 100,
      "pageNum": 1,
      "pageSize": 20
    }
    ```

## A.2 错误响应结构

+   错误响应格式

    ```json
    {
      "code": 4000001,
      "message": "参数校验失败",
      "data": {},
      "timestamp": 1706000000000,
      "traceId": "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
    }
    ```

+   错误响应字段说明

    | 字段      | 类型   | 必有 | 说明                                                                                    |
    | --------- | ------ | ---- | --------------------------------------------------------------------------------------- |
    | code      | Number | 是   | 错误码数字部分（去掉 E- 前缀），前端通过 E-${code} 拼接为 i18n Key                      |
    | message   | String | 是   | 面向用户的错误提示信息                                                                  |
    | data      | Object | 否   | 错误详情，帮助定位问题，详见 §A.3                                                       |
    | timestamp | Number | 是   | 错误发生时间戳（Unix 毫秒）                                                             |
    | traceId   | String | 是   | 分布式链路追踪 ID，由网关或 APM（即应用性能管理）框架生成，格式为 UUID 或 32 位十六进制 |

## A.3 错误详情字段

+   data 字段为可选的错误详情对象，根据错误类型携带不同辅助信息

    | 字段           | 类型   | 适用场景       | 说明                     |
    | -------------- | ------ | -------------- | ------------------------ |
    | field          | String | 参数校验错误   | 出错的字段名称           |
    | value          | Any    | 参数校验错误   | 出错的字段实际值         |
    | suggestion     | String | 通用           | 建议的解决方案或修正指引 |
    | details        | Array  | 多字段校验错误 | 多个校验错误的详情列表   |
    | allowedValues  | Array  | 枚举值错误     | 允许的枚举值列表         |
    | min / max      | Number | 范围/长度错误  | 允许的最小/最大值        |
    | retryAfter     | Number | 限流错误       | 建议的重试等待秒数       |
    | currentVersion | Number | 乐观锁冲突     | 当前数据的版本号         |

## A.4 响应示例

+   单字段校验错误

    ```json
    {
      "code": 4000005,
      "message": "参数长度超限",
      "data": {
        "field": "name",
        "value": "这是一段超长文本...",
        "max": 100,
        "suggestion": "请将名称缩减至 100 个字符以内"
      },
      "timestamp": 1706000000000,
      "traceId": "trace-abc-001"
    }
    ```

+   多字段校验错误

    ```json
    {
      "code": 4000001,
      "message": "参数校验失败",
      "data": {
        "details": [
          { "field": "email", "message": "邮箱格式错误" },
          { "field": "phone", "message": "手机号不能为空" }
        ]
      },
      "timestamp": 1706000000000,
      "traceId": "trace-abc-002"
    }
    ```

+   乐观锁冲突

    ```json
    {
      "code": 4090001,
      "message": "数据已被修改，请刷新后重试",
      "data": {
        "currentVersion": 5,
        "suggestion": "请刷新页面获取最新数据后重新提交"
      },
      "timestamp": 1706000000000,
      "traceId": "trace-abc-003"
    }
    ```

+   限流错误

    ```json
    {
      "code": 4290001,
      "message": "请求过于频繁，请稍后重试",
      "data": {
        "retryAfter": 30
      },
      "timestamp": 1706000000000,
      "traceId": "trace-abc-004"
    }
    ```

# 附录B（资料性）错误处理实现参考

+   本附录提供后端异常处理、前端错误拦截、国际化支持的实现参考。

## B.1 后端异常分层与处理

+   异常按以下层次处理

    ```text
    Controller 层      -> 参数校验异常（400）
         |
    Application 层     -> 业务逻辑异常（409/422）
         |
    Domain 层          -> 领域规则异常（422）
         |
    Infrastructure 层  -> 系统/依赖异常（500/503）
         |
    全局异常处理器      -> 兜底处理，统一封装响应格式
    ```

+   统一异常基类：定义 BusinessException 基类，携带错误码、HTTP 状态码和消息模板参数。所有业务异常应继承此基类。
+   全局异常处理器：通过 @RestControllerAdvice（Spring）或等效机制拦截所有异常，统一封装为附录A定义的响应格式。
+   异常转换规则

    | 框架异常类                        | 映射错误码 |
    | --------------------------------- | ---------- |
    | MethodArgumentNotValidException   | E-4000001  |
    | HttpMessageNotReadableException   | E-4000008  |
    | AccessDeniedException             | E-4030001  |
    | OptimisticLockingFailureException | E-4090001  |
    | 未匹配的 RuntimeException         | E-5000001  |

+   信息安全：生产环境下，500 类错误的 message 字段应返回通用提示（如"系统内部错误，请联系管理员"），原始异常信息仅写入日志。
+   错误码传递：微服务间调用时，下游错误码不应直接透传给终端用户，上游服务应根据上下文进行转换或包装。

## B.2 前端处理策略

+   前端按 HTTP 状态码分类处理错误响应（各状态码的语义定义见 §3.2）

    | HTTP 状态码 | 处理策略                                                  |
    | ----------- | --------------------------------------------------------- |
    | 400         | 显示 message 内容；若 data.details 存在，逐字段高亮并提示 |
    | 401         | 清除本地凭证，跳转登录页；可先尝试刷新 Token              |
    | 403         | 显示无权限提示，隐藏或禁用对应操作按钮                    |
    | 404         | 显示"资源不存在"提示，提供返回列表页或首页的导航          |
    | 409         | 显示冲突提示，引导用户刷新页面获取最新数据                |
    | 422         | 显示 message 中的业务错误信息，引导用户修正操作           |
    | 429         | 显示限流提示，根据 data.retryAfter 展示倒计时后自动重试   |
    | 500/503     | 显示"系统繁忙，请稍后重试"通用提示，提供重试按钮          |

## B.3 代码实现示例

+   Java 错误码枚举类示例（仅展示结构模式，完整枚举值对照第 4 章错误码表生成）

    ```java
    public enum ErrorCode {

        // ===== 参数校验类（400，BB=00）示例 =====
        PARAM_INVALID("E-4000001", 400, "参数校验失败"),
        PARAM_REQUIRED("E-4000009", 400, "缺少必填参数"),

        // ===== 认证类（401，BB=00）示例 =====
        TOKEN_EXPIRED("E-4010002", 401, "Token 已过期"),

        // ===== 系统错误类（500/503，BB=00）示例 =====
        INTERNAL_ERROR("E-5000001", 500, "系统内部错误"),
        SERVICE_UNAVAILABLE("E-5030001", 503, "服务暂时不可用");

        // ... 完整枚举值对照第 4 章通用错误码定义表生成，此处省略

        private final String code;
        private final int httpStatus;
        private final String message;

        ErrorCode(String code, int httpStatus, String message) {
            this.code = code;
            this.httpStatus = httpStatus;
            this.message = message;
        }

        public String getCode() { return code; }
        public int getHttpStatus() { return httpStatus; }
        public String getMessage() { return message; }

        /** 获取错误码的数字部分（用于响应体的 code 字段） */
        public int getNumericCode() {
            return Integer.parseInt(code.replace("E-", ""));
        }
    }
    ```

+   Java 业务异常基类示例

    ```java
    public class BusinessException extends RuntimeException {

        private final ErrorCode errorCode;
        private final Map<String, Object> data;

        public BusinessException(ErrorCode errorCode) {
            super(errorCode.getMessage());
            this.errorCode = errorCode;
            this.data = Collections.emptyMap();
        }

        public BusinessException(ErrorCode errorCode, Map<String, Object> data) {
            super(errorCode.getMessage());
            this.errorCode = errorCode;
            this.data = data;
        }

        public ErrorCode getErrorCode() { return errorCode; }
        public Map<String, Object> getData() { return data; }
    }
    ```

+   JavaScript 错误响应拦截示例

    ```javascript
    function handleErrorResponse(response) {
      const { code, message, data } = response.data;
      const errorKey = `E-${code}`;  // 拼接为 i18n Key

      switch (response.status) {
        case 401:
          clearAuth();
          redirectToLogin();
          break;
        case 429:
          showRetryCountdown(data?.retryAfter || 30);
          break;
        default:
          showErrorNotification(i18n.t(errorKey) || message);
      }
    }
    ```

## B.4 国际化支持

+   错误码作为国际化（即 i18n）消息 Key，运行时根据客户端 Accept-Language 请求头从资源文件中加载对应语言的错误提示。
+   加载优先级
    -   客户端请求头指定的语言（如 Accept-Language: en-US）
    -   用户账户配置的偏好语言
    -   系统默认语言（如 zh-CN）

+   资源文件以错误码为 Key，按语言分别维护

    ```properties
    # error_messages_zh_CN.properties
    E-4000001=参数校验失败
    E-4000005=参数长度超限，最大允许 {max} 个字符
    E-4010002=登录已过期，请重新登录
    E-4090001=数据已被其他用户修改，请刷新后重试
    E-5000001=系统繁忙，请稍后重试

    # error_messages_en_US.properties
    E-4000001=Parameter validation failed
    E-4000005=Parameter length exceeded, maximum {max} characters allowed
    E-4010002=Session expired, please log in again
    E-4090001=Data has been modified by another user, please refresh and retry
    E-5000001=System is busy, please try again later
    ```

+   错误消息支持参数占位符，运行时动态替换

    | 占位符    | 说明         | 示例                                              |
    | --------- | ------------ | ------------------------------------------------- |
    | {field}   | 字段名称     | 字段 {field} 不能为空 -> 字段 email 不能为空      |
    | {max}     | 最大值       | 最大允许 {max} 个字符 -> 最大允许 100 个字符      |
    | {min}     | 最小值       | 最小值为 {min} -> 最小值为 1                      |
    | {value}   | 实际值       | 不支持的格式：{value} -> 不支持的格式：xlsx       |
    | {allowed} | 允许的值列表 | 允许值为 {allowed} -> 允许值为 [ACTIVE, INACTIVE] |

## B.5 日志与链路追踪

+   日志级别规则
    -   400/422 类错误 -> WARN 级别，包含错误码、请求参数摘要、用户 ID
    -   401/403 类错误 -> WARN 级别，包含错误码、请求 IP、用户 ID、目标资源
    -   409 类错误 -> WARN 级别，包含错误码、资源 ID、版本号冲突详情
    -   500/503 类错误 -> ERROR 级别，包含错误码、完整异常堆栈、请求上下文
+   日志格式

    ```text
    [{timestamp}] [{level}] [{traceId}] [{errorCode}] [{userId}] {message}
    ```

+   链路追踪集成
    -   每个请求应在入口（网关或第一个接收请求的服务）生成 traceId（即分布式链路追踪 ID），并在所有下游调用中传递
    -   错误响应的 traceId 字段使用此值，确保用户反馈的错误可通过 traceId 在 APM 系统中检索完整调用链

# 附录C（资料性）API 契约集成指南

+   本附录提供错误码与 API 契约文档的集成方法。

## C.1 契约表关联方式

+   每个 API 的契约概述表应通过"关联错误码"字段引用本规范中定义的错误码，避免在各 API 文档中重复维护错误码定义。
+   API 契约概述表的格式示例如下（API编号格式参见《P01-软件开发编号规范》）

    | 属性       | 值                                         |
    | ---------- | ------------------------------------------ |
    | API 编号   | API-USER-user-create (API001)              |
    | 接口路径   | POST /api/v1/users                         |
    | 功能简述   | 创建用户账户                               |
    | 所需权限   | user:manage:create                         |
    | 幂等性     | 否（每次创建新用户）                       |
    | 关联错误码 | E-4000001, E-4000009, E-4090002, E-5000001 |

## C.2 开发人员工作流

+   设计新接口时的错误码使用流程
    -   查阅通用错误码表（第 4 章）和本 BC 已有错误码，确定可复用的错误码
    -   在 API 契约概述表的"关联错误码"字段列出该接口所有可能返回的错误码
    -   如需新增错误码，在本 BC 编码段内选取下一个可用 SS 序号并在全局错误码表中注册
    -   前端开发人员根据契约表中的关联错误码实现对应的错误处理逻辑
    -   宜维护错误码到 API 的反向索引，以便评估错误码变更的影响范围

# 附录D（资料性）术语约定

+   本规范使用的通用术语已在《C99-天帷通用术语规范》中统一定义，具体定义参见该文档。
+   本规范无专有术语。

# 附录E（资料性）参考标准

+   本规范参考了以下业界标准
    -   RFC 9110 -- HTTP Semantics（HTTP 状态码权威定义）
    -   RFC 9457 -- Problem Details for HTTP APIs（HTTP API 问题详情标准）
    -   Microsoft REST API Guidelines -- Error Handling
    -   Google Cloud API Design Guide -- Errors

# 附录F（资料性）关联规范

+   本规范与以下规范存在关联关系：
    +   上位规范：《N00-软件研发过程规范》——本规范中的限界上下文（BC）概念及其生命周期阶段应与《N00-软件研发过程规范》中定义的研发阶段保持一致
    +   平级规范：《C99-天帷通用术语规范》——本规范引用的通用术语统一在术语规范中定义
    +   平级规范：《P01-软件开发编号规范》——本规范中 BC 编码（BB值）等于编号规范中该 BC 短号的数字部分（如 BC01- 的 BB 值为 01）；BB 段扩展方案与编号规范中 BC 短号的扩展方案保持一致（详见 §3.5）
    +   通用规范：《C01-内容表达规范》《C02-排版格式规范》——本规范的语言写法和排版格式要求

# 修订记录

| 标记 | 日期       | 修订内容                                                                            | 修订人 |
| ---- | ---------- | ----------------------------------------------------------------------------------- | ------ |
| 0.30 | 2026-02-23 | 面向AI用途重构：正文精简为4章（编码体系+错误码定义）                                | 丁劲松 |
|      |            | 删除：原§5审批流程与编码约束、原§8治理与维护、原附录A登记模板（纯人工流程）         |        |
|      |            | 降为附录：原§6统一响应格式→附录A、原§7错误处理+§9国际化+原附录B→合并为附录B实现参考 |        |
|      |            | 原§5.1扩展判断标准并入§3.6；全文交叉引用规范化；消除5类信息重复                     |        |
| 0.20 | 2026-02-23 | 按C01/C02/M01规范全面改造；重写总则；统一附录标题格式                               | 丁劲松 |
|      |            | 合并关联规范到总则；修正修订记录格式                                                |        |
|      |            | 修正表格说明句式；全文符号和缩进修正；缩略词内联定义；BB扩展描述去重                |        |
| 0.10 | 2026-02-21 | 初始版本                                                                            | 丁劲松 |
