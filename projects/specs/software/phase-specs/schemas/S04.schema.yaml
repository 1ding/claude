# S04 系统设计编写规范 — 编写规则 Schema
# 来源规范：specs/software/meta/S04-系统设计编写规范_v0.10@202602252051.md
# 用途：AI 内容编写阶段加载此 schema（替代完整规范），提供章节结构、内容模型和编写约束
# 完整规则（章节目的详述、完整示例、裁剪依据详述）：见原规范文件

doc_id: S04
doc_name: 系统设计编写规范
target_doc: "04-系统设计"
target_doc_name: 系统设计文档

# ── 文档定位 ──
positioning:
  stage: 4
  stage_name: 系统设计
  upstream: [阶段3-领域设计, 阶段2-宏观需求, 阶段1-产品战略]
  downstream: [阶段5-BC详细需求]
  role: "从系统全局视角完成架构设计，将Enabler Epic分解为Enabler Capability和Feature，形成架构需求清单。是所有下游BC级文档的全局约束来源"

# ── 上游输入 ──
upstream_inputs:
  - { item: "子域清单（含分类）", source: "阶段3 领域设计", note: "含子域投资策略" }
  - { item: "BC清单", source: "阶段3 领域设计", note: "含职责定义、边界描述、核心聚合" }
  - { item: "上下文映射图", source: "阶段3 领域设计", note: "含映射模式和集成策略" }
  - { item: "领域事件全景", source: "阶段3 领域设计", note: "含事件清单和流转图" }
  - { item: "统一语言词汇表", source: "阶段3 领域设计" }
  - { item: "核心领域模型概要", source: "阶段3 领域设计", note: "聚合级" }
  - { item: "Enabler Epic清单", source: "阶段3 领域设计", note: "含与Business Epic追溯关系" }
  - { item: "架构约束传递清单", source: "阶段3 领域设计", note: "向阶段4传递的约束" }
  - { item: "Business Epic清单", source: "阶段2 宏观需求", note: "含能力架构和版本分配" }
  - { item: "非功能需求框架", source: "阶段2 宏观需求", note: "全局级基线目标" }
  - { item: "版本路线图", source: "阶段1 产品战略" }
  - { item: "技术约束与现有架构资产", source: "外部输入" }
missing_input_handling: "缺失内容记录为假设（AS-*），标注'来源：阶段N输出缺失'"

# ── 全局硬约束 ──
hard_constraints:
  - "禁止循环依赖"
  - "禁止跨BC分布式事务（2PC/XA）"
  - "外部系统集成应通过ACL隔离"
  - "上游模型变更时下游应通过ACL隔离"
  - "默认1:1:1映射（BC:微服务:数据库），偏离须记录决策"
  - "技术栈在系统设计中统一决策，各BC不应自行引入未列出的技术依赖"
  - "非功能约束各BC可设更严格的本地目标但不得放宽全局基线"
  - "消息信封强制字段：eventId/eventType/eventVersion/occurredOn/source/aggregateId/aggregateType/payload"

# ── 裁剪指引 ──
tailoring:
  不可裁剪: ["第2章(全局约束基线)", "第4章(逻辑到物理的桥梁)", "第5章(架构风格和分层定义)", "第11章(N00明确要求)"]
  小型项目: "BC<3且Enabler Epic≤1时：第3章可简化，第8/9章可合并，第10章可并入第5章"
  裁剪后保障: "追溯链完整性（Enabler Epic→Capability→Feature不断裂）"

# ── 必选元数据 ──
required_metadata: [项目名称, 项目编号, 所属产品线, 项目阶段, 当前设计版本]

# ── 章节结构（12章 + 附录，顺序固定不可调整） ──
chapters:

  - chapter: 1
    title: 概述
    required: true
    purpose: "导读章节：方法论框架图和术语约定，不含架构设计内容"
    sections:
      - { id: "1.1", title: "文档目的", points: "编写目的和适用范围" }
      - { id: "1.2", title: "方法论框架", points: "系统设计方法论框架图、各环节职责概述、与上下游阶段关系" }
      - { id: "1.3", title: "文档定位", points: "在研发过程中的位置（引用N00）" }
      - { id: "1.4", title: "术语约定", points: "通用术语引用索引（引用C99）、本文档特有术语定义" }
      - { id: "1.5", title: "编号约定", points: "各类条目编号体系说明（引用P01）" }
      - { id: "1.6", title: "三层文档", points: "系统设计→BC总体设计→BC详细设计的三层文档体系、各层职责边界和引用规则" }

  - chapter: 2
    title: 系统概述
    required: true
    non_reducible: true
    purpose: "建立设计基线：承接验收、设计目标、约束清单。结论向后传递至第5/7章"
    rules:
      - "验收状态为缺失/部分缺失时须填假设编号（AS-{序号}）"
      - "量化指标列不应为空；无法量化时填'待细化'并标注时间节点"
      - "约束影响范围应指向后续章节编号；后续章节引用约束时标注约束编号"
    sections:
      - { id: "2.1", title: "上游承接验收", model: "upstream_acceptance" }
      - { id: "2.2", title: "项目基本信息", model: "basic_info" }
      - { id: "2.3", title: "设计目标", model: "design_goals" }
      - { id: "2.4", title: "利益相关方", model: "stakeholders" }
      - { id: "2.5", title: "设计约束", model: "design_constraints" }
      - { id: "2.6", title: "文档版本范围", model: "doc_version_scope" }

  - chapter: 3
    title: 集成架构设计
    required: true
    purpose: "定义BC间和外部系统的集成方案。依赖治理原则是全局硬约束，各BC可加严但不得放宽"
    rules:
      - "映射图与映射关系总览表不一致时以总览表为准"
    sections:
      - { id: "3.1", title: "全局上下文映射图", model: "context_map_spec", points: "技术实现版映射图，承接阶段3第6章" }
      - { id: "3.2", title: "映射关系总览", model: "mapping_overview" }
      - { id: "3.3", title: "映射模式选型指南", model: "mapping_pattern_guide" }
      - { id: "3.4", title: "内部通信架构", model: "comm_selection_matrix" }
      - { id: "3.5", title: "API网关设计", points: "网关职责、路由规则规范、限流熔断策略" }
      - { id: "3.6", title: "事件驱动架构", model: "message_envelope", points: "消息中间件选型、全局事件规范（Topic命名、消息信封、幂等/重试/死信）" }
      - { id: "3.7", title: "外部系统集成", model: "external_system_list" }
      - { id: "3.8", title: "全局依赖治理原则", model: "dependency_governance" }

  - chapter: 4
    title: BC与服务映射
    required: true
    non_reducible: true
    purpose: "定义BC到微服务和数据库的映射。映射表是下游BC级文档引用频率最高的表格"
    rules:
      - "BC编号应与阶段3 BC清单完全一致，每个BC应有对应记录"
      - "偏离1:1:1默认规则的映射须在映射决策说明表中有记录"
    sections:
      - { id: "4.1", title: "映射总览", model: "bc_svc_db_mapping" }
      - { id: "4.2", title: "映射规则说明", model: "mapping_exceptions" }
      - { id: "4.3", title: "微服务清单", model: "service_list", points: "命名规范：svc-{业务名}" }
      - { id: "4.4", title: "数据库清单", model: "database_list", points: "命名规范：{项目缩写}_{业务名}" }
      - { id: "4.5", title: "映射决策说明", model: "mapping_decisions" }

  - chapter: 5
    title: 系统架构设计
    required: true
    non_reducible: true
    purpose: "定义整体架构风格、分层策略和技术选型。架构约束对所有BC有约束力"
    sections:
      - { id: "5.1", title: "架构风格", model: "arch_style_decision" }
      - { id: "5.2", title: "系统架构拓扑图", model: "arch_topology_spec", points: "全景架构图（前端层→网关层→服务层→数据层→基础设施层）" }
      - { id: "5.3", title: "DDD分层架构", model: "ddd_layers", points: "核心：领域层不依赖外层；基础设施层通过依赖反转实现领域层接口" }
      - { id: "5.4", title: "全局技术选型", model: "tech_stack" }
      - { id: "5.5", title: "技术选型约束", points: "全局技术栈统一决策规则、BC级技术引入变更流程" }

  - chapter: 6
    title: 部署架构设计
    required: true
    purpose: "定义部署架构、环境规划和CI/CD策略。核心：最小化环境差异"
    sections:
      - { id: "6.1", title: "部署架构总览", model: "deploy_arch_spec" }
      - { id: "6.2", title: "基础设施清单", model: "infra_list" }
      - { id: "6.3", title: "环境规划", model: "env_list" }
      - { id: "6.4", title: "CI/CD策略", model: "cicd_pipeline" }
      - { id: "6.5", title: "容器化与编排", model: "k8s_resources", points: "(宜) 容器化策略、K8s资源规划" }

  - chapter: 7
    title: 非功能需求方案
    required: true
    purpose: "将阶段2非功能框架转化为系统级量化约束和实现方案。非功能约束各BC可加严但不得放宽全局基线"
    sections:
      - { id: "7.1", title: "性能基线", model: "perf_targets" }
      - { id: "7.2", title: "可用性目标", model: "sla_definition" }
      - { id: "7.3", title: "可扩展性策略", points: "水平扩展/垂直扩展/弹性伸缩方案" }
      - { id: "7.4", title: "可观测性标准", model: "observability_and_alert", points: "全局标准（日志格式、指标命名、链路追踪、告警级别和升级策略）" }
      - { id: "7.5", title: "与阶段2非功能框架映射", model: "nfr_phase2_mapping" }

  - chapter: 8
    title: 数据架构设计
    required: true
    purpose: "定义数据架构策略。核心：拥抱最终一致性，强一致性限制在单个BC内"
    rules:
      - "禁止跨BC分布式事务（2PC/XA）"
      - "禁止通过共享数据库表实现跨BC数据同步"
      - "禁止在应用代码中手动管理跨数据库事务"
    sections:
      - { id: "8.1", title: "数据隔离模型", model: "multi_tenant_isolation" }
      - { id: "8.2", title: "数据库规范", model: "field_naming_and_audit", points: "表命名：{bc_prefix}_{业务表名}，全小写下划线分隔" }
      - { id: "8.3", title: "数据迁移策略", points: "版本升级时的数据迁移方案" }
      - { id: "8.4", title: "数据一致性策略", model: "data_consistency" }

  - chapter: 9
    title: 安全架构设计
    required: true
    purpose: "定义纵深防御安全架构（认证、授权、数据安全、网络安全），不依赖单一机制"
    sections:
      - { id: "9.1", title: "认证架构", model: "auth_scheme" }
      - { id: "9.2", title: "授权架构", model: "authz_model" }
      - { id: "9.3", title: "数据安全", model: "data_classification" }
      - { id: "9.4", title: "网络安全", points: "网络隔离策略、传输加密要求、入侵检测方案" }
      - { id: "9.5", title: "安全审计", model: "audit_scope" }

  - chapter: 10
    title: 演进规划
    required: true
    purpose: "版本路线图与架构演进策略。当前版本完整详尽，未来版本仅保留规划概述"
    sections:
      - { id: "10.1", title: "版本路线图", model: "version_plan" }
      - { id: "10.2", title: "BC版本覆盖矩阵", model: "bc_version_matrix", points: "各版本与各BC的覆盖关系（F=完整/B=基础/-=不涉及）" }
      - { id: "10.3", title: "架构演进预留", model: "arch_evolution" }
      - { id: "10.4", title: "技术债务追踪", model: "tech_debt" }
      - { id: "10.5", title: "版本标记规范", points: "文档内版本标记方式（版本范围表、行内标记、节级标记）" }

  - chapter: 11
    title: 架构需求清单
    required: true
    non_reducible: true
    purpose: "将Enabler Epic分解为Enabler Capability和Feature。分解产出应与第3-9章设计方案一致"
    rules:
      - "分解逻辑：Enabler Epic → Enabler Capability → Enabler Feature"
      - "每个Feature应有明确验收标准和与上游的追溯关系"
    sections:
      - { id: "11.1", title: "Enabler Epic承接", model: "enabler_epic_acceptance" }
      - { id: "11.2", title: "Enabler Capability定义", model: "enabler_capability_def" }
      - { id: "11.3", title: "Enabler Feature定义", model: "enabler_feature_def" }
      - { id: "11.4", title: "Epic→Capability→Feature追溯", model: "traceability_3level" }
      - { id: "11.5", title: "Feature→Business Epic约束映射", points: "标注各Feature对哪些Business Epic产生约束" }
      - { id: "11.6", title: "Feature→设计方案映射", points: "标注各Feature在第3-9章中的技术方案对应章节" }
      - { id: "11.7", title: "架构需求优先级与版本分配", model: "arch_req_priority" }

  - chapter: 12
    title: 内容边界与追溯
    required: true
    purpose: "明确与上下游文档的内容边界，确保完整可追溯性"
    sections:
      - { id: "12.1", title: "系统设计 vs 宏观需求", model: "content_boundary" }
      - { id: "12.2", title: "系统设计 vs 领域设计", model: "content_boundary" }
      - { id: "12.3", title: "系统设计 vs BC总体设计", model: "content_boundary" }
      - { id: "12.4", title: "当前版本 vs 未来版本", model: "current_vs_future" }
      - { id: "12.5", title: "架构需求追溯矩阵", model: "arch_traceability_matrix" }

# ── 附录 ──
appendices:
  - { id: A, title: "统一语言术语表", type: "资料性", required: false }
  - { id: B, title: "架构决策记录（ADR）", type: "资料性", required: false }
  - { id: C, title: "修订记录", type: "规范性", required: true }

# ── 内容模型定义 ──
# 格式：model_name → columns列表 + 可选note/rules
# columns用紧凑格式：列名(填写说明)

content_models:

  # ── 第2章 ──
  upstream_acceptance:
    note: "验收粒度为阶段3章节级输出物，不展开到输出物内部逐条"
    columns:
      - "验收项编号(ACP-{序号})"
      - "上游章节(阶段3领域设计的章节号)"
      - "验收内容(该章节应提供的输出物名称)"
      - "验收状态(已确认 / 部分缺失 / 缺失)"
      - "缺失处理(已确认时留空；否则填AS-{序号})"
      - "备注"

  basic_info:
    columns: ["项目名称(全称和简称)", "项目编号", "所属产品线", "项目阶段(新建/迭代/重构)", "当前设计版本(如V1.0 P1)"]

  design_goals:
    note: "业务目标(BG-{序号})和技术目标(TG-{序号})各一张表，列定义相同。每条目标应独立可量化可验证，结果导向不描述手段。业务目标追溯到Business Epic，技术目标追溯到Enabler Epic"
    columns: ["目标编号", "目标描述(一句话)", "量化指标(可测量)", "优先级(P0必达/P1重要/P2期望)", "关联Epic"]

  stakeholders:
    columns: ["角色(承接阶段2角色线CL0/CL1)", "关注点(1~3项)", "影响程度(高/中/低)", "代表人"]

  design_constraints:
    note: "每条约束应不可分割，具体到可直接指导设计决策。反例:'应使用成熟的数据库技术'→过模糊"
    columns: ["约束编号(C-{序号})", "约束类型(技术/业务/组织)", "约束描述", "来源(合规/已有系统/团队能力/上游)", "影响范围(下游章节编号)"]

  doc_version_scope:
    columns: ["版本(如V1.0 P1)", "功能范围", "涉及BC(编号)", "详略度(完整设计/规划概述)"]

  # ── 第3章 ──
  context_map_spec:
    note: "承接阶段3第6章逻辑映射图，补充技术实现维度。文本图/ASCII图遵循C02第6节。每个BC节点标注BC编号/名称/微服务名；每条映射线标注映射模式缩写/通信方式(同步/异步)/协议"

  mapping_overview:
    note: "粒度为BC对级别，同一对BC多种集成方式时拆为多条"
    columns: ["关系编号(CM-{序号})", "上游BC(编号+名称)", "下游BC(编号+名称)", "映射模式(OHS+ACL/CS/CF/SK/PT/SW等)", "集成方式(同步API/异步事件/共享库)", "协议(REST/gRPC/AMQP/Kafka)", "数据流向(单向/双向)", "协作场景(一句话)"]

  mapping_pattern_guide:
    columns: ["映射模式(名称及缩写)", "适用场景", "约束要求(上下游各自)", "耦合程度(低/中/高)", "推荐优先级(1~5星)"]

  comm_selection_matrix:
    columns: ["通信场景(同步查询/命令传递/数据同步/批量传输等)", "推荐方式", "备选方式", "约束要求(超时/熔断/幂等等)", "选型依据"]

  message_envelope:
    note: "强制字段：eventId/eventType/eventVersion/occurredOn/source/aggregateId/aggregateType/payload"
    columns: ["字段名", "类型(String/Object/Long等)", "必填(是/否)", "说明(含格式约束，如ISO 8601)"]

  external_system_list:
    columns: ["系统编号(EXT-{序号})", "系统名称", "集成方向(调入/调出/双向)", "集成方式(REST/SOAP/文件/消息队列/SDK)", "对接BC(编号)", "防腐层要求(ACL适配器实现要求)", "SLA要求"]

  dependency_governance:
    columns: ["治理场景(查询类依赖/命令类依赖/数据一致性/模型变更等)", "治理规则(强制要求)", "违规后果"]

  # ── 第4章 ──
  bc_svc_db_mapping:
    columns: ["BC编号(BC-{两位序号})", "BC名称", "BC英文名", "微服务名称(遵循命名规范)", "微服务端口", "数据库名称(遵循命名规范)", "代码包路径(主语言包前缀)", "代码仓库"]

  mapping_exceptions:
    note: "固定表，定义允许的例外情形"
    rows:
      - { type: "多BC合并微服务", condition: "BC职责高度内聚、变更频率一致、团队相同" }
      - { type: "一BC多数据库", condition: "读写分离、冷热数据分离、异构存储" }
      - { type: "多BC共享数据库", condition: "小型BC、成本敏感（须明确Schema或表前缀隔离策略）" }

  service_list:
    columns: ["微服务名称", "端口", "包含BC(编号)", "核心职责(一句话)", "对外接口类型(REST/gRPC/GraphQL)", "通信协议"]

  database_list:
    columns: ["数据库名称", "数据库类型(MySQL/PostgreSQL/MongoDB/Redis等)", "字符集", "包含BC(编号)", "隔离策略(独享/Schema隔离/表前缀隔离)", "说明"]

  mapping_decisions:
    columns: ["决策编号(MAP-{序号})", "偏离项(具体映射描述)", "偏离类型(多BC合并/一BC多库/多BC共享库/其他)", "决策原因", "风险", "缓解措施"]

  # ── 第5章 ──
  arch_style_decision:
    columns: ["架构维度(后端/前端/数据/通信)", "选定风格(微服务/DDD分层/CQRS/事件驱动/SPA/微前端等)", "选型依据", "约束(对设计和开发的具体约束)", "关联ADR(ADR-{序号})"]

  arch_topology_spec:
    note: "全景架构图，从前端层到基础设施层。文本图/ASCII图遵循C02第6节"

  ddd_layers:
    note: "核心：领域层不依赖外层；基础设施层通过依赖反转实现领域层接口；各BC可细化子层但不得违反依赖规则"
    columns: ["层名称(接口层/应用层/领域层/基础设施层)", "英文名(interfaces/application/domain/infrastructure)", "职责(2~4项)", "允许依赖", "禁止依赖", "典型组件"]

  tech_stack:
    columns: ["技术类别(语言/框架/数据库/缓存/消息/监控/构建等)", "技术名称", "版本(精确到次版本号)", "用途", "适用范围(全局/特定BC+编号)", "选型依据"]

  # ── 第6章 ──
  deploy_arch_spec:
    note: "部署架构图（基础设施层、计算/存储/中间件/网络拓扑）。文本图/ASCII图遵循C02第6节"

  infra_list:
    columns: ["资源类型(计算/存储/网络/中间件)", "资源名称", "规格(CPU/内存/存储)", "数量", "用途", "高可用策略(主从/集群/多AZ/无)"]

  env_list:
    columns: ["环境名称(DEV/SIT/STG/PROD)", "用途", "数据来源(Mock/脱敏/真实)", "访问范围(内网/VPN/公网)", "资源规模(相对生产比例)", "部署方式(手动/自动)"]

  cicd_pipeline:
    columns: ["阶段(编译/单元测试/代码扫描/制品/部署等)", "触发条件(Push/PR合并/Tag/手动/定时)", "执行内容", "产出物", "质量门禁(如覆盖率>=80%)"]

  k8s_resources:
    columns: ["Namespace", "包含服务", "CPU配额", "内存配额", "Pod副本策略(最小/最大副本数、HPA触发条件)"]

  # ── 第7章 ──
  perf_targets:
    columns: ["指标编号(PERF-{序号})", "指标名称(响应时间/吞吐量/并发数/错误率等)", "目标值(如<500ms/>=1000TPS)", "适用场景(读/写/批量/报表等)", "测量方式", "级别(必达SLA承诺/期望优化目标)"]

  sla_definition:
    columns: ["服务级别(核心/一般/辅助)", "服务范围(微服务或BC列表)", "可用性目标(%)", "最大宕机时间(月度)", "RTO", "RPO"]

  observability_and_alert:
    note: "可观测性标准表 + 告警级别定义表"
    alert_columns: ["告警级别(P0/P1/P2/P3)", "定义(触发条件)", "通知渠道(电话/短信/即时消息/邮件)", "响应时限", "升级策略"]

  nfr_phase2_mapping:
    columns: ["阶段2需求编号", "阶段2需求描述(原始全局级基线)", "本章对应章节", "量化指标(细化后)", "覆盖状态(已覆盖/部分覆盖/未覆盖)"]

  # ── 第8章 ──
  multi_tenant_isolation:
    columns: ["隔离级别(独立库/共享库独立Schema/共享库共享表)", "说明(实现方式)", "适用场景", "资源消耗(高/中/低)", "安全性(最高/较高/一般)", "运维复杂度(高/中/低)"]

  field_naming_and_audit:
    note: "字段命名规范表 + 公共审计字段定义表。审计字段为全局强制，所有业务表应包含"
    naming_columns: ["规则", "说明", "示例"]
    audit_columns: ["字段名", "类型(VARCHAR/DATETIME/INT/TINYINT等)", "说明", "必填(是/否)"]

  data_consistency:
    columns: ["场景(BC内单库事务/BC内跨聚合/跨BC事务/跨BC数据同步)", "一致性方案(本地事务/领域事件+最终一致性/Saga/事件发布)", "实现工具", "约束"]

  # ── 第9章 ──
  auth_scheme:
    columns: ["认证场景(用户登录/API调用/服务间/SSO/第三方)", "认证方式(JWT/OAuth2/SAML/LDAP/mTLS/API Key)", "Token有效期", "刷新策略", "适用BC(全局/特定编号)", "说明"]

  authz_model:
    columns: ["授权维度(功能权限/数据权限/菜单权限/API权限)", "授权模型(RBAC/ABAC/ACL)", "实现方式", "管理方式(静态/动态/混合)"]

  data_classification:
    columns: ["数据级别(公开/内部/敏感/机密)", "说明", "加密要求(无/传输/传输+存储/传输+存储+字段级)", "脱敏要求(无/日志脱敏/必须脱敏展示/禁止日志记录)", "访问控制(无特殊/认证后/授权后/最小权限)", "典型数据"]

  audit_scope:
    columns: ["审计类别(用户操作/数据访问/系统配置变更/权限变更)", "审计内容(应记录的具体操作)", "审计级别(必审强制/宜审推荐)"]

  # ── 第10章 ──
  version_plan:
    columns: ["版本号(如V1.0 P1)", "里程碑(MVP/Beta/GA)", "时间节点", "核心目标(追溯到第2章设计目标)", "涉及BC(编号)", "状态(规划中/设计中/开发中/已交付)"]

  bc_version_matrix:
    note: "行=BC，列=版本，交叉标记 F(完整)/B(基础)/-(不涉及)"

  arch_evolution:
    columns: ["方向编号(EVO-{序号})", "演进方向", "触发条件", "当前预留(为该演进所做的预留措施)", "预估影响"]

  tech_debt:
    columns: ["债务编号(TD-{序号})", "债务描述(权宜之计或设计妥协)", "产生原因", "影响范围(BC或组件)", "严重程度(高阻碍演进/中增加维护成本/低可长期容忍)", "计划处理版本"]

  # ── 第11章 ──
  enabler_epic_acceptance:
    columns: ["Epic编号(阶段3第9章)", "Epic名称", "来源(阶段3章节引用)", "验收状态(已确认/需澄清/已变更)", "变更说明(已变更时填)"]

  enabler_capability_def:
    columns: ["Capability编号(EC-{序号})", "Capability名称", "能力定义(一句话职责)", "业务价值", "关联Enabler Epic", "涉及BC(编号)", "优先级(P0/P1/P2)"]

  enabler_feature_def:
    columns: ["Feature编号(EF-{序号})", "Feature名称", "Feature描述", "验收标准(可验证,1~3条)", "关联Enabler Capability", "关联BC", "版本归属", "优先级(P0/P1/P2)"]

  traceability_3level:
    note: "每一级都应填写编号+名称，禁止留空"
    columns: ["Enabler Epic(编号+名称)", "Enabler Capability(编号+名称)", "Enabler Feature(编号+名称)"]

  arch_req_priority:
    columns: ["条目编号(EC/EF-{序号})", "条目名称", "条目层级(Capability/Feature)", "优先级(P0/P1/P2)", "版本归属", "WSJF评分(如适用)"]

  # ── 第12章 ──
  content_boundary:
    note: "每对文档关系各一张表（系统设计 vs 宏观需求 / 领域设计 / BC总体设计）"
    columns: ["内容类型", "归属文档(系统设计/宏观需求/领域设计/BC总体设计)", "对方文档处理(完整定义/引用/遵循/不涉及)", "说明"]

  current_vs_future:
    columns: ["设计内容", "当前版本详略度", "未来版本详略度"]

  arch_traceability_matrix:
    note: "追溯关系应满足正向追溯、反向追溯和变更影响分析三种能力。每级禁止留空"
    columns: ["Strategic Theme(阶段1)", "Business Epic(阶段2编号+名称)", "Enabler Epic(阶段3编号+名称)", "Enabler Capability(本文档编号+名称)", "Enabler Feature(本文档编号+名称)"]

# ── 交叉引用要求 ──
required_xrefs:
  upstream:
    - { doc: "阶段3 领域设计", check: "子域清单、BC清单、上下文映射图、领域事件全景、Enabler Epic清单、架构约束传递清单" }
    - { doc: "阶段2 宏观需求", check: "Business Epic清单、非功能需求框架" }
    - { doc: "阶段1 产品战略", check: "版本路线图" }
  downstream:
    - { doc: "阶段5 BC详细需求", check: "所有设计决策为下游提供全局约束" }
