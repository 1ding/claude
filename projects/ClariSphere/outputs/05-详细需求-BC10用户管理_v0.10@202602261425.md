# 需求规格-BC-10 用户管理

+   **文档版本**: V0.10
+   **编制日期**: 2026-01-31
+   **文档状态**: 草稿
+   **所属项目**: ClariSphere(透管云)
+   **适用阶段**: 阶段4 详细需求分析（依据《透管云产品研发过程规范》V1.1）
+   **变更历史**：版本变更历史如下表所示

    | 版本  | 日期       | 变更内容 | 变更人 |
    | ----- | ---------- | -------- | ------ |
    | V0.10 | 2026-01-31 | 初始版本 | -      |

    表 0-1 文档变更记录

+   **文档密级**：【机密】 -- 外发必追责。

# 1 概述

## 1.1 BC定位

+   BC-10用户管理（Identity and Access Management, IAM）是透管云平台的通用域核心上下文
+   BC-10定位如下表所示

    | 属性       | 内容                                                                                    |
    | ---------- | --------------------------------------------------------------------------------------- |
    | BC编号     | BC-10                                                                                   |
    | BC名称     | 用户管理（Identity and Access Management, IAM）                                         |
    | 所属域     | 用户管理域                                                                              |
    | 架构域     | 通用服务层                                                                              |
    | 核心职责   | 统一身份认证、用户管理、权限管理、组织架构、审计日志                                    |
    | 所属微服务 | svc-iam                                                                                 |
    | 所属数据库 | clarisphere_platform（UP）、clarisphere_<tenant_code>（UR）、clarisphere_consumer（UC） |

    表 1.1-1 BC-10定位

+   BC-10在整体架构中的位置如下图所示

    ```graph
    ┌────────────────────────────────────────────────────────────────────────────────┐
    │                       BC-10在透管云架构中的位置                                │
    ├────────────────────────────────────────────────────────────────────────────────┤
    │                                                                                │
    │  ┌──────────────────────────────────────────────────────────────────────────┐  │
    │  │                           业务BC层                                       │  │
    │  │  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐             │  │
    │  │  │  BC-01~03  │ │  BC-04~05  │ │  BC-06~09  │ │  BC-11~13  │             │  │
    │  │  │  供给侧BC  │ │ 知识中台BC │ │ 消费侧A BC │ │ 消费侧B BC │             │  │
    │  │  └──────┬─────┘ └──────┬─────┘ └──────┬─────┘ └──────┬─────┘             │  │
    │  │         │              │              │              │                   │  │
    │  │         └──────────────┴──────────────┴──────────────┘                   │  │
    │  │                                │                                         │  │
    │  └────────────────────────────────┼─────────────────────────────────────────┘  │
    │                                   │ OHS（开放主机服务）                        │
    │                                   ▼                                            │
    │  ┌──────────────────────────────────────────────────────────────────────────┐  │
    │  │                           通用域BC层                                     │  │
    │  │                                                                          │  │
    │  │  ┌─────────────────────────────────────────────────────────────────────┐ │  │
    │  │  │                    ★ BC-10 用户管理 (IAM) ★                         │ │  │
    │  │  │  ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐            │ │  │
    │  │  │  │ 用户管理  │ │ 认证管理  │ │ 授权管理  │ │ 审计管理  │            │ │  │
    │  │  │  │  (User)   │ │  (Authn)  │ │  (Authz)  │ │  (Audit)  │            │ │  │
    │  │  │  └───────────┘ └───────────┘ └───────────┘ └───────────┘            │ │  │
    │  │  └─────────────────────────────────────────────────────────────────────┘ │  │
    │  │                                                                          │  │
    │  │  ┌────────────┐ ┌────────────┐ ┌────────────┐                            │  │
    │  │  │ BC-11      │ │ BC-14      │ │ BC-15      │                            │  │
    │  │  │ 租户管理   │ │ 消息通知   │ │ 文件管理   │                            │  │
    │  │  └────────────┘ └────────────┘ └────────────┘                            │  │
    │  └──────────────────────────────────────────────────────────────────────────┘  │
    │                                                                                │
    │  说明：BC-10通过OHS模式向所有业务BC提供认证、授权、用户信息查询服务            │
    │                                                                                │
    └────────────────────────────────────────────────────────────────────────────────┘
    ```

    图 1.1-1 BC-10在透管云架构中的位置

## 1.2 核心价值

+   BC-10为透管云平台提供以下核心价值

    | 价值维度 | 价值描述                                         |
    | -------- | ------------------------------------------------ |
    | 安全保障 | 统一身份认证，确保只有合法用户才能访问系统       |
    | 权限控制 | 细粒度权限管理，确保用户只能访问授权的功能和数据 |
    | 组织支撑 | 组织架构管理，支撑租户落地的岗位责任映射         |
    | 合规审计 | 完整审计日志，满足监管合规和问题追溯需求         |
    | 统一体验 | 三类用户群统一管理，提供一致的用户体验           |

    表 1.2-1 BC-10核心价值

## 1.3 业务边界

### 1.3.1 范围内

+   BC-10的职责范围包括以下内容

    | 职责分类 | 职责内容                                                |
    | -------- | ------------------------------------------------------- |
    | 用户管理 | 用户注册、信息维护、状态管理、账号注销                  |
    | 多用户群 | 支持UP（运营用户群）、UR（租户用户群）、UC（C端用户群） |
    | 认证管理 | 本地认证、Token签发/刷新、会话管理、密码策略            |
    | SSO集成  | OAuth2/OIDC单点登录（P1）、LDAP认证（P2）               |
    | 授权管理 | RBAC角色模型、功能权限、数据权限                        |
    | 组织架构 | 部门管理、岗位管理、人员管理、汇报关系                  |
    | 审计日志 | 登录日志、操作日志、安全事件、日志查询导出              |
    | 租户IAM  | 租户IAM表初始化、预置角色和权限创建                     |

    表 1.3.1-1 BC-10职责范围

### 1.3.2 范围外

+   以下职责不属于BC-10的范围

    | 排除职责         | 归属BC         | 说明                                      |
    | ---------------- | -------------- | ----------------------------------------- |
    | 租户生命周期管理 | BC-11 租户管理 | 租户开通、配置、计费由BC-11负责           |
    | 租户数据库创建   | BC-11 租户管理 | 数据库/Schema创建由BC-11负责              |
    | 业务数据权限     | 各业务BC       | 具体业务的数据权限规则由各BC定义          |
    | 租户岗位责任映射 | BC-13 租户落地 | 标准角色点到租户岗位的映射由BC-13负责     |
    | AD/LDAP用户同步  | BC-11 租户管理 | 从企业目录同步用户到租户数据库由BC-11负责 |

    表 1.3.2-1 BC-10排除职责

### 1.3.3 BC协作关系

+   BC-10与其他BC的协作关系如下表所示

    | 协作BC         | 协作方向 | 协作内容                         | 集成方式 |
    | -------------- | -------- | -------------------------------- | -------- |
    | BC-11 租户管理 | 上游     | 租户开通时调用IAM初始化接口      | 同步API  |
    | BC-13 租户落地 | 下游     | 提供组织架构（部门、岗位、人员） | 同步API  |
    | 所有业务BC     | 下游     | 提供认证、授权、用户信息查询服务 | 同步API  |

    表 1.3.3-1 BC-10协作关系

### 1.3.4 用户类型定义

+   BC-10管理三个用户群的5种用户类型，用户类型定义如下表所示

    | 用户类型编码   | 用户类型名称 | 所属用户群 | 典型角色      | 说明               |
    | -------------- | ------------ | ---------- | ------------- | ------------------ |
    | provider_admin | 运营方管理员 | UP         | UP-08, UP-09  | 平台最高管理权限   |
    | provider_user  | 运营方用户   | UP         | UP-01 ~ UP-07 | 平台业务操作权限   |
    | ur_admin       | 租户管理员   | UR         | UR-10         | 租户内最高管理权限 |
    | ur_user        | 租户用户     | UR         | UR-01 ~ UR-09 | 租户业务操作权限   |
    | uc_user        | 个人用户     | UC         | UC-01, UC-02  | 知识消费权限       |

    表 1.3.4-1 用户类型定义

+   用户类型与认证方式的关系如下表所示

    | 用户类型       | 主要认证方式 | 辅助认证方式       | MFA要求 | 登录入口           |
    | -------------- | ------------ | ------------------ | ------- | ------------------ |
    | provider_admin | 用户名+密码  | -                  | 强制    | /up/login          |
    | provider_user  | 用户名+密码  | -                  | 强制    | /up/login          |
    | ur_admin       | 用户名+密码  | SSO/LDAP（可配置） | 可配置  | /ur/{tenant}/login |
    | ur_user        | 用户名+密码  | SSO/LDAP（可配置） | 可配置  | /ur/{tenant}/login |
    | uc_user        | 手机验证码   | 第三方OAuth        | 不要求  | /uc/login          |

    表 1.3.4-2 用户类型与认证方式

### 1.3.5 用户状态机

+   用户生命周期状态定义如下表所示

    | 状态编码             | 状态名称 | 说明                             | 可迁移到的状态           |
    | -------------------- | -------- | -------------------------------- | ------------------------ |
    | PENDING_ACTIVATION   | 待激活   | 账号已创建，等待用户首次登录激活 | ACTIVE, CANCELLED        |
    | ACTIVE               | 正常     | 账号可正常使用                   | DISABLED, PENDING_CANCEL |
    | DISABLED             | 禁用     | 账号被管理员禁用，不可登录       | ACTIVE, CANCELLED        |
    | PENDING_CANCELLATION | 待注销   | 用户申请注销，等待冷静期结束     | ACTIVE, CANCELLED        |
    | CANCELLED            | 已注销   | 账号已注销，不可恢复             | -                        |

    表 1.3.5-1 用户状态定义

+   用户状态迁移图如下所示

    ```graph
    ┌─────────────────────────────────────────────────────────────────────────────┐
    │                           用户状态迁移图                                    │
    ├─────────────────────────────────────────────────────────────────────────────┤
    │                                                                             │
    │                        ┌─────────────────────┐                              │
    │                        │  PENDING_ACTIVATION │                              │
    │                        │      （待激活）     │                              │
    │                        └──────────┬──────────┘                              │
    │                                   │ 首次登录激活                            │
    │                                   ▼                                         │
    │    禁用 ┌─────────────────────────────────────────────────────┐ 申请注销    │
    │   ┌─────│                      ACTIVE                         │────┐        │
    │   │     │                     （正常）                        │    │        │
    │   │     └─────────────────────────────────────────────────────┘    │        │
    │   │                           ▲                                    │        │
    │   ▼                           │ 启用                               ▼        │
    │ ┌─────────────────┐           │            ┌─────────────────────────┐      │
    │ │    DISABLED     │───────────┘            │  PENDING_CANCELLATION   │      │
    │ │    （禁用）     │                        │      （待注销）         │      │
    │ └────────┬────────┘                        └───────────┬─────────────┘      │
    │          │ 直接注销                                    │ 冷静期结束/确认    │
    │          │              ┌─────────────────┐            │                    │
    │          └─────────────►│   CANCELLED     │◄───────────┘                    │
    │                         │   （已注销）    │                                 │
    │                         └─────────────────┘                                 │
    │                                                                             │
    └─────────────────────────────────────────────────────────────────────────────┘
    ```

    图 1.3.5-1 用户状态迁移图

## 1.4 版本规划

+   BC-10的版本规划覆盖P1至P6六个版本，与产品整体版本路线图对齐
+   各版本的能力范围如下表所示

    | 版本 | 版本号 | 能力范围                                             | 交付里程碑       |
    | ---- | ------ | ---------------------------------------------------- | ---------------- |
    | P1   | 1.0    | 用户管理、本地认证、RBAC权限、组织架构、基础审计日志 | IAM基础能力上线  |
    | P2   | 1.2    | SSO/OIDC集成、LDAP认证、权限继承、高级审计           | 企业集成能力上线 |
    | P3   | 1.4    | MFA多因素认证、社交登录、权限委托                    | C端体验增强      |
    | P4   | 1.6    | 自适应认证、行为分析、风险感知                       | 智能安全能力     |
    | P5   | 1.8    | 零信任架构、细粒度审计、合规报告                     | 合规审计增强     |
    | P6   | 2.0    | AI辅助权限推荐、异常行为预警、跨租户联邦认证         | 智能化IAM        |

    表 1.4-1 BC-10版本规划

+   版本规划说明：
    -   P1-P2为核心能力建设期，聚焦IAM基础功能和企业集成
    -   P3-P4为能力增强期，提升安全性和用户体验
    -   P5-P6为智能化演进期，引入AI能力和高级合规特性
    -   需求按版本归属，不再区分版本内优先级；若需求不够重要，直接规划到后续版本

## 1.5 Epic映射

+   BC-10映射的Epic分为主责Epic和协作Epic两类
+   BC-10的Epic映射如下表所示

    | Epic编号 | Epic名称     | 角色关系 | 目标版本 | BC-10提供的能力              |
    | -------- | ------------ | -------- | -------- | ---------------------------- |
    | EP-37    | 平台用户管理 | 主责     | P1       | 用户管理、认证、授权、审计   |
    | EP-08    | 运营数据监控 | 协作     | P2       | 用户活跃度、登录统计数据     |
    | EP-15    | 租户场景映射 | 协作     | P1       | 组织架构（部门、岗位、人员） |
    | EP-16    | 租户控制定制 | 协作     | P1       | 组织架构（部门、岗位、人员） |
    | EP-17    | 租户资产管理 | 协作     | P1       | 组织架构（部门、岗位、人员） |
    | EP-19    | 岗位责任映射 | 协作     | P1       | 组织架构和人员数据           |
    | EP-31    | 审计检查     | 协作     | P5       | 审计日志查询和导出           |

    表 1.5-1 BC-10 Epic映射

+   Epic映射说明：
    -   **主责Epic**：EP-37平台用户管理是BC-10的核心Epic，BC-10负责该Epic的全部Feature交付
    -   **协作Epic**：BC-10作为OHS（开放主机服务）向其他BC提供用户、组织、审计等数据服务

# 2 用户角色

## 2.1 角色清单

+   BC-10涉及的用户角色来源于三个用户群，角色清单如下表所示

    | 角色编号 | 角色名称     | 所属用户群 | 在BC-10的场景                |
    | -------- | ------------ | ---------- | ---------------------------- |
    | UP-06    | 租户运营员   | UP         | 管理租户用户、配置租户权限   |
    | UP-08    | 平台运营总监 | UP         | 查看平台用户统计、安全态势   |
    | UP-09    | 平台管理员   | UP         | 管理平台用户、角色、权限     |
    | UR-01    | CISO         | UR         | 查看租户用户、权限配置、审计 |
    | UR-10    | 租户管理员   | UR         | 管理租户内用户、角色、组织   |
    | UR-ALL   | 租户普通用户 | UR         | 个人信息维护、密码修改       |
    | UC-01    | 知识访客     | UC         | 注册、登录、个人信息维护     |
    | UC-02    | 专业个人     | UC         | 会员管理、个人信息维护       |

    表 2.1-1 BC-10角色清单

## 2.2 角色详细定义

### 2.2.1 UP-09 平台管理员

+   角色定义如下表所示

    | 属性           | 内容                                       |
    | -------------- | ------------------------------------------ |
    | 角色编号       | UP-09                                      |
    | 角色名称       | 平台管理员                                 |
    | 所属用户群     | UP（运营用户群）                           |
    | 所属利益相关方 | 平台运营方                                 |
    | 核心目标       | 管理平台用户和权限，确保平台安全稳定运行   |
    | 主要职责       | 创建平台用户、配置角色权限、监控安全事件   |
    | 典型痛点       | 权限管理复杂、安全事件响应不及时           |
    | 使用频率       | 高                                         |
    | 在本BC的场景   | 用户管理、角色管理、权限配置、审计日志查询 |

    表 2.2.1-1 UP-09角色定义

### 2.2.2 UP-06 租户运营员

+   角色定义如下表所示

    | 属性           | 内容                                         |
    | -------------- | -------------------------------------------- |
    | 角色编号       | UP-06                                        |
    | 角色名称       | 租户运营员                                   |
    | 所属用户群     | UP（运营用户群）                             |
    | 所属利益相关方 | 平台运营方                                   |
    | 核心目标       | 协助租户管理用户和权限，提供运营支持         |
    | 主要职责       | 处理租户用户问题、重置密码、配置租户初始权限 |
    | 典型痛点       | 租户问题响应慢、权限配置易出错               |
    | 使用频率       | 高                                           |
    | 在本BC的场景   | 租户用户查询、密码重置、租户权限协助配置     |

    表 2.2.2-1 UP-06角色定义

### 2.2.3 UR-10 租户管理员

+   角色定义如下表所示

    | 属性           | 内容                                       |
    | -------------- | ------------------------------------------ |
    | 角色编号       | UR-10                                      |
    | 角色名称       | 租户管理员                                 |
    | 所属用户群     | UR（租户用户群）                           |
    | 所属利益相关方 | 企业租户                                   |
    | 核心目标       | 管理本租户的用户、组织架构和权限           |
    | 主要职责       | 创建用户、维护组织架构、配置角色权限       |
    | 典型痛点       | 员工入离职频繁、权限配置繁琐               |
    | 使用频率       | 高                                         |
    | 在本BC的场景   | 用户管理、部门管理、岗位管理、角色权限配置 |

    表 2.2.3-1 UR-10角色定义

### 2.2.4 UR-01 CISO

+   角色定义如下表所示

    | 属性           | 内容                                     |
    | -------------- | ---------------------------------------- |
    | 角色编号       | UR-01                                    |
    | 角色名称       | CISO（首席信息安全官）                   |
    | 所属用户群     | UR（租户用户群）                         |
    | 所属利益相关方 | 企业租户                                 |
    | 核心目标       | 监督租户安全态势，确保合规要求得到满足   |
    | 主要职责       | 审查权限配置、监控安全事件、审计用户行为 |
    | 典型痛点       | 安全风险不可见、审计数据分散             |
    | 使用频率       | 中                                       |
    | 在本BC的场景   | 权限审查、审计日志查询、安全事件分析     |

    表 2.2.4-1 UR-01角色定义

### 2.2.5 UR-ALL 租户普通用户

+   角色定义如下表所示

    | 属性           | 内容                             |
    | -------------- | -------------------------------- |
    | 角色编号       | UR-ALL                           |
    | 角色名称       | 租户普通用户                     |
    | 所属用户群     | UR（租户用户群）                 |
    | 所属利益相关方 | 企业租户                         |
    | 核心目标       | 完成日常工作，维护个人账号安全   |
    | 主要职责       | 使用系统功能、维护个人信息       |
    | 典型痛点       | 忘记密码、账号被锁定             |
    | 使用频率       | 高                               |
    | 在本BC的场景   | 登录认证、个人信息维护、密码修改 |

    表 2.2.5-1 UR-ALL角色定义

### 2.2.6 UC-01 知识访客

+   角色定义如下表所示

    | 属性           | 内容                 |
    | -------------- | -------------------- |
    | 角色编号       | UC-01                |
    | 角色名称       | 知识访客             |
    | 所属用户群     | UC（C端用户群）      |
    | 所属利益相关方 | 个人用户             |
    | 核心目标       | 浏览和搜索合规知识   |
    | 主要职责       | 使用知识搜索功能     |
    | 典型痛点       | 需要注册才能深度使用 |
    | 使用频率       | 低                   |
    | 在本BC的场景   | 注册账号、登录       |

    表 2.2.6-1 UC-01角色定义

### 2.2.7 UC-02 专业个人

+   角色定义如下表所示

    | 属性           | 内容                             |
    | -------------- | -------------------------------- |
    | 角色编号       | UC-02                            |
    | 角色名称       | 专业个人                         |
    | 所属用户群     | UC（C端用户群）                  |
    | 所属利益相关方 | 个人用户                         |
    | 核心目标       | 获取专业合规知识，提升个人能力   |
    | 主要职责       | 使用知识消费功能                 |
    | 典型痛点       | 配额限制、会员续费               |
    | 使用频率       | 中                               |
    | 在本BC的场景   | 个人信息维护、会员管理、密码修改 |

    表 2.2.7-1 UC-02角色定义

## 2.3 角色-场景映射

+   角色与业务场景的映射关系如下表所示

    | 角色编号 | 角色名称     | 参与场景                                                         |
    | -------- | ------------ | ---------------------------------------------------------------- |
    | UP-09    | 平台管理员   | 平台用户管理、平台角色管理、平台权限配置、审计查询               |
    | UP-06    | 租户运营员   | 租户审批、租户开通、配额分配、活跃度分析、租户用户查询、密码重置 |
    | UR-10    | 租户管理员   | 租户用户管理、组织架构管理、租户角色权限配置                     |
    | UR-01    | CISO         | 权限审查、审计日志查询、安全事件分析                             |
    | UR-ALL   | 租户普通用户 | 登录认证、个人信息维护、密码修改                                 |
    | UC-01    | 知识访客     | 注册、登录                                                       |
    | UC-02    | 专业个人     | 个人信息维护、会员管理、密码修改                                 |

    表 2.3-1 角色-场景映射

# 3 业务场景

## 3.1 场景识别方法

+   BC-10的业务场景通过以下方法识别：
    -   **来源一：宏观需求场景分解**：从《02-宏观需求》第3章业务场景中识别与IAM相关的场景
    -   **来源二：角色职责分析**：从第2章角色清单中分析每个角色在IAM领域的典型操作
    -   **来源三：BC职责边界**：从第1.3节业务边界中提取BC-10的核心职责作为场景
    -   **来源四：跨BC协作需求**：从BC协作关系中识别需要BC-10提供服务的场景
+   场景识别过程如下图所示

    ```graph
    ┌─────────────────────────────────────────────────────────────────────────────┐
    │                        BC-10 场景识别过程                                   │
    ├─────────────────────────────────────────────────────────────────────────────┤
    │                                                                             │
    │  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐          │
    │  │ 宏观需求        │    │ 角色清单        │    │ BC职责边界      │          │
    │  │ (38个场景)      │    │ (8个角色)       │    │ (5项核心职责)   │          │
    │  └────────┬────────┘    └────────┬────────┘    └────────┬────────┘          │
    │           │                      │                      │                   │
    │           ▼                      ▼                      ▼                   │
    │  ┌─────────────────────────────────────────────────────────────────────┐    │
    │  │                        场景识别与归类                               │    │
    │  │  • 按子领域分类：认证管理、用户管理、授权管理、审计管理             │    │
    │  │  • 按用户群分类：UP场景、UR场景、UC场景、系统场景                   │    │
    │  └─────────────────────────────────┬───────────────────────────────────┘    │
    │                                    │                                        │
    │                                    ▼                                        │
    │  ┌─────────────────────────────────────────────────────────────────────┐    │
    │  │                     BC-10 业务场景清单（15个）                      │    │
    │  │  • 认证管理：5个场景（登录、密码、会话、SSO、MFA）                  │    │
    │  │  • 用户管理：5个场景（注册、平台用户、租户用户、个人用户、组织）    │    │
    │  │  • 授权管理：2个场景（角色、权限）                                  │    │
    │  │  • 审计管理：1个场景（审计日志）                                    │    │
    │  │  • 系统场景：2个场景（租户IAM初始化、LDAP集成）                     │    │
    │  └─────────────────────────────────────────────────────────────────────┘    │
    │                                                                             │
    └─────────────────────────────────────────────────────────────────────────────┘
    ```

    图 3.1-1 BC-10场景识别过程

## 3.2 场景清单

+   BC-10共识别15个业务场景，按子领域分为4个模块
+   场景与宏观需求、角色的追溯关系在各场景详细定义中说明

### 3.2.1 认证管理模块

+   认证管理模块包含用户身份验证相关的场景
+   认证管理场景清单如下表所示

    | 场景编号  | 场景名称     | 场景描述                     | 主要角色 | 目标版本 |
    | --------- | ------------ | ---------------------------- | -------- | -------- |
    | SC-IAM-02 | 用户登录认证 | 验证用户身份，签发访问令牌   | 所有角色 | P1       |
    | SC-IAM-03 | 密码管理     | 修改密码、找回密码、密码策略 | 所有角色 | P1       |
    | SC-IAM-04 | 会话管理     | Token签发刷新、设备管理      | 所有角色 | P1       |
    | SC-IAM-13 | SSO单点登录  | 企业IdP集成、OAuth2/OIDC     | UR-ALL   | P2       |
    | SC-IAM-15 | 多因素认证   | TOTP、短信验证、邮件验证     | 所有角色 | P3       |

    表 3.2.1-1 认证管理场景清单

+   认证管理模块场景来源追溯如下表所示

    | 场景编号  | 宏观需求来源       | 角色来源             | BC职责来源   |
    | --------- | ------------------ | -------------------- | ------------ |
    | SC-IAM-02 | FD-01 统一身份认证 | 所有角色登录需求     | 认证管理职责 |
    | SC-IAM-03 | FD-01 统一身份认证 | 所有角色密码维护需求 | 认证管理职责 |
    | SC-IAM-04 | FD-01 统一身份认证 | 所有角色会话安全需求 | 认证管理职责 |
    | SC-IAM-13 | FD-01 统一身份认证 | UR角色企业集成需求   | SSO集成职责  |
    | SC-IAM-15 | NF-02 安全需求     | 所有角色安全增强需求 | 认证管理职责 |

    表 3.2.1-2 认证管理场景来源追溯

### 3.2.2 用户管理模块

+   用户管理模块包含用户生命周期管理相关的场景
+   用户管理场景按用户群分为三类：UP（平台）、UR（租户）、UC（个人）
+   用户管理场景清单如下表所示

    | 场景编号  | 场景名称     | 场景描述                 | 主要角色 | 目标版本 |
    | --------- | ------------ | ------------------------ | -------- | -------- |
    | SC-IAM-01 | 用户注册     | C端用户自主注册账号      | UC-01    | P1       |
    | SC-IAM-05 | 平台用户管理 | 管理平台运营人员账号     | UP-09    | P1       |
    | SC-IAM-06 | 租户用户管理 | 管理租户内员工账号       | UR-10    | P1       |
    | SC-IAM-07 | 个人用户管理 | C端用户自主管理个人信息  | UC-02    | P1       |
    | SC-IAM-08 | 组织架构管理 | 管理租户部门、岗位、人员 | UR-10    | P1       |

    表 3.2.2-1 用户管理场景清单

+   UR用户群的用户获取模式说明如下表所示

    | 模式编码        | 模式名称   | 适用场景                     | 用户上限 | 说明                   |
    | --------------- | ---------- | ---------------------------- | -------- | ---------------------- |
    | ADMIN_CREATE    | 管理员创建 | 小型企业、严格管控、试用租户 | 试用5人  | 管理员手动创建用户     |
    | OPEN_REGISTER   | 开放注册   | 中型企业、邮箱域名验证       | 按合同   | 员工凭企业邮箱自主注册 |
    | ENTERPRISE_SYNC | 企业同步   | 大型企业、有IAM/HR/AD系统    | 按合同   | SCIM/LDAP/API批量同步  |
    | HYBRID          | 混合模式   | 多种场景组合                 | 按合同   | 以上模式的组合         |

    表 3.2.2-2 UR用户群用户获取模式

+   试用租户用户获取限制：
    -   试用租户仅支持ADMIN_CREATE模式
    -   用户数上限为5人（含租户管理员）
    -   试用期为30天

+   用户管理模块场景来源追溯如下表所示

    | 场景编号  | 宏观需求来源       | 角色来源               | BC职责来源   |
    | --------- | ------------------ | ---------------------- | ------------ |
    | SC-IAM-01 | FD-01 统一身份认证 | UC-01 知识访客注册需求 | 用户管理职责 |
    | SC-IAM-05 | FD-01 统一身份认证 | UP-09 平台管理需求     | 用户管理职责 |
    | SC-IAM-06 | FD-01 统一身份认证 | UR-10 租户管理需求     | 用户管理职责 |
    | SC-IAM-07 | FD-01 统一身份认证 | UC-02 个人维护需求     | 用户管理职责 |
    | SC-IAM-08 | EP-19 岗位责任映射 | UR-10 组织架构需求     | 组织架构职责 |

    表 3.2.2-3 用户管理场景来源追溯

### 3.2.3 授权管理模块

+   授权管理模块包含角色权限配置相关的场景
+   授权管理场景清单如下表所示

    | 场景编号  | 场景名称 | 场景描述                 | 主要角色    | 目标版本 |
    | --------- | -------- | ------------------------ | ----------- | -------- |
    | SC-IAM-09 | 角色管理 | 定义和管理系统角色       | UP-09/UR-10 | P1       |
    | SC-IAM-10 | 权限配置 | 配置角色的功能和数据权限 | UP-09/UR-10 | P1       |

    表 3.2.3-1 授权管理场景清单

+   授权管理模块场景来源追溯如下表所示

    | 场景编号  | 宏观需求来源       | 角色来源             | BC职责来源   |
    | --------- | ------------------ | -------------------- | ------------ |
    | SC-IAM-09 | FD-02 统一权限框架 | UP-09/UR-10 管理需求 | 授权管理职责 |
    | SC-IAM-10 | FD-02 统一权限框架 | UP-09/UR-10 管理需求 | 授权管理职责 |

    表 3.2.3-2 授权管理场景来源追溯

### 3.2.4 审计管理模块

+   审计管理模块包含日志记录和查询相关的场景
+   审计管理场景清单如下表所示

    | 场景编号  | 场景名称     | 场景描述                         | 主要角色    | 目标版本 |
    | --------- | ------------ | -------------------------------- | ----------- | -------- |
    | SC-IAM-11 | 审计日志查询 | 查询登录日志、操作日志、安全事件 | UP-09/UR-01 | P1       |

    表 3.2.4-1 审计管理场景清单

+   审计管理模块场景来源追溯如下表所示

    | 场景编号  | 宏观需求来源       | 角色来源             | BC职责来源   |
    | --------- | ------------------ | -------------------- | ------------ |
    | SC-IAM-11 | FD-04 统一审计日志 | UP-09/UR-01 审计需求 | 审计日志职责 |

    表 3.2.4-2 审计管理场景来源追溯

### 3.2.5 系统场景模块

+   系统场景模块包含系统自动触发或后台集成的场景
+   系统场景清单如下表所示

    | 场景编号  | 场景名称      | 场景描述                     | 主要角色    | 目标版本 |
    | --------- | ------------- | ---------------------------- | ----------- | -------- |
    | SC-IAM-12 | 租户IAM初始化 | BC-11调用，初始化租户IAM数据 | 系统        | P1       |
    | SC-IAM-14 | LDAP认证集成  | 对接企业AD/LDAP目录服务      | 系统        | P2       |
    | SC-IAM-16 | 系统配置管理  | 管理平台级和租户级的配置参数 | UP-09/UR-10 | P1       |

    表 3.2.5-1 系统场景清单

+   系统场景模块场景来源追溯如下表所示

    | 场景编号  | 宏观需求来源       | 角色来源            | BC职责来源       |
    | --------- | ------------------ | ------------------- | ---------------- |
    | SC-IAM-12 | FD-03 多租户架构   | BC-11协作需求       | 租户IAM初始化    |
    | SC-IAM-14 | FD-01 统一身份认证 | UR企业集成需求      | LDAP认证集成职责 |
    | SC-IAM-16 | FD-05 系统配置管理 | UP-09/UR-10管理需求 | 系统配置管理     |

    表 3.2.5-2 系统场景来源追溯

## 3.3 场景汇总

+   BC-10场景按模块和版本汇总如下表所示

    | 模块     | P1场景数 | P2场景数 | P3场景数 | 合计   |
    | -------- | -------- | -------- | -------- | ------ |
    | 认证管理 | 3        | 1        | 1        | 5      |
    | 用户管理 | 5        | 0        | 0        | 5      |
    | 授权管理 | 2        | 0        | 0        | 2      |
    | 审计管理 | 1        | 0        | 0        | 1      |
    | 系统场景 | 2        | 1        | 0        | 3      |
    | **合计** | **13**   | **2**    | **1**    | **16** |

    表 3.3-1 BC-10场景汇总

## 3.4 场景详细定义

### 3.4.1 SC-IAM-01 用户注册

+   场景定义如下表所示

    | 属性        | 内容                                   |
    | ----------- | -------------------------------------- |
    | 场景编号    | SC-IAM-01                              |
    | 场景名称    | 用户注册                               |
    | 所属模块    | 用户管理                               |
    | 需求来源    | FD-01 统一身份认证                     |
    | 触发条件    | 个人用户访问知识消费平台，选择注册账号 |
    | 前置条件    | 用户未拥有系统账号                     |
    | 参与角色    | UC-01 知识访客                         |
    | 业务目标    | 完成账号注册，成为系统用户             |
    | 业务价值    | 获取用户，扩大平台用户基础             |
    | 归属Feature | FT-IAM-01 用户注册与激活               |

    表 3.4.1-1 SC-IAM-01场景定义

+   场景主流程如下

    | 步骤 | 操作者 | 操作描述                        |
    | ---- | ------ | ------------------------------- |
    | 1    | 用户   | 点击"注册"按钮，进入注册页面    |
    | 2    | 用户   | 填写手机号/邮箱，获取验证码     |
    | 3    | 系统   | 发送验证码到用户手机/邮箱       |
    | 4    | 用户   | 输入验证码，完成验证            |
    | 5    | 用户   | 设置密码，填写基本信息          |
    | 6    | 用户   | 阅读并同意用户协议和隐私政策    |
    | 7    | 用户   | 点击"完成注册"                  |
    | 8    | 系统   | 创建用户账号，发送欢迎邮件/短信 |
    | 9    | 系统   | 跳转到登录页面或直接登录        |

    表 3.4.1-2 SC-IAM-01主流程

+   分支流程如下

    | 分支编号 | 分支条件             | 处理方式                       |
    | -------- | -------------------- | ------------------------------ |
    | B1       | 用户选择邮箱注册     | 发送邮箱验证码，验证后继续     |
    | B2       | 用户选择手机号注册   | 发送短信验证码，验证后继续     |
    | B3       | 用户选择社交账号注册 | 跳转第三方授权，获取信息后继续 |

    表 3.4.1-3 SC-IAM-01分支流程

+   异常流程如下

    | 异常编号 | 异常条件             | 处理方式                 |
    | -------- | -------------------- | ------------------------ |
    | E1       | 手机号/邮箱已被注册  | 提示已注册，引导找回密码 |
    | E2       | 验证码错误或过期     | 提示错误，允许重新获取   |
    | E3       | 密码不符合复杂度要求 | 提示规则，要求重新输入   |
    | E4       | 验证码发送频率超限   | 提示稍后重试，显示倒计时 |

    表 3.4.1-4 SC-IAM-01异常流程

### 3.4.2 SC-IAM-02 用户登录认证

+   场景定义如下表所示

    | 属性        | 内容                               |
    | ----------- | ---------------------------------- |
    | 场景编号    | SC-IAM-02                          |
    | 场景名称    | 用户登录认证                       |
    | 所属模块    | 用户管理                           |
    | 需求来源    | FD-01 统一身份认证                 |
    | 触发条件    | 用户访问系统，需要进行身份验证     |
    | 前置条件    | 用户已拥有有效账号                 |
    | 参与角色    | 所有角色                           |
    | 业务目标    | 验证用户身份，获取系统访问权限     |
    | 业务价值    | 确保系统安全，只有合法用户才能访问 |
    | 归属Feature | FT-IAM-02 登录认证                 |

    表 3.4.2-1 SC-IAM-02场景定义

+   场景主流程如下

    | 步骤 | 操作者 | 操作描述                               |
    | ---- | ------ | -------------------------------------- |
    | 1    | 用户   | 访问系统，进入登录页面                 |
    | 2    | 用户   | 输入用户名（手机号/邮箱/用户名）       |
    | 3    | 用户   | 输入密码                               |
    | 4    | 用户   | 点击"登录"按钮                         |
    | 5    | 系统   | 验证用户凭证                           |
    | 6    | 系统   | 签发访问令牌（Access Token）和刷新令牌 |
    | 7    | 系统   | 记录登录日志                           |
    | 8    | 系统   | 跳转到目标页面或首页                   |

    表 3.4.2-2 SC-IAM-02主流程

+   分支流程如下

    | 分支编号 | 分支条件     | 处理方式                       |
    | -------- | ------------ | ------------------------------ |
    | B1       | 租户用户登录 | 需额外输入租户标识或从域名识别 |
    | B2       | 勾选"记住我" | 延长Token有效期或签发记住令牌  |
    | B3       | 首次登录     | 引导修改初始密码               |
    | B4       | 密码即将过期 | 提示修改密码                   |

    表 3.4.2-3 SC-IAM-02分支流程

+   异常流程如下

    | 异常编号 | 异常条件         | 处理方式                           |
    | -------- | ---------------- | ---------------------------------- |
    | E1       | 用户名或密码错误 | 提示错误，记录失败次数             |
    | E2       | 连续失败超过5次  | 账号锁定15分钟，通知用户           |
    | E3       | 账号已被禁用     | 提示账号状态，引导联系管理员       |
    | E4       | 账号已过期       | 提示账号过期，引导续期或联系管理员 |
    | E5       | 密码已过期       | 强制跳转密码修改页面               |
    | E6       | 租户已被停用     | 提示租户状态，引导联系运营         |

    表 3.4.2-4 SC-IAM-02异常流程

### 3.4.3 SC-IAM-03 密码管理

+   场景定义如下表所示

    | 属性        | 内容                           |
    | ----------- | ------------------------------ |
    | 场景编号    | SC-IAM-03                      |
    | 场景名称    | 密码管理                       |
    | 所属模块    | 用户管理                       |
    | 需求来源    | FD-01 统一身份认证             |
    | 触发条件    | 用户需要修改密码或找回密码     |
    | 前置条件    | 用户已拥有系统账号             |
    | 参与角色    | 所有角色                       |
    | 业务目标    | 安全地修改或重置用户密码       |
    | 业务价值    | 保障账号安全，支持用户自助服务 |
    | 归属Feature | FT-IAM-03 密码管理             |

    表 3.4.3-1 SC-IAM-03场景定义

+   场景主流程（修改密码）如下

    | 步骤 | 操作者 | 操作描述                   |
    | ---- | ------ | -------------------------- |
    | 1    | 用户   | 登录系统，进入个人设置     |
    | 2    | 用户   | 选择"修改密码"功能         |
    | 3    | 用户   | 输入当前密码               |
    | 4    | 用户   | 输入新密码并确认           |
    | 5    | 系统   | 验证当前密码正确性         |
    | 6    | 系统   | 验证新密码符合复杂度要求   |
    | 7    | 系统   | 验证新密码不与历史密码重复 |
    | 8    | 系统   | 更新密码，记录密码变更日志 |
    | 9    | 系统   | 通知用户密码修改成功       |

    表 3.4.3-2 SC-IAM-03主流程（修改密码）

+   场景主流程（找回密码）如下

    | 步骤 | 操作者 | 操作描述                  |
    | ---- | ------ | ------------------------- |
    | 1    | 用户   | 在登录页面点击"忘记密码"  |
    | 2    | 用户   | 输入注册手机号/邮箱       |
    | 3    | 系统   | 发送验证码到用户手机/邮箱 |
    | 4    | 用户   | 输入验证码完成身份验证    |
    | 5    | 用户   | 设置新密码并确认          |
    | 6    | 系统   | 更新密码，使所有会话失效  |
    | 7    | 系统   | 记录密码重置日志          |
    | 8    | 系统   | 通知用户密码重置成功      |

    表 3.4.3-3 SC-IAM-03主流程（找回密码）

+   异常流程如下

    | 异常编号 | 异常条件               | 处理方式               |
    | -------- | ---------------------- | ---------------------- |
    | E1       | 当前密码错误           | 提示错误，记录失败次数 |
    | E2       | 新密码不符合复杂度要求 | 提示规则，要求重新输入 |
    | E3       | 新密码与历史密码重复   | 提示不能使用近N次密码  |
    | E4       | 验证码错误或过期       | 提示错误，允许重新获取 |
    | E5       | 手机号/邮箱未注册      | 提示未找到账号         |

    表 3.4.3-4 SC-IAM-03异常流程

+   密码策略配置项如下表所示

    | 配置项            | 配置项名称     | UP默认值 | UR默认值 | UC默认值 | 说明                   |
    | ----------------- | -------------- | -------- | -------- | -------- | ---------------------- |
    | min_length        | 最小长度       | 12       | 8        | 6        | 密码最小字符数         |
    | require_uppercase | 需要大写字母   | 是       | 是       | 否       | 至少包含1个大写字母    |
    | require_lowercase | 需要小写字母   | 是       | 是       | 否       | 至少包含1个小写字母    |
    | require_digit     | 需要数字       | 是       | 是       | 否       | 至少包含1个数字        |
    | require_special   | 需要特殊字符   | 是       | 否       | 否       | 至少包含1个特殊字符    |
    | max_age_days      | 有效期（天）   | 90       | 180      | 0        | 0表示永不过期          |
    | history_count     | 历史密码检查数 | 5        | 3        | 0        | 不能与最近N次密码相同  |
    | lockout_threshold | 锁定阈值       | 5        | 5        | 10       | 连续错误次数达到后锁定 |
    | lockout_duration  | 锁定时长（分） | 30       | 15       | 5        | 自动解锁等待时间       |

    表 3.4.3-5 密码策略配置项

+   密码策略业务规则：
    -   **BR-PWD-01**：UP用户群密码策略由平台统一配置，不可由租户覆盖
    -   **BR-PWD-02**：UR用户群密码策略可由租户管理员在平台默认值基础上调整，但不能低于平台最低要求
    -   **BR-PWD-03**：UC用户群密码策略较为宽松，以便捷性为优先
    -   **BR-PWD-04**：密码修改后，该用户所有已登录会话的Token立即失效
    -   **BR-PWD-05**：密码重置后，用户首次登录必须修改密码

### 3.4.4 SC-IAM-04 会话管理

+   场景定义如下表所示

    | 属性        | 内容                             |
    | ----------- | -------------------------------- |
    | 场景编号    | SC-IAM-04                        |
    | 场景名称    | 会话管理                         |
    | 所属模块    | 用户管理                         |
    | 需求来源    | FD-01 统一身份认证               |
    | 触发条件    | 用户登录后系统需要管理其会话状态 |
    | 前置条件    | 用户已通过身份认证               |
    | 参与角色    | 所有角色                         |
    | 业务目标    | 管理用户会话，保障访问安全       |
    | 业务价值    | 防止会话劫持，支持多设备管理     |
    | 归属Feature | FT-IAM-04 会话与Token管理        |

    表 3.4.4-1 SC-IAM-04场景定义

+   场景主流程如下

    | 步骤 | 操作者 | 操作描述                                |
    | ---- | ------ | --------------------------------------- |
    | 1    | 系统   | 用户登录成功后创建会话记录              |
    | 2    | 系统   | 签发Access Token（短期有效）            |
    | 3    | 系统   | 签发Refresh Token（长期有效）           |
    | 4    | 用户   | 使用Access Token访问受保护资源          |
    | 5    | 系统   | 验证Token有效性                         |
    | 6    | 系统   | Access Token过期时使用Refresh Token刷新 |
    | 7    | 用户   | 用户主动登出或会话超时                  |
    | 8    | 系统   | 使Token失效，清除会话记录               |

    表 3.4.4-2 SC-IAM-04主流程

+   分支流程如下

    | 分支编号 | 分支条件           | 处理方式              |
    | -------- | ------------------ | --------------------- |
    | B1       | 用户查看在线设备   | 显示所有活跃会话列表  |
    | B2       | 用户踢出其他设备   | 使指定会话的Token失效 |
    | B3       | 管理员强制下线用户 | 使该用户所有Token失效 |
    | B4       | 检测到并发会话超限 | 踢出最早的会话        |

    表 3.4.4-3 SC-IAM-04分支流程

+   Access Token结构（JWT Payload）如下表所示

    | 字段名     | 说明          | 示例值                           |
    | ---------- | ------------- | -------------------------------- |
    | jti        | Token唯一标识 | "a1b2c3d4-e5f6-7890-abcd-ef1234" |
    | sub        | 用户ID        | "user_123456"                    |
    | userPool   | 用户群        | "UR"                             |
    | tenantCode | 租户编码      | "acme_corp"（仅UR用户）          |
    | tenantId   | 租户ID        | "tenant_789"（仅UR用户）         |
    | username   | 用户名        | "zhangsan"                       |
    | userType   | 用户类型      | "ur_user"                        |
    | sessionId  | 会话ID        | "sess_abc123"                    |
    | iat        | 签发时间      | 1706745600                       |
    | exp        | 过期时间      | 1706749200                       |

    表 3.4.4-4 Access Token结构

+   会话并发控制规则如下表所示

    | 用户群 | 默认并发数 | 可配置 | 超限处理策略 | 说明                     |
    | ------ | ---------- | ------ | ------------ | ------------------------ |
    | UP     | 1          | 否     | 踢出旧会话   | 安全要求最高，单设备登录 |
    | UR     | 3          | 是     | 踢出最早会话 | 租户可配置1-5            |
    | UC     | 5          | 否     | 踢出最早会话 | 便捷性优先               |

    表 3.4.4-5 会话并发控制规则

+   会话管理业务规则：
    -   **BR-SESS-01**：Access Token有效期默认30分钟，Refresh Token有效期默认7天
    -   **BR-SESS-02**：用户主动登出时，Access Token和Refresh Token同时失效
    -   **BR-SESS-03**：密码修改、角色变更、账号禁用时，该用户所有会话立即失效
    -   **BR-SESS-04**：管理员可强制下线指定用户的所有会话
    -   **BR-SESS-05**：会话超时（无操作）时间默认30分钟，可配置

### 3.4.5 SC-IAM-05 平台用户管理

+   场景定义如下表所示

    | 属性        | 内容                               |
    | ----------- | ---------------------------------- |
    | 场景编号    | SC-IAM-05                          |
    | 场景名称    | 平台用户管理                       |
    | 所属模块    | 用户管理                           |
    | 需求来源    | FD-01 统一身份认证                 |
    | 触发条件    | 平台管理员需要管理平台运营人员账号 |
    | 前置条件    | 操作者具有平台用户管理权限         |
    | 参与角色    | UP-09 平台管理员                   |
    | 业务目标    | 管理平台运营人员的账号生命周期     |
    | 业务价值    | 确保平台运营团队有序管理           |
    | 归属Feature | FT-IAM-05 平台用户管理             |

    表 3.4.5-1 SC-IAM-05场景定义

+   场景主流程如下

    | 步骤 | 操作者     | 操作描述                             |
    | ---- | ---------- | ------------------------------------ |
    | 1    | 平台管理员 | 进入平台用户管理页面                 |
    | 2    | 平台管理员 | 点击"新增用户"                       |
    | 3    | 平台管理员 | 填写用户基本信息（姓名、手机、邮箱） |
    | 4    | 平台管理员 | 分配平台角色                         |
    | 5    | 平台管理员 | 设置账号有效期                       |
    | 6    | 平台管理员 | 提交创建                             |
    | 7    | 系统       | 生成初始密码，发送给用户             |
    | 8    | 系统       | 记录用户创建日志                     |

    表 3.4.5-2 SC-IAM-05主流程

+   分支流程如下

    | 分支编号 | 分支条件     | 处理方式                   |
    | -------- | ------------ | -------------------------- |
    | B1       | 编辑用户信息 | 修改基本信息、角色、状态   |
    | B2       | 禁用用户     | 设置状态为禁用，使会话失效 |
    | B3       | 启用用户     | 恢复账号状态               |
    | B4       | 重置密码     | 生成新密码，发送给用户     |
    | B5       | 删除用户     | 逻辑删除，保留审计数据     |

    表 3.4.5-3 SC-IAM-05分支流程

+   账号激活机制说明：
    -   **BR-ACT-01**：管理员创建用户后，系统发送激活邮件/短信，包含激活链接
    -   **BR-ACT-02**：激活链接有效期为24小时，过期后需管理员重新发送
    -   **BR-ACT-03**：用户点击激活链接后，设置初始密码，账号状态变为ACTIVE
    -   **BR-ACT-04**：用户首次登录必须修改密码（如果使用系统生成的初始密码）

+   用户获取模式配置（仅UR用户群适用）如下表所示

    | 模式编码        | 模式名称   | 说明                               | 适用场景             |
    | --------------- | ---------- | ---------------------------------- | -------------------- |
    | ADMIN_CREATE    | 管理员创建 | 仅允许管理员创建用户               | 大型企业、安全要求高 |
    | OPEN_REGISTER   | 开放注册   | 允许用户自主注册，管理员审批       | 中小企业             |
    | ENTERPRISE_SYNC | 企业同步   | 从AD/LDAP同步用户，不允许手动创建  | 企业目录集成         |
    | HYBRID          | 混合模式   | 管理员创建+开放注册+企业同步均支持 | 复杂场景             |

    表 3.4.5-4 用户获取模式配置

### 3.4.6 SC-IAM-06 租户用户管理

+   场景定义如下表所示

    | 属性        | 内容                               |
    | ----------- | ---------------------------------- |
    | 场景编号    | SC-IAM-06                          |
    | 场景名称    | 租户用户管理                       |
    | 所属模块    | 用户管理                           |
    | 需求来源    | FD-01 统一身份认证                 |
    | 触发条件    | 租户管理员需要管理本租户的用户账号 |
    | 前置条件    | 操作者具有租户用户管理权限         |
    | 参与角色    | UR-10 租户管理员                   |
    | 业务目标    | 管理租户内员工的账号生命周期       |
    | 业务价值    | 支撑租户自主管理用户，实现责任到人 |
    | 归属Feature | FT-IAM-06 租户用户管理             |

    表 3.4.6-1 SC-IAM-06场景定义

+   场景主流程如下

    | 步骤 | 操作者     | 操作描述                                   |
    | ---- | ---------- | ------------------------------------------ |
    | 1    | 租户管理员 | 进入用户管理页面                           |
    | 2    | 租户管理员 | 点击"新增用户"                             |
    | 3    | 租户管理员 | 填写用户基本信息（姓名、工号、手机、邮箱） |
    | 4    | 租户管理员 | 选择所属部门                               |
    | 5    | 租户管理员 | 选择岗位                                   |
    | 6    | 租户管理员 | 分配角色                                   |
    | 7    | 租户管理员 | 提交创建                                   |
    | 8    | 系统       | 检查用户数是否超过租户配额                 |
    | 9    | 系统       | 生成初始密码，发送给用户                   |
    | 10   | 系统       | 记录用户创建日志                           |

    表 3.4.6-2 SC-IAM-06主流程

+   分支流程如下

    | 分支编号 | 分支条件     | 处理方式                       |
    | -------- | ------------ | ------------------------------ |
    | B1       | 批量导入用户 | 上传Excel模板，批量创建        |
    | B2       | 编辑用户信息 | 修改基本信息、部门、岗位、角色 |
    | B3       | 用户离职处理 | 禁用账号、转移数据、回收权限   |
    | B4       | 用户调岗处理 | 更新部门、岗位、角色           |
    | B5       | 重置密码     | 生成新密码，发送给用户         |

    表 3.4.6-3 SC-IAM-06分支流程

+   异常流程如下

    | 异常编号 | 异常条件           | 处理方式                   |
    | -------- | ------------------ | -------------------------- |
    | E1       | 用户数超过租户配额 | 提示配额已满，引导升级套餐 |
    | E2       | 手机号/邮箱已存在  | 提示重复，检查是否为同一人 |
    | E3       | 必填字段缺失       | 提示补充必填信息           |

    表 3.4.6-4 SC-IAM-06异常流程

+   组织架构核心概念定义如下表所示

    | 概念 | 英文名称     | 定义                           | 与用户关系                 |
    | ---- | ------------ | ------------------------------ | -------------------------- |
    | 组织 | Organization | 租户的组织单元树状结构         | 一个租户有且仅有一棵组织树 |
    | 部门 | Department   | 组织下的职能单元，支持多级嵌套 | 用户可归属于一个部门       |
    | 岗位 | Position     | 部门下的职责定义               | 用户可任职于多个岗位       |
    | 人员 | Person       | 组织中的自然人，区别于登录账号 | 人员与用户1:0..1关联       |
    | 任职 | Employment   | 人员与岗位的关联关系           | 支持主岗和兼职             |

    表 3.4.7-5 组织架构核心概念

+   人员与用户的关系说明：
    -   **用户（User）**：可登录系统的账号，核心职责是身份认证
    -   **人员（Person）**：组织中的自然人，核心职责是业务归属和责任划分
    -   **关系**：一个人员最多关联一个用户账号；一个用户最多关联一个人员
    -   **典型场景**：
        -   需要登录的员工：既有人员记录，也有用户账号
        -   不需要登录的员工（如外包、顾问）：只有人员记录，无用户账号
        -   自助注册的用户：先有用户账号，后续可由管理员关联到人员

+   场景主流程（人员管理）如下

    | 步骤 | 操作者     | 操作描述                                   |
    | ---- | ---------- | ------------------------------------------ |
    | 1    | 租户管理员 | 进入人员管理页面                           |
    | 2    | 租户管理员 | 点击"新增人员"                             |
    | 3    | 租户管理员 | 填写人员基本信息（姓名、工号、手机、邮箱） |
    | 4    | 租户管理员 | 选择所属部门                               |
    | 5    | 租户管理员 | 配置任职信息（岗位、主岗/兼职）            |
    | 6    | 租户管理员 | 可选：关联用户账号或创建新账号             |
    | 7    | 租户管理员 | 提交创建                                   |
    | 8    | 系统       | 创建人员记录，建立任职关联                 |

    表 3.4.7-6 SC-IAM-08主流程（人员管理）

+   任职关系类型如下表所示

    | 任职类型 | 说明               | 数量限制        |
    | -------- | ------------------ | --------------- |
    | 主岗     | 人员的主要职责岗位 | 每人有且仅有1个 |
    | 兼岗     | 人员的兼职岗位     | 每人可有0~N个   |

    表 3.4.7-7 任职关系类型

+   用户与人员的关系说明：
    -   **用户（User）**：登录账号，属于认证实体，用于身份验证
    -   **人员（Person）**：组织成员，属于业务实体，用于组织归属
    -   **关系模式**：
        -   一对一关联：大多数情况下，一个用户对应一个人员
        -   仅有用户：系统账号、API账号可能没有关联人员
        -   仅有人员：预创建的组织成员可能暂时没有关联账号
    -   **关联时机**：
        -   管理员创建：创建用户时可选择是否同时创建人员
        -   开放注册：注册成功后自动创建人员记录
        -   企业同步：同步用户时根据配置决定是否同步人员信息

+   用户与人员关系业务规则：
    -   **BR-USER-ORG-01**：用户可以独立存在，不强制关联人员
    -   **BR-USER-ORG-02**：人员可以独立存在，不强制关联用户
    -   **BR-USER-ORG-03**：一个用户最多关联一个人员记录
    -   **BR-USER-ORG-04**：一个人员最多关联一个用户账号

+   汇报关系类型如下表所示

    | 汇报类型 | 说明                     | 来源             |
    | -------- | ------------------------ | ---------------- |
    | 行政汇报 | 部门负责人               | 自动继承部门设置 |
    | 直接汇报 | 直属上级                 | 人员记录中配置   |
    | 虚线汇报 | 矩阵式组织中的跨部门汇报 | 人员记录中配置   |

    表 3.4.7-8 汇报关系类型

### 3.4.7 SC-IAM-08 组织架构管理

+   场景定义如下表所示

    | 属性        | 内容                               |
    | ----------- | ---------------------------------- |
    | 场景编号    | SC-IAM-08                          |
    | 场景名称    | 组织架构管理                       |
    | 所属模块    | 用户管理                           |
    | 需求来源    | FD-01 统一身份认证                 |
    | 触发条件    | 租户管理员需要维护组织架构信息     |
    | 前置条件    | 操作者具有组织架构管理权限         |
    | 参与角色    | UR-10 租户管理员                   |
    | 业务目标    | 维护租户的部门、岗位等组织架构信息 |
    | 业务价值    | 支撑岗位责任映射，实现合规责任到人 |
    | 归属Feature | FT-IAM-08 组织架构管理             |

    表 3.4.7-1 SC-IAM-08场景定义

+   场景主流程（部门管理）如下

    | 步骤 | 操作者     | 操作描述                           |
    | ---- | ---------- | ---------------------------------- |
    | 1    | 租户管理员 | 进入组织架构管理页面               |
    | 2    | 租户管理员 | 查看当前组织架构树                 |
    | 3    | 租户管理员 | 选择父部门，点击"新增子部门"       |
    | 4    | 租户管理员 | 填写部门名称、部门编码、部门负责人 |
    | 5    | 租户管理员 | 提交创建                           |
    | 6    | 系统       | 创建部门，更新组织架构树           |

    表 3.4.7-2 SC-IAM-08主流程（部门管理）

+   场景主流程（岗位管理）如下

    | 步骤 | 操作者     | 操作描述                         |
    | ---- | ---------- | -------------------------------- |
    | 1    | 租户管理员 | 进入岗位管理页面                 |
    | 2    | 租户管理员 | 点击"新增岗位"                   |
    | 3    | 租户管理员 | 填写岗位名称、岗位编码、所属部门 |
    | 4    | 租户管理员 | 填写岗位职责描述                 |
    | 5    | 租户管理员 | 提交创建                         |
    | 6    | 系统       | 创建岗位记录                     |

    表 3.4.7-3 SC-IAM-08主流程（岗位管理）

+   分支流程如下

    | 分支编号 | 分支条件     | 处理方式               |
    | -------- | ------------ | ---------------------- |
    | B1       | 编辑部门信息 | 修改部门名称、负责人等 |
    | B2       | 删除部门     | 检查是否有子部门和用户 |
    | B3       | 移动部门     | 调整部门的上级部门     |
    | B4       | 编辑岗位信息 | 修改岗位名称、职责等   |
    | B5       | 删除岗位     | 检查是否有关联用户     |

    表 3.4.7-4 SC-IAM-08分支流程

### 3.4.8 SC-IAM-09 角色管理

+   场景定义如下表所示

    | 属性        | 内容                               |
    | ----------- | ---------------------------------- |
    | 场景编号    | SC-IAM-09                          |
    | 场景名称    | 角色管理                           |
    | 所属模块    | 用户管理                           |
    | 需求来源    | FD-01 统一身份认证                 |
    | 触发条件    | 管理员需要管理系统角色             |
    | 前置条件    | 操作者具有角色管理权限             |
    | 参与角色    | UP-09 平台管理员、UR-10 租户管理员 |
    | 业务目标    | 定义和管理系统角色                 |
    | 业务价值    | 通过角色实现权限的批量管理         |
    | 归属Feature | FT-IAM-09 角色管理                 |

    表 3.4.8-1 SC-IAM-09场景定义

+   场景主流程如下

    | 步骤 | 操作者 | 操作描述                          |
    | ---- | ------ | --------------------------------- |
    | 1    | 管理员 | 进入角色管理页面                  |
    | 2    | 管理员 | 点击"新增角色"                    |
    | 3    | 管理员 | 填写角色名称、角色编码、角色描述  |
    | 4    | 管理员 | 选择角色类型（平台角色/租户角色） |
    | 5    | 管理员 | 配置角色的功能权限                |
    | 6    | 管理员 | 配置角色的数据权限范围            |
    | 7    | 管理员 | 提交创建                          |
    | 8    | 系统   | 创建角色，记录操作日志            |

    表 3.4.8-2 SC-IAM-09主流程

+   分支流程如下

    | 分支编号 | 分支条件     | 处理方式                   |
    | -------- | ------------ | -------------------------- |
    | B1       | 编辑角色     | 修改角色信息和权限配置     |
    | B2       | 复制角色     | 基于现有角色快速创建新角色 |
    | B3       | 禁用角色     | 禁用后该角色用户权限失效   |
    | B4       | 删除角色     | 检查是否有关联用户         |
    | B5       | 查看角色用户 | 查看拥有该角色的用户列表   |

    表 3.4.8-3 SC-IAM-09分支流程

+   预置角色与自定义角色的区别如下表所示

    | 维度     | 预置角色                       | 自定义角色                     |
    | -------- | ------------------------------ | ------------------------------ |
    | 定义方   | 平台统一定义                   | 租户管理员定义                 |
    | 存储位置 | 平台库（clarisphere_platform） | 租户库（clarisphere_<tenant>） |
    | 可编辑性 | 只读，不可修改                 | 可编辑、可删除                 |
    | 适用范围 | 全部用户群                     | 仅UR用户群                     |
    | 同步机制 | 租户IAM初始化时自动同步        | -                              |

    表 3.4.8-4 预置角色与自定义角色的区别

+   UP用户群预置角色目录如下表所示

    | 角色编码          | 角色名称   | 数据权限 | 功能权限范围               |
    | ----------------- | ---------- | -------- | -------------------------- |
    | platform_admin    | 平台管理员 | 全部     | 全部平台管理功能           |
    | platform_operator | 平台运营员 | 全部     | 租户管理、用户管理（只读） |
    | platform_auditor  | 平台审计员 | 全部     | 审计日志查询（只读）       |

    表 3.4.8-5 UP用户群预置角色目录

+   UR用户群预置角色目录如下表所示

    | 角色编码       | 角色名称   | 数据权限     | 功能权限范围         |
    | -------------- | ---------- | ------------ | -------------------- |
    | tenant_admin   | 租户管理员 | 全部数据     | 全部租户管理功能     |
    | dept_admin     | 部门管理员 | 本部门及下级 | 部门内用户、组织管理 |
    | security_admin | 安全管理员 | 全部数据     | 审计日志、安全配置   |
    | normal_user    | 普通用户   | 仅本人数据   | 基础业务功能         |

    表 3.4.8-6 UR用户群预置角色目录

+   UC用户群预置角色目录（基于订阅级别自动分配）如下表所示

    | 角色编码      | 角色名称 | 对应订阅级别 | 功能权限范围           |
    | ------------- | -------- | ------------ | ---------------------- |
    | uc_guest      | 访客     | GUEST        | 仅浏览公开内容         |
    | uc_free       | 免费用户 | FREE         | 基础搜索、有限浏览     |
    | uc_basic      | 基础会员 | BASIC        | 标准搜索、下载配额     |
    | uc_premium    | 高级会员 | PREMIUM      | 高级搜索、更高下载配额 |
    | uc_enterprise | 企业会员 | ENTERPRISE   | 全功能、API访问        |

    表 3.4.8-7 UC用户群预置角色目录

+   角色管理业务规则：
    -   **BR-ROLE-01**：预置角色只读，租户不可修改或删除
    -   **BR-ROLE-02**：自定义角色编码必须以"custom_"前缀开头
    -   **BR-ROLE-03**：删除角色前必须解除所有用户的角色关联
    -   **BR-ROLE-04**：角色支持互斥配置，互斥角色不能同时分配给同一用户

### 3.4.9 SC-IAM-10 权限配置

+   场景定义如下表所示

    | 属性        | 内容                               |
    | ----------- | ---------------------------------- |
    | 场景编号    | SC-IAM-10                          |
    | 场景名称    | 权限配置                           |
    | 所属模块    | 用户管理                           |
    | 需求来源    | FD-01 统一身份认证                 |
    | 触发条件    | 管理员需要配置用户或角色的权限     |
    | 前置条件    | 操作者具有权限配置权限             |
    | 参与角色    | UP-09 平台管理员、UR-10 租户管理员 |
    | 业务目标    | 实现细粒度的功能和数据权限控制     |
    | 业务价值    | 确保用户只能访问授权的功能和数据   |
    | 归属Feature | FT-IAM-10 权限配置                 |

    表 3.4.9-1 SC-IAM-10场景定义

+   场景主流程（角色权限配置）如下

    | 步骤 | 操作者 | 操作描述                           |
    | ---- | ------ | ---------------------------------- |
    | 1    | 管理员 | 进入角色管理，选择目标角色         |
    | 2    | 管理员 | 点击"权限配置"                     |
    | 3    | 管理员 | 在功能权限树中勾选授权的菜单和按钮 |
    | 4    | 管理员 | 配置数据权限范围                   |
    | 5    | 管理员 | 保存权限配置                       |
    | 6    | 系统   | 更新权限缓存                       |
    | 7    | 系统   | 记录权限变更日志                   |

    表 3.4.9-2 SC-IAM-10主流程

+   数据权限范围选项如下表所示

    | 数据权限范围 | 说明                             |
    | ------------ | -------------------------------- |
    | 仅本人数据   | 只能查看自己创建或负责的数据     |
    | 本部门数据   | 可查看本部门所有人的数据         |
    | 本部门及下级 | 可查看本部门及所有下级部门的数据 |
    | 全部数据     | 可查看所有数据（不受部门限制）   |
    | 自定义       | 可指定具体部门范围               |

    表 3.4.9-3 数据权限范围选项

+   权限资源类型定义如下表所示

    | 资源类型 | 英文名称 | 说明         | 示例               |
    | -------- | -------- | ------------ | ------------------ |
    | ROUTE    | 路由     | 前端页面路由 | /user/list         |
    | MENU     | 菜单     | 导航菜单项   | 用户管理           |
    | BUTTON   | 按钮     | 页面操作按钮 | 新增用户、删除用户 |
    | API      | 接口     | 后端API接口  | POST /api/v1/users |

    表 3.4.9-4 权限资源类型

+   权限标识命名规范：采用四段式命名 `{userPool}:{module}:{resource}:{action}`

    | 段位     | 说明     | 取值范围                                   | 示例   |
    | -------- | -------- | ------------------------------------------ | ------ |
    | userPool | 用户群   | up, ur, uc                                 | ur     |
    | module   | 功能模块 | iam, content, compliance等                 | iam    |
    | resource | 资源对象 | user, role, dept, audit等                  | user   |
    | action   | 操作动作 | create, read, update, delete, list, export | create |

    表 3.4.9-5 权限标识命名规范

+   权限标识示例如下表所示

    | 权限标识            | 说明                  | 资源类型 |
    | ------------------- | --------------------- | -------- |
    | ur:iam:user:create  | UR用户群-创建用户     | API      |
    | ur:iam:user:list    | UR用户群-查询用户列表 | MENU     |
    | ur:iam:role:update  | UR用户群-修改角色     | BUTTON   |
    | up:iam:audit:export | UP用户群-导出审计日志 | BUTTON   |

    表 3.4.9-6 权限标识示例

+   权限配置业务规则：
    -   **BR-PERM-01**：权限资源点在平台库全局唯一定义，各租户共享
    -   **BR-PERM-02**：功能权限采用白名单模式，未授权即禁止
    -   **BR-PERM-03**：数据权限与功能权限独立配置，取交集生效
    -   **BR-PERM-04**：用户拥有多个角色时，权限取并集

### 3.4.10 SC-IAM-11 审计日志查询

+   场景定义如下表所示

    | 属性        | 内容                             |
    | ----------- | -------------------------------- |
    | 场景编号    | SC-IAM-11                        |
    | 场景名称    | 审计日志查询                     |
    | 所属模块    | 用户管理                         |
    | 需求来源    | FD-01 统一身份认证               |
    | 触发条件    | 管理员需要查询系统操作记录       |
    | 前置条件    | 操作者具有审计日志查看权限       |
    | 参与角色    | UP-09 平台管理员、UR-01 CISO     |
    | 业务目标    | 查询和分析系统操作日志           |
    | 业务价值    | 支撑安全审计、问题追溯、合规检查 |
    | 归属Feature | FT-IAM-11 审计日志               |

    表 3.4.10-1 SC-IAM-11场景定义

+   场景主流程如下

    | 步骤 | 操作者 | 操作描述                             |
    | ---- | ------ | ------------------------------------ |
    | 1    | 管理员 | 进入审计日志页面                     |
    | 2    | 管理员 | 选择日志类型（登录/操作/安全事件）   |
    | 3    | 管理员 | 设置查询条件（时间、用户、操作类型） |
    | 4    | 管理员 | 点击查询                             |
    | 5    | 系统   | 返回符合条件的日志列表               |
    | 6    | 管理员 | 查看日志详情                         |
    | 7    | 管理员 | 可选择导出日志                       |

    表 3.4.10-2 SC-IAM-11主流程

+   分支流程如下

    | 分支编号 | 分支条件     | 处理方式                       |
    | -------- | ------------ | ------------------------------ |
    | B1       | 导出日志     | 导出为Excel/CSV格式            |
    | B2       | 高级搜索     | 支持更多筛选条件组合           |
    | B3       | 查看登录日志 | 展示登录时间、IP、设备、结果   |
    | B4       | 查看操作日志 | 展示操作类型、对象、时间、结果 |

    表 3.4.10-3 SC-IAM-11分支流程

+   审计日志类型定义如下表所示

    | 日志类型 | 英文名称       | 记录内容                               | 默认保留期 |
    | -------- | -------------- | -------------------------------------- | ---------- |
    | 登录日志 | login_log      | 登录成功、登录失败、登出、Token刷新    | 180天      |
    | 操作日志 | operation_log  | 业务操作（创建、修改、删除、敏感查询） | 180天      |
    | 安全事件 | security_event | 密码修改、MFA变更、账号锁定等安全事件  | 365天      |

    表 3.4.10-4 审计日志类型定义

+   安全事件分类如下表所示

    | 事件编码       | 事件名称 | 触发条件                 | 严重级别 | 是否告警 |
    | -------------- | -------- | ------------------------ | -------- | -------- |
    | PWD_CHANGE     | 密码修改 | 用户修改密码             | INFO     | 否       |
    | PWD_RESET      | 密码重置 | 管理员重置密码或找回密码 | WARN     | 否       |
    | MFA_BINDDED    | MFA绑定  | 用户绑定多因素认证       | INFO     | 否       |
    | MFA_UNBIND     | MFA解绑  | 用户解绑多因素认证       | WARN     | 是       |
    | ACCOUNT_LOCK   | 账号锁定 | 密码错误超限导致锁定     | WARN     | 是       |
    | ACCOUNT_UNLOCK | 账号解锁 | 管理员手动解锁或自动解锁 | INFO     | 否       |
    | ROLE_CHANGE    | 角色变更 | 用户角色被添加或移除     | WARN     | 是       |
    | PERM_CHANGE    | 权限变更 | 角色权限被修改           | WARN     | 是       |

    表 3.4.10-5 安全事件分类

+   审计日志导出规则如下表所示

    | 规则编号 | 规则名称     | 规则内容                           |
    | -------- | ------------ | ---------------------------------- |
    | EXP-01   | 导出格式     | 支持CSV和Excel两种格式             |
    | EXP-02   | 单次数量限制 | 单次导出最多10万条记录             |
    | EXP-03   | 数据脱敏     | 导出时对手机号、邮箱等敏感字段脱敏 |
    | EXP-04   | 导出审计     | 导出操作本身记录到操作日志         |
    | EXP-05   | 权限控制     | 仅具有审计导出权限的用户可执行导出 |

    表 3.4.10-6 审计日志导出规则

### 3.4.11 SC-IAM-12 租户IAM初始化

+   场景定义如下表所示

    | 属性        | 内容                               |
    | ----------- | ---------------------------------- |
    | 场景编号    | SC-IAM-12                          |
    | 场景名称    | 租户IAM初始化                      |
    | 所属模块    | 用户管理                           |
    | 需求来源    | FD-01 统一身份认证                 |
    | 触发条件    | BC-11完成租户数据库创建后调用      |
    | 前置条件    | 租户数据库已创建，数据源已注册     |
    | 参与角色    | 系统（自动触发）                   |
    | 业务目标    | 初始化租户的IAM表结构和基础数据    |
    | 业务价值    | 确保新租户可以正常使用认证授权功能 |
    | 归属Feature | FT-IAM-12 租户IAM初始化            |

    表 3.4.11-1 SC-IAM-12场景定义

+   场景主流程如下

    | 步骤 | 操作者 | 操作描述                       |
    | ---- | ------ | ------------------------------ |
    | 1    | BC-11  | 调用BC-10的租户IAM初始化接口   |
    | 2    | BC-10  | 切换到租户数据源               |
    | 3    | BC-10  | 创建IAM相关表结构              |
    | 4    | BC-10  | 初始化预置角色（租户管理员等） |
    | 5    | BC-10  | 初始化预置权限（全部功能权限） |
    | 6    | BC-10  | 创建租户管理员账号             |
    | 7    | BC-10  | 返回初始化结果给BC-11          |

    表 3.4.11-2 SC-IAM-12主流程

+   租户IAM初始化详细流程如下表所示

    | 步骤 | 执行方 | 操作内容                                | 失败处理               |
    | ---- | ------ | --------------------------------------- | ---------------------- |
    | 1    | BC-11  | 创建租户记录，状态为INITIALIZING        | -                      |
    | 2    | BC-11  | 创建租户数据库clarisphere_<tenant_code> | 标记租户创建失败       |
    | 3    | BC-11  | 创建并注册数据源连接池                  | 删除数据库，标记失败   |
    | 4    | BC-11  | 调用BC-10的租户IAM初始化接口            | -                      |
    | 5    | BC-10  | 切换到租户数据源                        | 返回初始化失败         |
    | 6    | BC-10  | 执行Flyway迁移，创建IAM表结构           | 回滚，返回失败         |
    | 7    | BC-10  | 从平台库同步预置角色到租户库            | 回滚表结构，返回失败   |
    | 8    | BC-10  | 从平台库同步权限资源定义到租户库        | 回滚角色数据，返回失败 |
    | 9    | BC-10  | 创建租户超级管理员账号（关联预置角色）  | 回滚权限数据，返回失败 |
    | 10   | BC-10  | 返回初始化结果（成功/失败+原因）        | -                      |
    | 11   | BC-11  | 更新租户状态为ACTIVE或INIT_FAILED       | -                      |

    表 3.4.11-3 租户IAM初始化详细流程

+   租户IAM初始化创建的表结构清单如下表所示

    | 表名                | 说明           | 数据来源         |
    | ------------------- | -------------- | ---------------- |
    | iam_user            | 用户表         | 初始化时创建超管 |
    | iam_role            | 角色表         | 从平台库同步     |
    | iam_permission      | 权限表         | 从平台库同步     |
    | iam_user_role       | 用户角色关联表 | 初始化时关联     |
    | iam_role_permission | 角色权限关联表 | 从平台库同步     |
    | iam_department      | 部门表         | 空表             |
    | iam_position        | 岗位表         | 空表             |
    | iam_person          | 人员表         | 空表             |
    | iam_employment      | 任职表         | 空表             |
    | iam_login_log       | 登录日志表     | 空表             |
    | iam_operation_log   | 操作日志表     | 空表             |
    | iam_security_event  | 安全事件表     | 空表             |

    表 3.4.11-4 租户IAM表结构清单

+   预置角色同步清单（从平台库同步到租户库）如下表所示

    | 角色编码       | 角色名称   | 数据权限     | 说明             |
    | -------------- | ---------- | ------------ | ---------------- |
    | tenant_admin   | 租户管理员 | 全部数据     | 租户最高管理权限 |
    | dept_admin     | 部门管理员 | 本部门及下级 | 部门级管理权限   |
    | security_admin | 安全管理员 | 全部数据     | 安全和审计权限   |
    | normal_user    | 普通用户   | 仅本人数据   | 基础使用权限     |

    表 3.4.11-5 预置角色同步清单

### 3.4.12 SC-IAM-14 LDAP认证集成

+   场景定义如下表所示

    | 属性        | 内容                               |
    | ----------- | ---------------------------------- |
    | 场景编号    | SC-IAM-14                          |
    | 场景名称    | LDAP认证集成                       |
    | 所属模块    | 系统场景                           |
    | 需求来源    | FD-01 统一身份认证                 |
    | 触发条件    | 租户配置LDAP后，用户使用域账号登录 |
    | 前置条件    | 租户已完成LDAP配置                 |
    | 参与角色    | UR-ALL（租户用户）                 |
    | 业务目标    | 与企业AD/LDAP目录服务集成认证      |
    | 业务价值    | 统一身份管理，降低用户密码管理成本 |
    | 归属Feature | FT-IAM-14 LDAP认证集成             |
    | 目标版本    | P2                                 |

    表 3.4.12-1 SC-IAM-14场景定义

+   场景主流程如下

    | 步骤 | 操作者 | 操作描述                                       |
    | ---- | ------ | ---------------------------------------------- |
    | 1    | 用户   | 在租户登录页选择"域账号登录"                   |
    | 2    | 用户   | 输入域账号用户名（格式：domain\username）      |
    | 3    | 用户   | 输入域账号密码                                 |
    | 4    | 系统   | 根据租户LDAP配置连接LDAP服务器                 |
    | 5    | 系统   | 使用LDAP Bind验证用户凭证                      |
    | 6    | 系统   | 验证成功后查询用户属性（姓名、邮箱、部门等）   |
    | 7    | 系统   | 检查本地是否存在关联账号                       |
    | 8    | 系统   | 若不存在则自动创建本地账号（JIT Provisioning） |
    | 9    | 系统   | 签发Access Token和Refresh Token                |
    | 10   | 系统   | 跳转到租户工作空间                             |

    表 3.4.12-2 SC-IAM-14主流程

+   LDAP配置项如下表所示

    | 配置项                  | 配置名称       | 必填 | 示例值                                      |
    | ----------------------- | -------------- | ---- | ------------------------------------------- |
    | ldap_url                | LDAP服务器地址 | 是   | ldap://192.168.1.100:389                    |
    | ldap_base_dn            | 基础DN         | 是   | dc=example,dc=com                           |
    | ldap_bind_dn            | 绑定账号DN     | 是   | cn=admin,dc=example,dc=com                  |
    | ldap_bind_password      | 绑定账号密码   | 是   | ******                                      |
    | ldap_user_search_base   | 用户搜索基础   | 是   | ou=users,dc=example,dc=com                  |
    | ldap_user_search_filter | 用户搜索过滤器 | 是   | (&(objectClass=person)(sAMAccountName={0})) |
    | ldap_attr_username      | 用户名属性     | 是   | sAMAccountName                              |
    | ldap_attr_email         | 邮箱属性       | 否   | mail                                        |
    | ldap_attr_name          | 姓名属性       | 否   | displayName                                 |
    | ldap_attr_dept          | 部门属性       | 否   | department                                  |
    | ldap_ssl_enabled        | 启用SSL        | 否   | false                                       |

    表 3.4.12-3 LDAP配置项

+   分支流程如下

    | 分支编号 | 分支条件         | 处理方式                           |
    | -------- | ---------------- | ---------------------------------- |
    | B1       | 用户首次LDAP登录 | 自动创建本地账号，同步用户属性     |
    | B2       | 用户已有本地账号 | 更新用户属性（如果LDAP属性有变化） |
    | B3       | LDAP账号被禁用   | 提示"域账号已禁用"                 |
    | B4       | LDAP服务器不可达 | 提示"认证服务暂时不可用"           |

    表 3.4.12-4 SC-IAM-14分支流程

+   异常流程如下

    | 异常编号 | 异常条件             | 处理方式                             |
    | -------- | -------------------- | ------------------------------------ |
    | E1       | LDAP连接超时         | 提示"认证服务响应超时，请稍后重试"   |
    | E2       | 用户名或密码错误     | 提示"域账号或密码错误"               |
    | E3       | 用户不在允许的OU范围 | 提示"您没有访问权限"                 |
    | E4       | 租户LDAP配置无效     | 提示"企业认证配置异常，请联系管理员" |

    表 3.4.12-5 SC-IAM-14异常流程

+   LDAP认证业务规则：
    -   **BR-LDAP-01**：LDAP认证仅适用于UR用户群
    -   **BR-LDAP-02**：LDAP配置由租户管理员在系统配置中维护
    -   **BR-LDAP-03**：首次LDAP登录自动创建的用户，默认分配normal_user角色
    -   **BR-LDAP-04**：LDAP用户的密码由LDAP服务器管理，本系统不存储
    -   **BR-LDAP-05**：LDAP连接失败时，不允许回退到本地密码认证

### 3.4.13 SC-IAM-16 系统配置管理

+   场景定义如下表所示

    | 属性        | 内容                             |
    | ----------- | -------------------------------- |
    | 场景编号    | SC-IAM-16                        |
    | 场景名称    | 系统配置管理                     |
    | 所属模块    | 系统场景                         |
    | 需求来源    | FD-05 系统配置管理（新增）       |
    | 触发条件    | 管理员需要调整系统配置参数       |
    | 前置条件    | 操作者具有系统配置管理权限       |
    | 参与角色    | UP-09平台管理员、UR-10租户管理员 |
    | 业务目标    | 管理平台级和租户级的系统配置     |
    | 业务价值    | 支持个性化配置，满足不同租户需求 |
    | 归属Feature | FT-IAM-16 系统配置管理           |
    | 目标版本    | P1                               |

    表 3.4.13-1 SC-IAM-16场景定义

+   场景主流程（平台配置）如下

    | 步骤 | 操作者     | 操作描述                            |
    | ---- | ---------- | ----------------------------------- |
    | 1    | 平台管理员 | 进入系统配置页面                    |
    | 2    | 平台管理员 | 选择配置分类（认证/安全/功能/审计） |
    | 3    | 平台管理员 | 查看当前配置项及其值                |
    | 4    | 平台管理员 | 修改配置值                          |
    | 5    | 平台管理员 | 保存配置                            |
    | 6    | 系统       | 验证配置值有效性                    |
    | 7    | 系统       | 更新配置缓存                        |
    | 8    | 系统       | 记录配置变更日志                    |

    表 3.4.13-2 SC-IAM-16主流程（平台配置）

+   场景主流程（租户配置）如下

    | 步骤 | 操作者     | 操作描述                                     |
    | ---- | ---------- | -------------------------------------------- |
    | 1    | 租户管理员 | 进入租户设置页面                             |
    | 2    | 租户管理员 | 选择配置分类（认证/安全/功能）               |
    | 3    | 租户管理员 | 查看当前配置项（显示平台默认值和租户覆盖值） |
    | 4    | 租户管理员 | 修改配置值（受平台最低要求限制）             |
    | 5    | 租户管理员 | 保存配置                                     |
    | 6    | 系统       | 验证配置值不低于平台最低要求                 |
    | 7    | 系统       | 更新租户配置                                 |
    | 8    | 系统       | 记录配置变更日志                             |

    表 3.4.13-3 SC-IAM-16主流程（租户配置）

+   IAM相关配置项目录如下表所示

    | 配置分类 | 配置项                       | 平台默认值   | 租户可覆盖 | 说明             |
    | -------- | ---------------------------- | ------------ | ---------- | ---------------- |
    | 认证配置 | password_min_length          | 8            | 是(≥8)     | 密码最小长度     |
    | 认证配置 | password_max_age_days        | 180          | 是         | 密码有效期       |
    | 认证配置 | mfa_required                 | false        | 是         | 是否强制MFA      |
    | 认证配置 | session_timeout_minutes      | 30           | 是         | 会话超时时间     |
    | 安全配置 | lockout_threshold            | 5            | 是(≥3)     | 锁定阈值         |
    | 安全配置 | lockout_duration_minutes     | 15           | 是         | 锁定时长         |
    | 安全配置 | max_concurrent_sessions      | 3            | 是         | 最大并发会话数   |
    | 功能配置 | user_acquisition_mode        | ADMIN_CREATE | 是         | 用户获取模式     |
    | 功能配置 | allow_open_register          | false        | 是         | 是否允许开放注册 |
    | 功能配置 | register_approval_required   | true         | 是         | 注册是否需要审批 |
    | 审计配置 | login_log_retention_days     | 180          | 是(≥90)    | 登录日志保留天数 |
    | 审计配置 | operation_log_retention_days | 180          | 是(≥90)    | 操作日志保留天数 |

    表 3.4.13-4 IAM相关配置项目录

+   配置生效优先级说明：
    -   **优先级顺序**：租户配置 > 平台配置 > 系统默认值
    -   **最低要求限制**：租户配置不能低于平台设定的最低要求（如密码最小长度不能低于8位）
    -   **热更新支持**：配置修改后立即生效，无需重启服务

+   系统配置管理业务规则：
    -   **BR-CFG-01**：配置优先级为 租户配置 > 平台配置 > 系统默认值
    -   **BR-CFG-02**：租户配置不能低于平台定义的最低要求（如密码最小长度）
    -   **BR-CFG-03**：配置修改后立即生效（热更新），无需重启服务
    -   **BR-CFG-04**：所有配置变更必须记录审计日志，包含变更前后值
    -   **BR-CFG-05**：平台配置存储于平台库sys_config表
    -   **BR-CFG-06**：租户配置存储于各租户库tenant_config表

# 4 需求清单

## 4.1 需求层级总览

+   BC-10需求层级按Epic→Feature→Story三层组织
+   需求层级总览如下表所示

    | Epic  | Feature数 | Story数 | P1 Story | P2 Story | P3 Story |
    | ----- | --------- | ------- | -------- | -------- | -------- |
    | EP-37 | 14        | 68      | 62       | 5        | 1        |

    表 4.1-1 需求层级总览

+   Feature按功能模块分组，与第3章场景模块对应
+   Feature清单如下表所示

    | 功能模块 | Feature编号 | Feature名称     | 对应场景  | Story数 | 目标版本 |
    | -------- | ----------- | --------------- | --------- | ------- | -------- |
    | 认证管理 | FT-IAM-02   | 登录认证        | SC-IAM-02 | 5       | P1/P2    |
    | 认证管理 | FT-IAM-03   | 密码管理        | SC-IAM-03 | 4       | P1       |
    | 认证管理 | FT-IAM-04   | 会话与Token管理 | SC-IAM-04 | 4       | P1       |
    | 用户管理 | FT-IAM-01   | 用户注册与激活  | SC-IAM-01 | 4       | P1/P3    |
    | 用户管理 | FT-IAM-05   | 平台用户管理    | SC-IAM-05 | 5       | P1       |
    | 用户管理 | FT-IAM-06   | 租户用户管理    | SC-IAM-06 | 6       | P1       |
    | 用户管理 | FT-IAM-07   | 个人用户管理    | SC-IAM-07 | 3       | P1       |
    | 用户管理 | FT-IAM-08   | 组织架构管理    | SC-IAM-08 | 6       | P1       |
    | 授权管理 | FT-IAM-09   | 角色管理        | SC-IAM-09 | 5       | P1       |
    | 授权管理 | FT-IAM-10   | 权限配置        | SC-IAM-10 | 5       | P1/P2    |
    | 审计管理 | FT-IAM-11   | 审计日志        | SC-IAM-11 | 5       | P1       |
    | 系统场景 | FT-IAM-12   | 租户IAM初始化   | SC-IAM-12 | 6       | P1       |
    | 系统场景 | FT-IAM-16   | 系统配置管理    | SC-IAM-16 | 4       | P1       |

    表 4.1-2 Feature清单

+   Feature清单说明：
    -   FT-IAM-14 LDAP认证集成已合并到FT-IAM-02登录认证中
    -   "目标版本"列显示该Feature包含Story的版本范围
    -   如"P1/P2"表示该Feature的Story分布在P1和P2两个版本
    -   "对应场景"列建立Feature与第3章场景的追溯关系

## 4.2 认证管理模块

+   认证管理模块包含3个Feature，覆盖用户身份验证相关功能
+   认证管理模块Feature汇总如下表所示

    | Feature编号 | Feature名称     | 对应场景  | Story数 | 目标版本 |
    | ----------- | --------------- | --------- | ------- | -------- |
    | FT-IAM-02   | 登录认证        | SC-IAM-02 | 5       | P1/P2    |
    | FT-IAM-03   | 密码管理        | SC-IAM-03 | 4       | P1       |
    | FT-IAM-04   | 会话与Token管理 | SC-IAM-04 | 4       | P1       |

    表 4.2-1 认证管理模块Feature汇总

+   模块说明：
    -   登录认证Feature包含本地登录（P1）和SSO/LDAP登录（P2）
    -   密码管理和会话管理为P1基础能力
    -   多因素认证（SC-IAM-15）将在P3版本作为独立Feature补充

### 4.2.1 FT-IAM-02 登录认证

+   Feature定义如下表所示

    | 属性        | 内容                           |
    | ----------- | ------------------------------ |
    | Feature编号 | FT-IAM-02                      |
    | Feature名称 | 登录认证                       |
    | 所属Epic    | EP-37 平台用户管理             |
    | Feature描述 | 支持多种方式的用户登录认证     |
    | 业务价值    | 验证用户身份，保障系统访问安全 |
    | 目标版本    | P1                             |

    表 4.2.1-1 FT-IAM-02定义

+   User Story清单及验收标准如下表所示

    | Story编号  | User Story                                                   | 角色   | 目标版本 | 规模 |
    | ---------- | ------------------------------------------------------------ | ------ | -------- | ---- |
    | US-IAM-005 | 账号密码登录                                                 | 所有   | P1       | M    |
    |            | 作为用户，我想要使用账号密码登录系统，以便访问系统功能       |        |          |      |
    |            | .AC-01 能填写用户名/手机号/邮箱（必填）                      |        |          |      |
    |            | .AC-02 能填写密码（必填）                                    |        |          |      |
    |            | .AC-03 能勾选"记住我"延长登录状态（可选）                    |        |          |      |
    |            | .AC-04 登录成功后跳转到目标页面或首页                        |        |          |      |
    |            | .AC-05 登录失败时提示"用户名或密码错误"                      |        |          |      |
    |            | .AC-06 连续失败5次后账号锁定15分钟                           |        |          |      |
    |            | .AC-07 登录成功后记录登录日志（时间、IP、设备）              |        |          |      |
    | US-IAM-006 | 租户用户登录                                                 | UR-ALL | P1       | M    |
    |            | 作为租户用户，我想要登录到我所属的租户，以便访问租户系统     |        |          |      |
    |            | .AC-01 能通过租户专属域名自动识别租户                        |        |          |      |
    |            | .AC-02 能手动输入租户标识（租户代号）登录                    |        |          |      |
    |            | .AC-03 租户不存在时提示"租户不存在"                          |        |          |      |
    |            | .AC-04 租户已停用时提示"租户已停用，请联系管理员"            |        |          |      |
    |            | .AC-05 登录成功后进入租户工作空间                            |        |          |      |
    | US-IAM-007 | 验证码登录                                                   | 所有   | P1       | S    |
    |            | 作为用户，我想要使用手机验证码登录，以便在忘记密码时也能登录 |        |          |      |
    |            | .AC-01 能填写手机号（必填，11位手机号格式）                  |        |          |      |
    |            | .AC-02 能点击获取验证码（60秒内不可重复获取）                |        |          |      |
    |            | .AC-03 能填写短信验证码（必填，6位数字）                     |        |          |      |
    |            | .AC-04 验证码正确时登录成功                                  |        |          |      |
    |            | .AC-05 验证码错误或过期时提示错误                            |        |          |      |
    | US-IAM-008 | SSO单点登录                                                  | UR-ALL | P2       | L    |
    |            | 作为租户用户，我想要使用企业SSO登录，以便统一身份管理        |        |          |      |
    |            | .AC-01 租户配置SSO后登录页显示"企业登录"入口                 |        |          |      |
    |            | .AC-02 点击后跳转到企业IdP认证页面                           |        |          |      |
    |            | .AC-03 认证成功后携带Token回调系统                           |        |          |      |
    |            | .AC-04 首次SSO登录时自动创建本地账号                         |        |          |      |
    |            | .AC-05 支持OAuth2.0/OIDC协议                                 |        |          |      |
    | US-IAM-009 | LDAP认证登录                                                 | UR-ALL | P2       | L    |
    |            | 作为租户用户，我想要使用AD域账号登录，以便与企业账号统一     |        |          |      |
    |            | .AC-01 租户配置LDAP后支持域账号登录                          |        |          |      |
    |            | .AC-02 能填写域账号用户名                                    |        |          |      |
    |            | .AC-03 能填写域账号密码                                      |        |          |      |
    |            | .AC-04 系统通过LDAP服务器验证凭证                            |        |          |      |
    |            | .AC-05 验证成功后签发系统Token                               |        |          |      |
    |            | .AC-06 首次LDAP登录时自动创建本地账号                        |        |          |      |

    表 4.2.1-2 FT-IAM-02 User Story清单

### 4.2.2 FT-IAM-03 密码管理

+   Feature定义如下表所示

    | 属性        | 内容                                     |
    | ----------- | ---------------------------------------- |
    | Feature编号 | FT-IAM-03                                |
    | Feature名称 | 密码管理                                 |
    | 所属Epic    | EP-37 平台用户管理                       |
    | Feature描述 | 支持用户修改密码、找回密码等密码管理功能 |
    | 业务价值    | 保障账号安全，支持用户自助服务           |
    | 目标版本    | P1                                       |

    表 4.2.2-1 FT-IAM-03定义

+   User Story清单及验收标准如下表所示

    | Story编号  | User Story                                                         | 角色 | 目标版本 | 规模 |
    | ---------- | ------------------------------------------------------------------ | ---- | -------- | ---- |
    | US-IAM-010 | 修改密码                                                           | 所有 | P1       | S    |
    |            | 作为用户，我想要修改登录密码，以便保障账号安全                     |      |          |      |
    |            | .AC-01 能填写当前密码（必填）                                      |      |          |      |
    |            | .AC-02 能填写新密码（必填，8-20位，含大小写字母和数字）            |      |          |      |
    |            | .AC-03 能确认新密码（必填，与新密码一致）                          |      |          |      |
    |            | .AC-04 当前密码错误时提示错误                                      |      |          |      |
    |            | .AC-05 新密码不能与近5次密码相同                                   |      |          |      |
    |            | .AC-06 修改成功后提示成功并要求重新登录                            |      |          |      |
    |            | .AC-07 密码修改后记录安全日志                                      |      |          |      |
    | US-IAM-011 | 找回密码                                                           | 所有 | P1       | M    |
    |            | 作为用户，我想要通过手机/邮箱找回密码，以便在忘记密码时恢复访问    |      |          |      |
    |            | .AC-01 能填写注册手机号/邮箱（必填）                               |      |          |      |
    |            | .AC-02 能点击获取验证码                                            |      |          |      |
    |            | .AC-03 能填写验证码（必填，6位数字）                               |      |          |      |
    |            | .AC-04 验证通过后能设置新密码                                      |      |          |      |
    |            | .AC-05 新密码不能与近5次密码相同                                   |      |          |      |
    |            | .AC-06 重置成功后所有会话失效                                      |      |          |      |
    |            | .AC-07 密码重置后发送通知邮件/短信                                 |      |          |      |
    | US-IAM-012 | 强制修改密码                                                       | 所有 | P1       | S    |
    |            | 作为首次登录用户，我想要被引导修改初始密码，以便保障账号安全       |      |          |      |
    |            | .AC-01 首次登录时强制跳转到修改密码页面                            |      |          |      |
    |            | .AC-02 不允许跳过，必须修改后才能继续                              |      |          |      |
    |            | .AC-03 新密码不能与初始密码相同                                    |      |          |      |
    |            | .AC-04 修改成功后跳转到目标页面                                    |      |          |      |
    | US-IAM-013 | 密码过期处理                                                       | 所有 | P1       | S    |
    |            | 作为密码即将过期的用户，我想要收到提醒并修改密码，以便持续安全访问 |      |          |      |
    |            | .AC-01 密码有效期可配置（默认90天）                                |      |          |      |
    |            | .AC-02 密码过期前7天开始提醒                                       |      |          |      |
    |            | .AC-03 密码过期后登录时强制修改                                    |      |          |      |
    |            | .AC-04 管理员可设置密码永不过期                                    |      |          |      |

    表 4.2.2-2 FT-IAM-03 User Story清单

## 4.3 用户管理模块

+   用户管理模块包含5个Feature，覆盖三类用户群的生命周期管理
+   用户管理模块Feature汇总如下表所示

    | Feature编号 | Feature名称    | 对应场景  | 用户群 | Story数 | 目标版本 |
    | ----------- | -------------- | --------- | ------ | ------- | -------- |
    | FT-IAM-01   | 用户注册与激活 | SC-IAM-01 | UC     | 4       | P1/P3    |
    | FT-IAM-05   | 平台用户管理   | SC-IAM-05 | UP     | 5       | P1       |
    | FT-IAM-06   | 租户用户管理   | SC-IAM-06 | UR     | 6       | P1       |
    | FT-IAM-07   | 个人用户管理   | SC-IAM-07 | UC     | 3       | P1       |
    | FT-IAM-08   | 组织架构管理   | SC-IAM-08 | UR     | 6       | P1       |

    表 4.3-1 用户管理模块Feature汇总

+   模块说明：
    -   用户注册Feature中社交账号注册（US-IAM-003）规划在P3版本
    -   其他Feature均为P1基础能力

### 4.3.1 FT-IAM-01 用户注册与激活

+   Feature定义如下表所示

    | 属性        | 内容                               |
    | ----------- | ---------------------------------- |
    | Feature编号 | FT-IAM-01                          |
    | Feature名称 | 用户注册与激活                     |
    | 所属Epic    | EP-37 平台用户管理                 |
    | Feature描述 | 支持个人用户自主注册账号并完成激活 |
    | 业务价值    | 获取C端用户，扩大平台用户基础      |
    | 目标版本    | P1                                 |

    表 4.3.1-1 FT-IAM-01定义

+   User Story清单及验收标准如下表所示

    | Story编号  | User Story                                                     | 角色  | 目标版本 | 规模 |
    | ---------- | -------------------------------------------------------------- | ----- | -------- | ---- |
    | US-IAM-001 | 手机号注册                                                     | UC-01 | P1       | M    |
    |            | 作为知识访客，我想要使用手机号注册账号，以便成为平台用户       |       |          |      |
    |            | .AC-01 能填写手机号（必填，11位手机号格式）                    |       |          |      |
    |            | .AC-02 能点击获取验证码（60秒内不可重复获取）                  |       |          |      |
    |            | .AC-03 能填写短信验证码（必填，6位数字）                       |       |          |      |
    |            | .AC-04 能设置登录密码（必填，8-20位，含大小写字母和数字）      |       |          |      |
    |            | .AC-05 能确认登录密码（必填，与密码一致）                      |       |          |      |
    |            | .AC-06 能勾选同意用户协议和隐私政策（必选）                    |       |          |      |
    |            | .AC-07 注册成功后显示成功提示并跳转登录页                      |       |          |      |
    |            | .AC-08 手机号已注册时提示"该手机号已注册"并提供登录入口        |       |          |      |
    | US-IAM-002 | 邮箱注册                                                       | UC-01 | P1       | M    |
    |            | 作为知识访客，我想要使用邮箱注册账号，以便成为平台用户         |       |          |      |
    |            | .AC-01 能填写邮箱地址（必填，邮箱格式）                        |       |          |      |
    |            | .AC-02 能点击获取验证码（60秒内不可重复获取）                  |       |          |      |
    |            | .AC-03 能填写邮箱验证码（必填，6位数字）                       |       |          |      |
    |            | .AC-04 能设置登录密码（必填，8-20位，含大小写字母和数字）      |       |          |      |
    |            | .AC-05 能确认登录密码（必填，与密码一致）                      |       |          |      |
    |            | .AC-06 能勾选同意用户协议和隐私政策（必选）                    |       |          |      |
    |            | .AC-07 注册成功后显示成功提示并跳转登录页                      |       |          |      |
    |            | .AC-08 邮箱已注册时提示"该邮箱已注册"并提供登录入口            |       |          |      |
    | US-IAM-003 | 社交账号注册                                                   | UC-01 | P3       | M    |
    |            | 作为知识访客，我想要使用微信扫码注册账号，以便快速成为平台用户 |       |          |      |
    |            | .AC-01 能点击"微信登录"按钮                                    |       |          |      |
    |            | .AC-02 能跳转到微信授权页面                                    |       |          |      |
    |            | .AC-03 授权成功后自动创建账号                                  |       |          |      |
    |            | .AC-04 首次登录引导绑定手机号                                  |       |          |      |
    |            | .AC-05 能勾选同意用户协议和隐私政策（必选）                    |       |          |      |
    | US-IAM-004 | 账号激活                                                       | UC-01 | P1       | S    |
    |            | 作为新注册用户，我想要激活账号，以便正常使用系统功能           |       |          |      |
    |            | .AC-01 注册后账号状态为"待激活"                                |       |          |      |
    |            | .AC-02 系统自动发送激活邮件/短信                               |       |          |      |
    |            | .AC-03 点击激活链接后账号状态变为"正常"                        |       |          |      |
    |            | .AC-04 激活链接24小时内有效                                    |       |          |      |
    |            | .AC-05 链接过期时提示重新发送激活邮件                          |       |          |      |

    表 4.3.1-2 FT-IAM-01 User Story清单

### 4.3.2 FT-IAM-04 会话与Token管理

+   Feature定义如下表所示

    | 属性        | 内容                         |
    | ----------- | ---------------------------- |
    | Feature编号 | FT-IAM-04                    |
    | Feature名称 | 会话与Token管理              |
    | 所属Epic    | EP-37 平台用户管理           |
    | Feature描述 | 管理用户登录会话和访问令牌   |
    | 业务价值    | 保障访问安全，支持多设备管理 |
    | 目标版本    | P1                           |

    表 4.3.2-1 FT-IAM-04定义

+   User Story清单及验收标准如下表所示

    | Story编号  | User Story                                                   | 角色 | 目标版本 | 规模 |
    | ---------- | ------------------------------------------------------------ | ---- | -------- | ---- |
    | US-IAM-014 | Token签发与刷新                                              | 系统 | P1       | M    |
    |            | 作为系统，我想要签发和刷新访问令牌，以便安全地管理用户会话   |      |          |      |
    |            | .AC-01 登录成功后签发Access Token（有效期2小时）             |      |          |      |
    |            | .AC-02 登录成功后签发Refresh Token（有效期7天）              |      |          |      |
    |            | .AC-03 Access Token过期时可用Refresh Token刷新               |      |          |      |
    |            | .AC-04 Refresh Token过期时需要重新登录                       |      |          |      |
    |            | .AC-05 Token采用JWT格式，包含用户ID、租户ID、角色等信息      |      |          |      |
    | US-IAM-015 | 查看在线设备                                                 | 所有 | P1       | S    |
    |            | 作为用户，我想要查看当前登录的设备列表，以便了解账号登录情况 |      |          |      |
    |            | .AC-01 能查看所有活跃会话列表                                |      |          |      |
    |            | .AC-02 能看到设备类型（PC/手机/平板）                        |      |          |      |
    |            | .AC-03 能看到登录时间和IP地址                                |      |          |      |
    |            | .AC-04 能看到最后活跃时间                                    |      |          |      |
    |            | .AC-05 当前设备有特殊标识                                    |      |          |      |
    | US-IAM-016 | 踢出设备                                                     | 所有 | P1       | S    |
    |            | 作为用户，我想要踢出其他设备的登录，以便保障账号安全         |      |          |      |
    |            | .AC-01 能选择要踢出的设备                                    |      |          |      |
    |            | .AC-02 点击"踢出"后该设备会话立即失效                        |      |          |      |
    |            | .AC-03 被踢出设备访问时提示"您已在其他设备登出"              |      |          |      |
    |            | .AC-04 能一键踢出除当前设备外的所有设备                      |      |          |      |
    | US-IAM-017 | 主动登出                                                     | 所有 | P1       | XS   |
    |            | 作为用户，我想要主动退出登录，以便安全地结束使用             |      |          |      |
    |            | .AC-01 能点击"退出登录"按钮                                  |      |          |      |
    |            | .AC-02 退出后Token立即失效                                   |      |          |      |
    |            | .AC-03 退出后跳转到登录页面                                  |      |          |      |
    |            | .AC-04 记录登出日志                                          |      |          |      |

    表 4.3.2-2 FT-IAM-04 User Story清单

### 4.3.2 FT-IAM-05 平台用户管理

+   Feature定义如下表所示

    | 属性        | 内容                           |
    | ----------- | ------------------------------ |
    | Feature编号 | FT-IAM-05                      |
    | Feature名称 | 平台用户管理                   |
    | 所属Epic    | EP-37 平台用户管理             |
    | Feature描述 | 管理平台运营人员的账号生命周期 |
    | 业务价值    | 确保平台运营团队有序管理       |
    | 目标版本    | P1                             |

    表 4.3.2-1 FT-IAM-05定义

+   User Story清单及验收标准如下表所示

    | Story编号  | User Story                                                     | 角色  | 目标版本 | 规模 |
    | ---------- | -------------------------------------------------------------- | ----- | -------- | ---- |
    | US-IAM-018 | 创建平台用户                                                   | UP-09 | P1       | M    |
    |            | 作为平台管理员，我想要创建平台用户账号，以便新员工可以使用系统 |       |          |      |
    |            | .AC-01 能填写用户姓名（必填，2-50字符）                        |       |          |      |
    |            | .AC-02 能填写手机号（必填，11位手机号格式，唯一）              |       |          |      |
    |            | .AC-03 能填写邮箱（必填，邮箱格式，唯一）                      |       |          |      |
    |            | .AC-04 能选择平台角色（必填，可多选）                          |       |          |      |
    |            | .AC-05 能设置账号有效期（可选）                                |       |          |      |
    |            | .AC-06 创建成功后系统生成初始密码                              |       |          |      |
    |            | .AC-07 初始密码通过邮件/短信发送给用户                         |       |          |      |
    | US-IAM-019 | 编辑平台用户                                                   | UP-09 | P1       | S    |
    |            | 作为平台管理员，我想要编辑平台用户信息，以便更新用户资料       |       |          |      |
    |            | .AC-01 能修改用户姓名                                          |       |          |      |
    |            | .AC-02 能修改手机号（需验证唯一性）                            |       |          |      |
    |            | .AC-03 能修改邮箱（需验证唯一性）                              |       |          |      |
    |            | .AC-04 能修改角色分配                                          |       |          |      |
    |            | .AC-05 能修改账号有效期                                        |       |          |      |
    |            | .AC-06 修改后记录变更日志                                      |       |          |      |
    | US-IAM-020 | 禁用启用平台用户                                               | UP-09 | P1       | S    |
    |            | 作为平台管理员，我想要禁用或启用平台用户，以便管理账号状态     |       |          |      |
    |            | .AC-01 能将用户状态设置为"禁用"                                |       |          |      |
    |            | .AC-02 禁用后用户无法登录                                      |       |          |      |
    |            | .AC-03 禁用后该用户所有会话失效                                |       |          |      |
    |            | .AC-04 能将用户状态恢复为"正常"                                |       |          |      |
    |            | .AC-05 状态变更后记录操作日志                                  |       |          |      |
    | US-IAM-021 | 重置平台用户密码                                               | UP-09 | P1       | S    |
    |            | 作为平台管理员，我想要重置用户密码，以便帮助忘记密码的用户     |       |          |      |
    |            | .AC-01 能点击"重置密码"按钮                                    |       |          |      |
    |            | .AC-02 系统生成新的随机密码                                    |       |          |      |
    |            | .AC-03 新密码通过邮件/短信发送给用户                           |       |          |      |
    |            | .AC-04 重置后该用户所有会话失效                                |       |          |      |
    |            | .AC-05 用户下次登录需要修改密码                                |       |          |      |
    | US-IAM-022 | 查询平台用户                                                   | UP-09 | P1       | S    |
    |            | 作为平台管理员，我想要查询平台用户列表，以便了解用户情况       |       |          |      |
    |            | .AC-01 能按姓名模糊搜索                                        |       |          |      |
    |            | .AC-02 能按手机号精确搜索                                      |       |          |      |
    |            | .AC-03 能按状态筛选（全部/正常/禁用）                          |       |          |      |
    |            | .AC-04 能按角色筛选                                            |       |          |      |
    |            | .AC-05 列表显示姓名、手机、邮箱、角色、状态、创建时间          |       |          |      |
    |            | .AC-06 支持分页显示                                            |       |          |      |

    表 4.3.2-2 FT-IAM-05 User Story清单

### 4.3.3 FT-IAM-06 租户用户管理

+   Feature定义如下表所示

    | 属性        | 内容                               |
    | ----------- | ---------------------------------- |
    | Feature编号 | FT-IAM-06                          |
    | Feature名称 | 租户用户管理                       |
    | 所属Epic    | EP-37 平台用户管理                 |
    | Feature描述 | 管理租户内员工的账号生命周期       |
    | 业务价值    | 支撑租户自主管理用户，实现责任到人 |
    | 目标版本    | P1                                 |

    表 4.3.3-1 FT-IAM-06定义

+   User Story清单及验收标准如下表所示

    | Story编号  | User Story                                               | 角色  | 目标版本 | 规模 |
    | ---------- | -------------------------------------------------------- | ----- | -------- | ---- |
    | US-IAM-023 | 创建租户用户                                             | UR-10 | P1       | M    |
    |            | 作为租户管理员，我想要创建用户账号，以便员工可以使用系统 |       |          |      |
    |            | .AC-01 能填写用户姓名（必填，2-50字符）                  |       |          |      |
    |            | .AC-02 能填写工号（可选，租户内唯一）                    |       |          |      |
    |            | .AC-03 能填写手机号（必填，11位手机号格式，租户内唯一）  |       |          |      |
    |            | .AC-04 能填写邮箱（必填，邮箱格式，租户内唯一）          |       |          |      |
    |            | .AC-05 能选择所属部门（必填）                            |       |          |      |
    |            | .AC-06 能选择岗位（可选）                                |       |          |      |
    |            | .AC-07 能选择角色（必填，可多选）                        |       |          |      |
    |            | .AC-08 创建前检查用户数是否超过配额                      |       |          |      |
    |            | .AC-09 创建成功后系统生成初始密码并发送给用户            |       |          |      |
    | US-IAM-024 | 批量导入用户                                             | UR-10 | P1       | L    |
    |            | 作为租户管理员，我想要批量导入用户，以便快速创建大量用户 |       |          |      |
    |            | .AC-01 能下载导入模板（Excel格式）                       |       |          |      |
    |            | .AC-02 能上传填写好的Excel文件                           |       |          |      |
    |            | .AC-03 上传后显示数据预览和校验结果                      |       |          |      |
    |            | .AC-04 校验通过的数据可以确认导入                        |       |          |      |
    |            | .AC-05 校验失败的数据显示失败原因                        |       |          |      |
    |            | .AC-06 导入完成后显示成功数量和失败数量                  |       |          |      |
    |            | .AC-07 批量导入前检查用户配额                            |       |          |      |
    | US-IAM-025 | 编辑租户用户                                             | UR-10 | P1       | S    |
    |            | 作为租户管理员，我想要编辑用户信息，以便更新用户资料     |       |          |      |
    |            | .AC-01 能修改用户姓名                                    |       |          |      |
    |            | .AC-02 能修改工号                                        |       |          |      |
    |            | .AC-03 能修改手机号（需验证唯一性）                      |       |          |      |
    |            | .AC-04 能修改邮箱（需验证唯一性）                        |       |          |      |
    |            | .AC-05 能修改所属部门                                    |       |          |      |
    |            | .AC-06 能修改岗位                                        |       |          |      |
    |            | .AC-07 能修改角色分配                                    |       |          |      |
    | US-IAM-026 | 用户离职处理                                             | UR-10 | P1       | M    |
    |            | 作为租户管理员，我想要处理离职用户，以便回收权限和数据   |       |          |      |
    |            | .AC-01 能将用户状态设置为"离职"                          |       |          |      |
    |            | .AC-02 离职后用户无法登录                                |       |          |      |
    |            | .AC-03 离职后该用户所有会话失效                          |       |          |      |
    |            | .AC-04 能选择数据处理方式（保留/转移/删除）              |       |          |      |
    |            | .AC-05 数据转移时能选择接收人                            |       |          |      |
    |            | .AC-06 离职处理后释放用户配额                            |       |          |      |
    | US-IAM-027 | 用户调岗处理                                             | UR-10 | P1       | S    |
    |            | 作为租户管理员，我想要处理用户调岗，以便更新组织关系     |       |          |      |
    |            | .AC-01 能修改用户所属部门                                |       |          |      |
    |            | .AC-02 能修改用户岗位                                    |       |          |      |
    |            | .AC-03 能修改用户角色                                    |       |          |      |
    |            | .AC-04 调岗后权限立即生效                                |       |          |      |
    |            | .AC-05 记录调岗历史                                      |       |          |      |
    | US-IAM-028 | 查询租户用户                                             | UR-10 | P1       | S    |
    |            | 作为租户管理员，我想要查询用户列表，以便了解用户情况     |       |          |      |
    |            | .AC-01 能按姓名/工号模糊搜索                             |       |          |      |
    |            | .AC-02 能按部门筛选                                      |       |          |      |
    |            | .AC-03 能按岗位筛选                                      |       |          |      |
    |            | .AC-04 能按角色筛选                                      |       |          |      |
    |            | .AC-05 能按状态筛选（全部/正常/禁用/离职）               |       |          |      |
    |            | .AC-06 列表显示姓名、工号、部门、岗位、角色、状态        |       |          |      |
    |            | .AC-07 支持导出用户列表                                  |       |          |      |

    表 4.3.3-2 FT-IAM-06 User Story清单

### 4.3.4 FT-IAM-07 个人用户管理

+   Feature定义如下表所示

    | 属性        | 内容                            |
    | ----------- | ------------------------------- |
    | Feature编号 | FT-IAM-07                       |
    | Feature名称 | 个人用户管理                    |
    | 所属Epic    | EP-37 平台用户管理              |
    | Feature描述 | 支持C端个人用户自主管理个人信息 |
    | 业务价值    | 提升用户体验，支持用户自助服务  |
    | 目标版本    | P1                              |

    表 4.3.4-1 FT-IAM-07定义

+   User Story清单及验收标准如下表所示

    | Story编号  | User Story                                             | 角色  | 目标版本 | 规模 |
    | ---------- | ------------------------------------------------------ | ----- | -------- | ---- |
    | US-IAM-029 | 查看个人信息                                           | UC-02 | P1       | S    |
    |            | 作为个人用户，我想要查看我的个人信息，以便了解账号详情 |       |          |      |
    |            | .AC-01 能查看用户名                                    |       |          |      |
    |            | .AC-02 能查看手机号（部分脱敏显示）                    |       |          |      |
    |            | .AC-03 能查看邮箱（部分脱敏显示）                      |       |          |      |
    |            | .AC-04 能查看注册时间                                  |       |          |      |
    |            | .AC-05 能查看会员状态和到期时间                        |       |          |      |
    | US-IAM-030 | 编辑个人信息                                           | UC-02 | P1       | S    |
    |            | 作为个人用户，我想要编辑我的个人信息，以便更新资料     |       |          |      |
    |            | .AC-01 能修改昵称（2-20字符）                          |       |          |      |
    |            | .AC-02 能修改头像（支持jpg/png，不超过2MB）            |       |          |      |
    |            | .AC-03 能修改手机号（需验证码验证）                    |       |          |      |
    |            | .AC-04 能修改邮箱（需验证码验证）                      |       |          |      |
    |            | .AC-05 修改后记录变更日志                              |       |          |      |
    | US-IAM-031 | 注销账号                                               | UC-02 | P1       | M    |
    |            | 作为个人用户，我想要注销我的账号，以便删除个人数据     |       |          |      |
    |            | .AC-01 能在个人设置中找到"注销账号"入口                |       |          |      |
    |            | .AC-02 注销前需要验证身份（密码或验证码）              |       |          |      |
    |            | .AC-03 注销前显示注销须知和影响说明                    |       |          |      |
    |            | .AC-04 确认注销后账号进入"注销审核中"状态              |       |          |      |
    |            | .AC-05 审核期（7天）内可撤销注销申请                   |       |          |      |
    |            | .AC-06 审核期结束后账号数据被删除                      |       |          |      |
    |            | .AC-07 注销完成后发送确认邮件/短信                     |       |          |      |

    表 4.3.4-2 FT-IAM-07 User Story清单

### 4.3.5 FT-IAM-08 组织架构管理

+   Feature定义如下表所示

    | 属性        | 内容                               |
    | ----------- | ---------------------------------- |
    | Feature编号 | FT-IAM-08                          |
    | Feature名称 | 组织架构管理                       |
    | 所属Epic    | EP-37 平台用户管理                 |
    | Feature描述 | 管理租户的部门、岗位等组织架构信息 |
    | 业务价值    | 支撑岗位责任映射，实现合规责任到人 |
    | 目标版本    | P1                                 |

    表 4.3.5-1 FT-IAM-08定义

+   User Story清单及验收标准如下表所示

    | Story编号  | User Story                                           | 角色  | 目标版本 | 规模 |
    | ---------- | ---------------------------------------------------- | ----- | -------- | ---- |
    | US-IAM-032 | 创建部门                                             | UR-10 | P1       | S    |
    |            | 作为租户管理员，我想要创建部门，以便建立组织架构     |       |          |      |
    |            | .AC-01 能选择上级部门（根部门为租户）                |       |          |      |
    |            | .AC-02 能填写部门名称（必填，2-50字符，同级唯一）    |       |          |      |
    |            | .AC-03 能填写部门编码（可选，租户内唯一）            |       |          |      |
    |            | .AC-04 能选择部门负责人（可选，从用户列表选择）      |       |          |      |
    |            | .AC-05 能填写部门描述（可选）                        |       |          |      |
    |            | .AC-06 能设置部门排序号                              |       |          |      |
    |            | .AC-07 创建成功后组织架构树自动更新                  |       |          |      |
    | US-IAM-033 | 编辑部门                                             | UR-10 | P1       | S    |
    |            | 作为租户管理员，我想要编辑部门信息，以便更新组织架构 |       |          |      |
    |            | .AC-01 能修改部门名称                                |       |          |      |
    |            | .AC-02 能修改部门编码                                |       |          |      |
    |            | .AC-03 能修改部门负责人                              |       |          |      |
    |            | .AC-04 能修改部门描述                                |       |          |      |
    |            | .AC-05 能修改排序号                                  |       |          |      |
    |            | .AC-06 修改后记录变更日志                            |       |          |      |
    | US-IAM-034 | 删除部门                                             | UR-10 | P1       | S    |
    |            | 作为租户管理员，我想要删除部门，以便调整组织架构     |       |          |      |
    |            | .AC-01 能选择要删除的部门                            |       |          |      |
    |            | .AC-02 部门下有子部门时不允许删除                    |       |          |      |
    |            | .AC-03 部门下有用户时不允许删除                      |       |          |      |
    |            | .AC-04 删除前需要二次确认                            |       |          |      |
    |            | .AC-05 删除后组织架构树自动更新                      |       |          |      |
    | US-IAM-035 | 创建岗位                                             | UR-10 | P1       | S    |
    |            | 作为租户管理员，我想要创建岗位，以便定义职责分工     |       |          |      |
    |            | .AC-01 能填写岗位名称（必填，2-50字符，租户内唯一）  |       |          |      |
    |            | .AC-02 能填写岗位编码（可选，租户内唯一）            |       |          |      |
    |            | .AC-03 能选择所属部门（可选，可关联多部门）          |       |          |      |
    |            | .AC-04 能填写岗位职责描述（可选）                    |       |          |      |
    |            | .AC-05 能设置岗位状态（启用/禁用）                   |       |          |      |
    | US-IAM-036 | 编辑岗位                                             | UR-10 | P1       | S    |
    |            | 作为租户管理员，我想要编辑岗位信息，以便更新岗位定义 |       |          |      |
    |            | .AC-01 能修改岗位名称                                |       |          |      |
    |            | .AC-02 能修改岗位编码                                |       |          |      |
    |            | .AC-03 能修改所属部门                                |       |          |      |
    |            | .AC-04 能修改岗位职责描述                            |       |          |      |
    |            | .AC-05 能修改岗位状态                                |       |          |      |
    | US-IAM-037 | 查看组织架构                                         | UR-10 | P1       | S    |
    |            | 作为租户管理员，我想要查看组织架构，以便了解组织全貌 |       |          |      |
    |            | .AC-01 能以树形结构查看部门层级                      |       |          |      |
    |            | .AC-02 能展开/折叠部门节点                           |       |          |      |
    |            | .AC-03 能查看部门下的用户数量                        |       |          |      |
    |            | .AC-04 能查看部门负责人                              |       |          |      |
    |            | .AC-05 能搜索部门名称快速定位                        |       |          |      |
    |            | .AC-06 能导出组织架构图                              |       |          |      |

    表 4.3.6-2 FT-IAM-08 User Story清单

## 4.4 授权管理模块

+   授权管理模块包含2个Feature，实现RBAC权限模型
+   授权管理模块Feature汇总如下表所示

    | Feature编号 | Feature名称 | 对应场景  | Story数 | 目标版本 |
    | ----------- | ----------- | --------- | ------- | -------- |
    | FT-IAM-09   | 角色管理    | SC-IAM-09 | 5       | P1       |
    | FT-IAM-10   | 权限配置    | SC-IAM-10 | 5       | P1/P2    |

    表 4.4-1 授权管理模块Feature汇总

+   模块说明：
    -   权限配置Feature中权限继承（US-IAM-047）规划在P2版本
    -   其他Story均为P1基础能力

### 4.4.1 FT-IAM-09 角色管理

+   Feature定义如下表所示

    | 属性        | 内容                                   |
    | ----------- | -------------------------------------- |
    | Feature编号 | FT-IAM-09                              |
    | Feature名称 | 角色管理                               |
    | 所属Epic    | EP-37 平台用户管理                     |
    | Feature描述 | 定义和管理系统角色，实现权限的批量管理 |
    | 业务价值    | 通过角色简化权限管理，提高管理效率     |
    | 目标版本    | P1                                     |

    表 4.4.1-1 FT-IAM-09定义

+   User Story清单及验收标准如下表所示

    | Story编号  | User Story                                                | 角色        | 目标版本 | 规模 |
    | ---------- | --------------------------------------------------------- | ----------- | -------- | ---- |
    | US-IAM-038 | 创建角色                                                  | UP-09/UR-10 | P1       | M    |
    |            | 作为管理员，我想要创建角色，以便批量管理权限              |             |          |      |
    |            | .AC-01 能填写角色名称（必填，2-50字符，范围内唯一）       |             |          |      |
    |            | .AC-02 能填写角色编码（必填，英文数字下划线，范围内唯一） |             |          |      |
    |            | .AC-03 能填写角色描述（可选）                             |             |          |      |
    |            | .AC-04 能选择角色类型（平台角色/租户角色）                |             |          |      |
    |            | .AC-05 能设置角色状态（启用/禁用）                        |             |          |      |
    |            | .AC-06 能设置角色排序号                                   |             |          |      |
    |            | .AC-07 创建成功后可继续配置权限                           |             |          |      |
    | US-IAM-039 | 编辑角色                                                  | UP-09/UR-10 | P1       | S    |
    |            | 作为管理员，我想要编辑角色信息，以便更新角色定义          |             |          |      |
    |            | .AC-01 能修改角色名称                                     |             |          |      |
    |            | .AC-02 能修改角色描述                                     |             |          |      |
    |            | .AC-03 能修改角色状态                                     |             |          |      |
    |            | .AC-04 能修改排序号                                       |             |          |      |
    |            | .AC-05 预置角色不允许修改编码                             |             |          |      |
    |            | .AC-06 修改后记录变更日志                                 |             |          |      |
    | US-IAM-040 | 删除角色                                                  | UP-09/UR-10 | P1       | S    |
    |            | 作为管理员，我想要删除角色，以便清理不再使用的角色        |             |          |      |
    |            | .AC-01 能选择要删除的角色                                 |             |          |      |
    |            | .AC-02 预置角色不允许删除                                 |             |          |      |
    |            | .AC-03 有用户关联的角色不允许删除                         |             |          |      |
    |            | .AC-04 删除前需要二次确认                                 |             |          |      |
    |            | .AC-05 删除后记录操作日志                                 |             |          |      |
    | US-IAM-041 | 复制角色                                                  | UP-09/UR-10 | P1       | S    |
    |            | 作为管理员，我想要复制角色，以便快速创建相似角色          |             |          |      |
    |            | .AC-01 能选择要复制的源角色                               |             |          |      |
    |            | .AC-02 复制后自动生成新角色名称（原名称+副本）            |             |          |      |
    |            | .AC-03 复制后自动复制权限配置                             |             |          |      |
    |            | .AC-04 复制后可继续编辑                                   |             |          |      |
    | US-IAM-042 | 查看角色用户                                              | UP-09/UR-10 | P1       | S    |
    |            | 作为管理员，我想要查看角色下的用户，以便了解权限分配情况  |             |          |      |
    |            | .AC-01 能查看拥有该角色的用户列表                         |             |          |      |
    |            | .AC-02 列表显示用户姓名、部门、状态                       |             |          |      |
    |            | .AC-03 能从列表中移除用户的该角色                         |             |          |      |
    |            | .AC-04 能快速添加用户到该角色                             |             |          |      |

    表 4.4.1-2 FT-IAM-09 User Story清单

### 4.4.2 FT-IAM-10 权限配置

+   Feature定义如下表所示

    | 属性        | 内容                               |
    | ----------- | ---------------------------------- |
    | Feature编号 | FT-IAM-10                          |
    | Feature名称 | 权限配置                           |
    | 所属Epic    | EP-37 平台用户管理                 |
    | Feature描述 | 配置角色的功能权限和数据权限       |
    | 业务价值    | 实现细粒度的访问控制，保障数据安全 |
    | 目标版本    | P1                                 |

    表 4.4.2-1 FT-IAM-10定义

+   User Story清单及验收标准如下表所示

    | Story编号  | User Story                                                          | 角色        | 目标版本 | 规模 |
    | ---------- | ------------------------------------------------------------------- | ----------- | -------- | ---- |
    | US-IAM-043 | 配置功能权限                                                        | UP-09/UR-10 | P1       | M    |
    |            | 作为管理员，我想要配置角色的功能权限，以便控制用户可访问的功能      |             |          |      |
    |            | .AC-01 能以树形结构查看功能权限列表                                 |             |          |      |
    |            | .AC-02 能勾选/取消勾选菜单权限                                      |             |          |      |
    |            | .AC-03 能勾选/取消勾选按钮权限                                      |             |          |      |
    |            | .AC-04 勾选父节点时自动勾选所有子节点                               |             |          |      |
    |            | .AC-05 取消父节点时自动取消所有子节点                               |             |          |      |
    |            | .AC-06 能全选/全不选                                                |             |          |      |
    |            | .AC-07 保存后权限立即生效                                           |             |          |      |
    | US-IAM-044 | 配置数据权限                                                        | UP-09/UR-10 | P1       | M    |
    |            | 作为管理员，我想要配置角色的数据权限，以便控制用户可访问的数据范围  |             |          |      |
    |            | .AC-01 能选择数据权限范围（仅本人/本部门/本部门及下级/全部/自定义） |             |          |      |
    |            | .AC-02 选择"自定义"时能勾选具体部门                                 |             |          |      |
    |            | .AC-03 能为不同功能模块设置不同的数据权限                           |             |          |      |
    |            | .AC-04 保存后数据权限立即生效                                       |             |          |      |
    |            | .AC-05 数据权限变更后记录日志                                       |             |          |      |
    | US-IAM-045 | 查看权限详情                                                        | UP-09/UR-10 | P1       | S    |
    |            | 作为管理员，我想要查看角色的权限详情，以便了解权限配置情况          |             |          |      |
    |            | .AC-01 能查看角色已授权的功能权限列表                               |             |          |      |
    |            | .AC-02 能查看角色的数据权限范围                                     |             |          |      |
    |            | .AC-03 能查看权限配置的变更历史                                     |             |          |      |
    | US-IAM-046 | 用户权限查询                                                        | UP-09/UR-10 | P1       | S    |
    |            | 作为管理员，我想要查询用户的实际权限，以便了解用户能访问什么        |             |          |      |
    |            | .AC-01 能选择要查询的用户                                           |             |          |      |
    |            | .AC-02 能查看用户拥有的所有角色                                     |             |          |      |
    |            | .AC-03 能查看用户的合并后功能权限                                   |             |          |      |
    |            | .AC-04 能查看用户的数据权限范围                                     |             |          |      |
    | US-IAM-047 | 权限继承配置                                                        | UP-09/UR-10 | P2       | M    |
    |            | 作为管理员，我想要配置角色继承关系，以便简化权限管理                |             |          |      |
    |            | .AC-01 能设置角色的父角色                                           |             |          |      |
    |            | .AC-02 子角色自动继承父角色的权限                                   |             |          |      |
    |            | .AC-03 子角色可以在继承基础上增加权限                               |             |          |      |
    |            | .AC-04 父角色权限变更时子角色同步更新                               |             |          |      |
    |            | .AC-05 不允许循环继承                                               |             |          |      |

    表 4.4.2-2 FT-IAM-10 User Story清单

## 4.5 审计管理模块

+   审计管理模块包含1个Feature，提供审计日志记录和查询能力
+   审计管理模块Feature汇总如下表所示

    | Feature编号 | Feature名称 | 对应场景  | Story数 | 目标版本 |
    | ----------- | ----------- | --------- | ------- | -------- |
    | FT-IAM-11   | 审计日志    | SC-IAM-11 | 5       | P1       |

    表 4.5-1 审计管理模块Feature汇总

+   模块说明：
    -   审计日志为P1基础能力，满足基本合规要求
    -   高级审计分析能力将在P5版本补充

### 4.5.1 FT-IAM-11 审计日志

+   Feature定义如下表所示

    | 属性        | 内容                                 |
    | ----------- | ------------------------------------ |
    | Feature编号 | FT-IAM-11                            |
    | Feature名称 | 审计日志                             |
    | 所属Epic    | EP-37 平台用户管理                   |
    | Feature描述 | 记录和查询系统操作日志，支撑安全审计 |
    | 业务价值    | 满足合规要求，支持问题追溯和安全审计 |
    | 目标版本    | P1                                   |

    表 4.5.1-1 FT-IAM-11定义

+   User Story清单及验收标准如下表所示

    | Story编号  | User Story                                                     | 角色        | 目标版本 | 规模 |
    | ---------- | -------------------------------------------------------------- | ----------- | -------- | ---- |
    | US-IAM-048 | 查询登录日志                                                   | UP-09/UR-01 | P1       | M    |
    |            | 作为管理员，我想要查询登录日志，以便了解用户登录情况           |             |          |      |
    |            | .AC-01 能按时间范围筛选（必选，默认近7天）                     |             |          |      |
    |            | .AC-02 能按用户姓名/账号搜索                                   |             |          |      |
    |            | .AC-03 能按登录结果筛选（全部/成功/失败）                      |             |          |      |
    |            | .AC-04 能按IP地址搜索                                          |             |          |      |
    |            | .AC-05 列表显示用户、登录时间、IP、设备、地点、结果            |             |          |      |
    |            | .AC-06 能查看登录详情（浏览器、操作系统等）                    |             |          |      |
    |            | .AC-07 支持分页和排序                                          |             |          |      |
    | US-IAM-049 | 查询操作日志                                                   | UP-09/UR-01 | P1       | M    |
    |            | 作为管理员，我想要查询操作日志，以便审计用户操作               |             |          |      |
    |            | .AC-01 能按时间范围筛选（必选，默认近7天）                     |             |          |      |
    |            | .AC-02 能按用户姓名/账号搜索                                   |             |          |      |
    |            | .AC-03 能按操作模块筛选                                        |             |          |      |
    |            | .AC-04 能按操作类型筛选（查询/新增/修改/删除）                 |             |          |      |
    |            | .AC-05 列表显示用户、操作时间、模块、操作类型、操作对象、结果  |             |          |      |
    |            | .AC-06 能查看操作详情（请求参数、响应结果）                    |             |          |      |
    |            | .AC-07 支持分页和排序                                          |             |          |      |
    | US-IAM-050 | 查询安全事件                                                   | UP-09/UR-01 | P1       | M    |
    |            | 作为管理员，我想要查询安全事件，以便发现安全风险               |             |          |      |
    |            | .AC-01 能按时间范围筛选（必选，默认近7天）                     |             |          |      |
    |            | .AC-02 能按事件类型筛选（登录失败/密码重置/权限变更/异常访问） |             |          |      |
    |            | .AC-03 能按风险等级筛选（高/中/低）                            |             |          |      |
    |            | .AC-04 列表显示事件时间、类型、用户、IP、风险等级、描述        |             |          |      |
    |            | .AC-05 高风险事件突出显示                                      |             |          |      |
    |            | .AC-06 能查看事件详情                                          |             |          |      |
    | US-IAM-051 | 导出审计日志                                                   | UP-09/UR-01 | P1       | S    |
    |            | 作为管理员，我想要导出审计日志，以便离线分析或存档             |             |          |      |
    |            | .AC-01 能导出登录日志                                          |             |          |      |
    |            | .AC-02 能导出操作日志                                          |             |          |      |
    |            | .AC-03 能导出安全事件                                          |             |          |      |
    |            | .AC-04 支持Excel和CSV格式                                      |             |          |      |
    |            | .AC-05 导出时应用当前筛选条件                                  |             |          |      |
    |            | .AC-06 单次导出不超过10万条                                    |             |          |      |
    | US-IAM-052 | 日志自动记录                                                   | 系统        | P1       | M    |
    |            | 作为系统，我想要自动记录操作日志，以便完整追溯                 |             |          |      |
    |            | .AC-01 自动记录所有登录/登出操作                               |             |          |      |
    |            | .AC-02 自动记录所有写操作（新增/修改/删除）                    |             |          |      |
    |            | .AC-03 自动记录敏感数据访问                                    |             |          |      |
    |            | .AC-04 日志包含操作人、时间、IP、操作类型、操作对象            |             |          |      |
    |            | .AC-05 日志不可修改、不可删除                                  |             |          |      |
    |            | .AC-06 日志异步写入，不影响主流程性能                          |             |          |      |

    表 4.5.1-2 FT-IAM-11 User Story清单

## 4.6 系统场景模块

+   系统场景模块包含2个Feature，提供租户IAM初始化和系统配置管理能力
+   系统场景模块Feature汇总如下表所示

    | Feature编号 | Feature名称   | 对应场景  | 调用方      | Story数 | 目标版本 |
    | ----------- | ------------- | --------- | ----------- | ------- | -------- |
    | FT-IAM-12   | 租户IAM初始化 | SC-IAM-12 | BC-11       | 6       | P1       |
    | FT-IAM-16   | 系统配置管理  | SC-IAM-16 | UP-09/UR-10 | 4       | P1       |

    表 4.6-1 系统场景模块Feature汇总

+   模块说明：
    -   租户IAM初始化由BC-11租户管理在租户开通时调用
    -   LDAP认证集成（SC-IAM-14）已合并到FT-IAM-02登录认证Feature中
    -   系统配置管理为平台级和租户级配置参数的管理能力

### 4.6.1 FT-IAM-12 租户IAM初始化

+   Feature定义如下表所示

    | 属性        | 内容                               |
    | ----------- | ---------------------------------- |
    | Feature编号 | FT-IAM-12                          |
    | Feature名称 | 租户IAM初始化                      |
    | 所属Epic    | EP-37 平台用户管理                 |
    | Feature描述 | 初始化租户的IAM表结构和基础数据    |
    | 业务价值    | 确保新租户可以正常使用认证授权功能 |
    | 目标版本    | P1                                 |

    表 4.6.1-1 FT-IAM-12定义

+   User Story清单及验收标准如下表所示

    | Story编号  | User Story                                               | 角色 | 目标版本 | 规模 |
    | ---------- | -------------------------------------------------------- | ---- | -------- | ---- |
    | US-IAM-053 | IAM表结构初始化                                          | 系统 | P1       | M    |
    |            | 作为系统，我想要创建租户IAM表结构，以便存储IAM数据       |      |          |      |
    |            | .AC-01 接收BC-11的初始化请求                             |      |          |      |
    |            | .AC-02 切换到租户数据源                                  |      |          |      |
    |            | .AC-03 创建用户表（sys_user）                            |      |          |      |
    |            | .AC-04 创建角色表（sys_role）                            |      |          |      |
    |            | .AC-05 创建权限表（sys_permission）                      |      |          |      |
    |            | .AC-06 创建用户角色关联表（sys_user_role）               |      |          |      |
    |            | .AC-07 创建角色权限关联表（sys_role_permission）         |      |          |      |
    |            | .AC-08 创建部门表（sys_dept）                            |      |          |      |
    |            | .AC-09 创建岗位表（sys_post）                            |      |          |      |
    |            | .AC-10 创建审计日志表（sys_audit_log）                   |      |          |      |
    | US-IAM-054 | 预置角色初始化                                           | 系统 | P1       | S    |
    |            | 作为系统，我想要初始化预置角色，以便租户开箱即用         |      |          |      |
    |            | .AC-01 创建"租户管理员"角色（tenant_admin）              |      |          |      |
    |            | .AC-02 创建"部门管理员"角色（dept_admin）                |      |          |      |
    |            | .AC-03 创建"普通用户"角色（normal_user）                 |      |          |      |
    |            | .AC-04 预置角色标记为系统角色，不可删除                  |      |          |      |
    | US-IAM-055 | 预置权限初始化                                           | 系统 | P1       | S    |
    |            | 作为系统，我想要初始化预置权限，以便支撑权限分配         |      |          |      |
    |            | .AC-01 初始化菜单权限数据                                |      |          |      |
    |            | .AC-02 初始化按钮权限数据                                |      |          |      |
    |            | .AC-03 建立菜单与按钮的父子关系                          |      |          |      |
    |            | .AC-04 为租户管理员角色分配全部权限                      |      |          |      |
    |            | .AC-05 为普通用户角色分配基础权限                        |      |          |      |
    | US-IAM-056 | 租户管理员创建                                           | 系统 | P1       | S    |
    |            | 作为系统，我想要创建租户管理员账号，以便租户可以登录管理 |      |          |      |
    |            | .AC-01 使用租户申请时提供的管理员信息创建账号            |      |          |      |
    |            | .AC-02 为管理员账号分配"租户管理员"角色                  |      |          |      |
    |            | .AC-03 生成随机初始密码                                  |      |          |      |
    |            | .AC-04 设置首次登录需修改密码标记                        |      |          |      |
    |            | .AC-05 发送账号信息到管理员邮箱                          |      |          |      |
    | US-IAM-057 | 根部门初始化                                             | 系统 | P1       | XS   |
    |            | 作为系统，我想要创建租户根部门，以便建立组织架构基础     |      |          |      |
    |            | .AC-01 使用租户名称创建根部门                            |      |          |      |
    |            | .AC-02 根部门作为组织架构树的根节点                      |      |          |      |
    |            | .AC-03 租户管理员默认归属根部门                          |      |          |      |
    | US-IAM-058 | 初始化结果返回                                           | 系统 | P1       | XS   |
    |            | 作为系统，我想要返回初始化结果，以便BC-11更新租户状态    |      |          |      |
    |            | .AC-01 初始化成功返回成功状态                            |      |          |      |
    |            | .AC-02 初始化失败返回失败原因                            |      |          |      |
    |            | .AC-03 返回租户管理员账号信息                            |      |          |      |
    |            | .AC-04 记录初始化日志                                    |      |          |      |

    表 4.6.1-2 FT-IAM-12 User Story清单

### 4.6.2 FT-IAM-16 系统配置管理

+   Feature定义如下表所示

    | 属性        | 内容                                   |
    | ----------- | -------------------------------------- |
    | Feature编号 | FT-IAM-16                              |
    | Feature名称 | 系统配置管理                           |
    | 所属Epic    | EP-37 平台用户管理                     |
    | Feature描述 | 管理平台级和租户级的系统配置参数       |
    | 业务价值    | 支持个性化配置，满足不同租户差异化需求 |
    | 目标版本    | P1                                     |

    表 4.6.2-1 FT-IAM-16定义

+   User Story清单及验收标准如下表所示

    | Story编号  | User Story                                                 | 角色  | 目标版本 | 规模 |
    | ---------- | ---------------------------------------------------------- | ----- | -------- | ---- |
    | US-IAM-059 | 平台配置管理                                               | UP-09 | P1       | M    |
    |            | 作为平台管理员，我想要管理平台级配置，以便控制全局默认行为 |       |          |      |
    |            | .AC-01 能查看所有平台级配置项                              |       |          |      |
    |            | .AC-02 能按分类筛选配置项（认证/安全/功能/审计）           |       |          |      |
    |            | .AC-03 能修改配置项的值                                    |       |          |      |
    |            | .AC-04 修改后立即生效（热更新）                            |       |          |      |
    |            | .AC-05 显示配置项的说明和默认值                            |       |          |      |
    |            | .AC-06 对于有最低要求的配置项，显示租户可覆盖的最低值      |       |          |      |
    | US-IAM-060 | 租户配置管理                                               | UR-10 | P1       | M    |
    |            | 作为租户管理员，我想要管理租户级配置，以便定制本租户行为   |       |          |      |
    |            | .AC-01 能查看本租户可配置的配置项                          |       |          |      |
    |            | .AC-02 能按分类筛选配置项                                  |       |          |      |
    |            | .AC-03 显示平台默认值和当前租户值                          |       |          |      |
    |            | .AC-04 能修改配置项的值（受平台最低要求限制）              |       |          |      |
    |            | .AC-05 修改后立即生效                                      |       |          |      |
    |            | .AC-06 能重置为平台默认值                                  |       |          |      |
    | US-IAM-061 | 配置热更新                                                 | 系统  | P1       | S    |
    |            | 作为系统，我想要支持配置热更新，以便配置修改无需重启服务   |       |          |      |
    |            | .AC-01 配置保存后自动更新内存缓存                          |       |          |      |
    |            | .AC-02 多实例部署时通过消息广播同步配置                    |       |          |      |
    |            | .AC-03 配置读取优先从缓存获取                              |       |          |      |
    |            | .AC-04 缓存失效时从数据库重新加载                          |       |          |      |
    | US-IAM-062 | 配置变更审计                                               | 系统  | P1       | S    |
    |            | 作为系统，我想要记录配置变更，以便支持配置审计和问题追溯   |       |          |      |
    |            | .AC-01 记录配置变更的操作人、时间、配置项                  |       |          |      |
    |            | .AC-02 记录变更前的值和变更后的值                          |       |          |      |
    |            | .AC-03 配置变更日志纳入审计日志管理                        |       |          |      |
    |            | .AC-04 支持按配置项查询变更历史                            |       |          |      |

    表 4.6.2-2 FT-IAM-16 User Story清单

## 4.7 需求统计汇总

+   BC-10需求统计汇总如下表所示

    | 统计维度       | 数量    |
    | -------------- | ------- |
    | 功能模块总数   | 5       |
    | Feature总数    | 13      |
    | User Story总数 | 62      |
    | P1版本Story    | 58      |
    | P2版本Story    | 3       |
    | P3版本Story    | 1       |
    | 验收标准总数   | 约340条 |

    表 4.7-1 BC-10需求统计汇总

+   按模块的Story分布如下表所示

    | 功能模块 | Feature数 | Story数 | P1     | P2    | P3    |
    | -------- | --------- | ------- | ------ | ----- | ----- |
    | 认证管理 | 3         | 13      | 11     | 2     | 0     |
    | 用户管理 | 5         | 24      | 23     | 0     | 1     |
    | 授权管理 | 2         | 10      | 9      | 1     | 0     |
    | 审计管理 | 1         | 5       | 5      | 0     | 0     |
    | 系统场景 | 2         | 10      | 10     | 0     | 0     |
    | **合计** | **13**    | **62**  | **58** | **3** | **1** |

    表 4.7-2 模块的Story分布

+   按Feature的Story分布如下表所示

    | 功能模块 | Feature   | Feature名称     | Story数 | P1     | P2    | P3    |
    | -------- | --------- | --------------- | ------- | ------ | ----- | ----- |
    | 认证管理 | FT-IAM-02 | 登录认证        | 5       | 3      | 2     | 0     |
    | 认证管理 | FT-IAM-03 | 密码管理        | 4       | 4      | 0     | 0     |
    | 认证管理 | FT-IAM-04 | 会话与Token管理 | 4       | 4      | 0     | 0     |
    | 用户管理 | FT-IAM-01 | 用户注册与激活  | 4       | 3      | 0     | 1     |
    | 用户管理 | FT-IAM-05 | 平台用户管理    | 5       | 5      | 0     | 0     |
    | 用户管理 | FT-IAM-06 | 租户用户管理    | 6       | 6      | 0     | 0     |
    | 用户管理 | FT-IAM-07 | 个人用户管理    | 3       | 3      | 0     | 0     |
    | 用户管理 | FT-IAM-08 | 组织架构管理    | 6       | 6      | 0     | 0     |
    | 授权管理 | FT-IAM-09 | 角色管理        | 5       | 5      | 0     | 0     |
    | 授权管理 | FT-IAM-10 | 权限配置        | 5       | 4      | 1     | 0     |
    | 审计管理 | FT-IAM-11 | 审计日志        | 5       | 5      | 0     | 0     |
    | 系统场景 | FT-IAM-12 | 租户IAM初始化   | 6       | 6      | 0     | 0     |
    | 系统场景 | FT-IAM-16 | 系统配置管理    | 4       | 4      | 0     | 0     |
    | **合计** | -         | -               | **62**  | **58** | **3** | **1** |

    表 4.7-3 Feature的Story分布

# 5 业务规则汇总

## 5.1 校验规则

+   BC-10校验规则汇总如下表所示

    | 规则编号   | 规则名称         | 规则描述                                     | 关联Story          | 校验时机     |
    | ---------- | ---------------- | -------------------------------------------- | ------------------ | ------------ |
    | BR-IAM-001 | 手机号格式校验   | 手机号必须为11位数字，以1开头                | US-IAM-001/005/023 | 提交时       |
    | BR-IAM-002 | 邮箱格式校验     | 邮箱必须符合标准邮箱格式（xxx@xxx.xxx）      | US-IAM-002/005/023 | 提交时       |
    | BR-IAM-003 | 密码复杂度校验   | 密码8-20位，必须包含大写字母、小写字母和数字 | US-IAM-001/010/011 | 提交时       |
    | BR-IAM-004 | 密码历史校验     | 新密码不能与近5次使用过的密码相同            | US-IAM-010/011     | 修改密码时   |
    | BR-IAM-005 | 验证码格式校验   | 验证码必须为6位数字                          | US-IAM-001/007/011 | 提交时       |
    | BR-IAM-006 | 用户名唯一性校验 | 用户名在对应范围内（平台/租户/UC）必须唯一   | US-IAM-018/023     | 创建用户时   |
    | BR-IAM-007 | 手机号唯一性校验 | 手机号在对应范围内必须唯一                   | US-IAM-001/018/023 | 创建/编辑时  |
    | BR-IAM-008 | 邮箱唯一性校验   | 邮箱在对应范围内必须唯一                     | US-IAM-002/018/023 | 创建/编辑时  |
    | BR-IAM-009 | 角色编码校验     | 角色编码只能包含英文字母、数字和下划线       | US-IAM-038         | 创建角色时   |
    | BR-IAM-010 | 部门名称唯一性   | 同一父部门下部门名称必须唯一                 | US-IAM-032         | 创建部门时   |
    | BR-IAM-011 | 岗位名称唯一性   | 租户内岗位名称必须唯一                       | US-IAM-035         | 创建岗位时   |
    | BR-IAM-012 | 租户代号格式校验 | 租户代号4-20位，只能包含小写字母和数字       | US-IAM-053         | 租户初始化时 |

    表 5.1-1 校验规则汇总

## 5.2 计算规则

+   BC-10计算规则汇总如下表所示

    | 规则编号   | 规则名称           | 规则描述                                        | 关联Story      | 触发时机     |
    | ---------- | ------------------ | ----------------------------------------------- | -------------- | ------------ |
    | BR-IAM-013 | Token有效期计算    | Access Token有效期2小时，Refresh Token有效期7天 | US-IAM-014     | 登录成功时   |
    | BR-IAM-014 | 记住我Token计算    | 勾选"记住我"时，Refresh Token有效期延长至30天   | US-IAM-005     | 登录成功时   |
    | BR-IAM-015 | 密码过期时间计算   | 密码有效期从修改日开始计算，默认90天            | US-IAM-013     | 密码修改时   |
    | BR-IAM-016 | 账号锁定时间计算   | 连续登录失败5次后锁定15分钟                     | US-IAM-005     | 登录失败时   |
    | BR-IAM-017 | 验证码有效期计算   | 验证码有效期5分钟，从发送时开始计算             | US-IAM-001/007 | 发送验证码时 |
    | BR-IAM-018 | 激活链接有效期计算 | 激活链接有效期24小时，从发送时开始计算          | US-IAM-004     | 注册成功时   |
    | BR-IAM-019 | 注销审核期计算     | 注销审核期7天，从申请日开始计算                 | US-IAM-031     | 申请注销时   |
    | BR-IAM-020 | 用户配额计算       | 租户用户数 = 正常状态用户数 + 禁用状态用户数    | US-IAM-023/024 | 创建用户时   |
    | BR-IAM-021 | 配置优先级计算     | 租户配置 > 平台配置 > 系统默认值                | US-IAM-059/060 | 配置读取时   |

    表 5.2-1 计算规则汇总

## 5.3 流程规则

+   BC-10流程规则汇总如下表所示

    | 规则编号   | 规则名称         | 规则描述                                             | 关联Story      | 触发时机    |
    | ---------- | ---------------- | ---------------------------------------------------- | -------------- | ----------- |
    | BR-IAM-021 | 首次登录强制改密 | 首次登录或管理员重置密码后，必须修改密码才能继续使用 | US-IAM-012     | 登录时      |
    | BR-IAM-022 | 密码过期强制改密 | 密码过期后登录时，必须修改密码才能继续使用           | US-IAM-013     | 登录时      |
    | BR-IAM-023 | 登录失败锁定流程 | 连续失败5次锁定，锁定期间禁止登录，15分钟后自动解锁  | US-IAM-005     | 登录失败时  |
    | BR-IAM-024 | 会话并发控制     | 同一账号同时在线设备数不超过5个，超出时踢出最早会话  | US-IAM-014     | 登录成功时  |
    | BR-IAM-025 | 密码重置会话失效 | 密码修改或重置后，该用户所有会话立即失效             | US-IAM-010/011 | 密码变更时  |
    | BR-IAM-026 | 用户禁用会话失效 | 用户被禁用后，该用户所有会话立即失效                 | US-IAM-020/026 | 禁用用户时  |
    | BR-IAM-027 | 部门删除前置检查 | 删除部门前必须确保无子部门且无关联用户               | US-IAM-034     | 删除部门时  |
    | BR-IAM-028 | 角色删除前置检查 | 删除角色前必须确保无关联用户                         | US-IAM-040     | 删除角色时  |
    | BR-IAM-029 | 预置数据保护     | 预置角色和预置权限不允许修改编码和删除               | US-IAM-039/040 | 编辑/删除时 |
    | BR-IAM-030 | 权限变更即时生效 | 角色权限变更后，拥有该角色的用户权限立即生效         | US-IAM-043/044 | 权限保存时  |
    | BR-IAM-031 | 配置优先级规则   | 租户配置优先于平台配置，但不能低于平台最低要求       | US-IAM-059/060 | 配置读取时  |
    | BR-IAM-032 | 配置热更新规则   | 配置修改后立即更新缓存，多实例通过消息广播同步       | US-IAM-061     | 配置保存时  |
    | BR-IAM-033 | 配置审计规则     | 所有配置变更必须记录变更前后值，纳入审计日志         | US-IAM-062     | 配置变更时  |

    表 5.3-1 流程规则汇总

## 5.4 安全规则

+   BC-10安全规则汇总如下表所示

    | 规则编号   | 规则名称         | 规则描述                                           | 关联Story      | 触发时机     |
    | ---------- | ---------------- | -------------------------------------------------- | -------------- | ------------ |
    | BR-IAM-034 | 密码加密存储     | 密码使用BCrypt算法加密存储，不可逆                 | US-IAM-001/010 | 密码保存时   |
    | BR-IAM-035 | 敏感信息脱敏     | 手机号、邮箱等敏感信息在展示时部分脱敏             | US-IAM-029     | 数据展示时   |
    | BR-IAM-036 | Token签名校验    | 所有Token请求必须校验签名有效性                    | US-IAM-014     | 请求时       |
    | BR-IAM-037 | 租户数据隔离     | 租户用户只能访问本租户数据，不能跨租户访问         | 所有租户Story  | 数据访问时   |
    | BR-IAM-038 | 审计日志不可篡改 | 审计日志一旦写入，不允许修改和删除                 | US-IAM-052     | 日志写入后   |
    | BR-IAM-039 | 验证码防暴力破解 | 同一手机号/邮箱60秒内只能获取一次验证码            | US-IAM-001/007 | 获取验证码时 |
    | BR-IAM-040 | 登录IP记录       | 每次登录必须记录客户端IP地址                       | US-IAM-005     | 登录时       |
    | BR-IAM-041 | 异常登录检测     | 检测异地登录、频繁登录失败等异常行为并记录安全事件 | US-IAM-050     | 登录时       |

    表 5.4-1 安全规则汇总

# 6 非功能需求

## 6.1 性能需求

+   BC-10性能需求如下表所示

    | 需求项         | 具体指标                  | 验收方式 | 优先级 |
    | -------------- | ------------------------- | -------- | ------ |
    | 登录响应时间   | 登录接口响应时间 ≤ 500ms  | 性能测试 | P0     |
    | Token校验时间  | Token校验时间 ≤ 50ms      | 性能测试 | P0     |
    | 用户列表查询   | 1000条数据分页查询 ≤ 1秒  | 性能测试 | P1     |
    | 权限树加载     | 权限树加载时间 ≤ 500ms    | 性能测试 | P1     |
    | 组织架构树加载 | 500个部门组织树加载 ≤ 1秒 | 性能测试 | P1     |
    | 审计日志查询   | 100万条日志范围查询 ≤ 2秒 | 性能测试 | P1     |
    | 并发登录支持   | 支持1000用户同时登录      | 压力测试 | P1     |
    | Token刷新      | Token刷新接口响应 ≤ 200ms | 性能测试 | P1     |

    表 6.1-1 性能需求

## 6.2 安全需求

+   BC-10安全需求如下表所示

    | 需求项       | 具体指标                         | 验收方式 | 优先级 |
    | ------------ | -------------------------------- | -------- | ------ |
    | 密码加密     | 使用BCrypt算法，cost factor ≥ 10 | 代码审查 | P0     |
    | Token安全    | 使用RS256签名，密钥定期轮换      | 安全测试 | P0     |
    | 传输加密     | 所有接口必须使用HTTPS            | 安全测试 | P0     |
    | SQL注入防护  | 所有数据库操作使用参数化查询     | 安全扫描 | P0     |
    | XSS防护      | 所有输出进行HTML编码             | 安全扫描 | P0     |
    | CSRF防护     | 关键操作接口增加CSRF Token校验   | 安全测试 | P1     |
    | 暴力破解防护 | 登录失败锁定机制                 | 功能测试 | P0     |
    | 会话安全     | 会话超时、并发控制、强制下线     | 功能测试 | P0     |
    | 敏感数据脱敏 | 手机号、邮箱展示时脱敏           | 功能测试 | P1     |
    | 审计日志完整 | 所有关键操作记录审计日志         | 功能测试 | P0     |

    表 6.2-1 安全需求

## 6.3 可用性需求

+   BC-10可用性需求如下表所示

    | 需求项       | 具体指标                     | 验收方式 | 优先级 |
    | ------------ | ---------------------------- | -------- | ------ |
    | 服务可用性   | IAM服务可用性 ≥ 99.9%        | 监控统计 | P0     |
    | 登录成功率   | 正常情况下登录成功率 ≥ 99.5% | 监控统计 | P0     |
    | 故障恢复时间 | 单点故障恢复时间 ≤ 5分钟     | 故障演练 | P1     |
    | 操作反馈     | 所有操作3秒内有明确反馈      | 功能测试 | P1     |
    | 错误提示     | 错误提示信息清晰、可操作     | 功能测试 | P1     |
    | 表单记忆     | 表单填写中断后可恢复         | 功能测试 | P2     |

    表 6.3-1 可用性需求

## 6.4 可扩展性需求

+   BC-10可扩展性需求如下表所示

    | 需求项     | 具体指标             | 验收方式 | 优先级 |
    | ---------- | -------------------- | -------- | ------ |
    | 用户规模   | 单租户支持10万用户   | 压力测试 | P1     |
    | 租户规模   | 平台支持1000+租户    | 架构评审 | P1     |
    | 角色规模   | 单租户支持1000+角色  | 功能测试 | P2     |
    | 部门层级   | 支持10级部门层级     | 功能测试 | P1     |
    | 权限项规模 | 支持10000+权限项     | 性能测试 | P2     |
    | 水平扩展   | 支持服务实例水平扩展 | 架构评审 | P1     |

    表 6.4-1 可扩展性需求

## 6.5 兼容性需求

+   BC-10兼容性需求如下表所示

    | 需求项       | 具体指标                            | 验收方式   | 优先级 |
    | ------------ | ----------------------------------- | ---------- | ------ |
    | 浏览器兼容   | Chrome/Firefox/Edge/Safari最新2版本 | 兼容性测试 | P1     |
    | 移动端兼容   | iOS 12+、Android 8+                 | 兼容性测试 | P1     |
    | SSO协议兼容  | 支持OAuth2.0、OIDC、SAML2.0         | 集成测试   | P2     |
    | LDAP协议兼容 | 支持LDAP v3、Active Directory       | 集成测试   | P2     |
    | API版本兼容  | API向后兼容，废弃接口保留2个版本    | 接口测试   | P1     |

    表 6.5-1 兼容性需求

# 7 版本规划与交付计划

## 7.1 版本Story分布

+   BC-10共58个User Story，按目标版本分布如下表所示

    | 目标版本 | Story数量 | 占比     | 版本定位                  |
    | -------- | --------- | -------- | ------------------------- |
    | P1       | 58        | 93.5%    | MVP核心功能               |
    | P2       | 3         | 4.8%     | 企业集成（SSO/LDAP/继承） |
    | P3       | 1         | 1.6%     | C端增强（社交登录）       |
    | P4       | 0         | 0%       | 预留（智能安全）          |
    | P5       | 0         | 0%       | 预留（合规审计增强）      |
    | P6       | 0         | 0%       | 预留（智能化IAM）         |
    | **合计** | **62**    | **100%** | -                         |

    表 7.1-1 版本Story分布

+   版本分布说明：
    -   P1版本承载93.1%的Story，为IAM基础能力建设
    -   P2-P3版本承载6.9%的Story，为能力增强
    -   P4-P6版本当前无Story，为未来演进预留

## 7.2 迭代规划

+   BC-10迭代规划覆盖P1-P6六个版本
+   各版本交付内容如下表所示

    | 版本 | 版本号 | 交付Feature/Story                               | Story数 | 关键里程碑       |
    | ---- | ------ | ----------------------------------------------- | ------- | ---------------- |
    | P1   | 1.0    | 12个Feature基础能力（除SSO/LDAP/社交登录/继承） | 54      | IAM基础能力上线  |
    | P2   | 1.2    | FT-IAM-02补充SSO/LDAP、FT-IAM-10补充权限继承    | 3       | 企业集成能力上线 |
    | P3   | 1.4    | FT-IAM-01补充社交登录                           | 1       | C端体验增强      |
    | P4   | 1.6    | 新增FT-IAM-13 自适应认证（规划中）              | 待定    | 智能安全能力     |
    | P5   | 1.8    | 新增FT-IAM-14 高级审计分析（规划中）            | 待定    | 合规审计增强     |
    | P6   | 2.0    | 新增FT-IAM-15 AI辅助权限（规划中）              | 待定    | 智能化IAM        |

    表 7.2-1 迭代规划

+   迭代规划说明：
    -   P1-P3版本的Story已在本文档详细定义
    -   P4-P6版本为远期规划，Story将在后续版本迭代中细化
    -   各版本交付内容可能根据业务需求调整

## 7.3 版本交付清单

### 7.3.1 P1版本交付清单

+   P1版本是BC-10的MVP版本，交付IAM基础能力
+   P1版本交付的Feature和Story如下表所示

    | 功能模块 | Feature   | Feature名称     | P1 Story数 | P1 Story编号                        |
    | -------- | --------- | --------------- | ---------- | ----------------------------------- |
    | 认证管理 | FT-IAM-02 | 登录认证        | 3          | US-IAM-005, 006, 007                |
    | 认证管理 | FT-IAM-03 | 密码管理        | 4          | US-IAM-010, 011, 012, 013           |
    | 认证管理 | FT-IAM-04 | 会话与Token管理 | 4          | US-IAM-014, 015, 016, 017           |
    | 用户管理 | FT-IAM-01 | 用户注册与激活  | 3          | US-IAM-001, 002, 004                |
    | 用户管理 | FT-IAM-05 | 平台用户管理    | 5          | US-IAM-018, 019, 020, 021, 022      |
    | 用户管理 | FT-IAM-06 | 租户用户管理    | 6          | US-IAM-023, 024, 025, 026, 027, 028 |
    | 用户管理 | FT-IAM-07 | 个人用户管理    | 3          | US-IAM-029, 030, 031                |
    | 用户管理 | FT-IAM-08 | 组织架构管理    | 6          | US-IAM-032, 033, 034, 035, 036, 037 |
    | 授权管理 | FT-IAM-09 | 角色管理        | 5          | US-IAM-038, 039, 040, 041, 042      |
    | 授权管理 | FT-IAM-10 | 权限配置        | 4          | US-IAM-043, 044, 045, 046           |
    | 审计管理 | FT-IAM-11 | 审计日志        | 5          | US-IAM-048, 049, 050, 051, 052      |
    | 系统场景 | FT-IAM-12 | 租户IAM初始化   | 6          | US-IAM-053, 054, 055, 056, 057, 058 |
    | 系统场景 | FT-IAM-16 | 系统配置管理    | 4          | US-IAM-059, 060, 061, 062           |
    | **合计** | **13**    | -               | **58**     | -                                   |

    表 7.3.1-1 P1版本交付清单

+   P1版本验收标准：
    -   用户能够通过账号密码、手机验证码登录系统
    -   管理员能够管理平台用户、租户用户的生命周期
    -   管理员能够配置角色和权限
    -   租户能够维护组织架构（部门、岗位）
    -   系统能够记录和查询审计日志
    -   BC-11能够调用IAM初始化接口完成租户开通
    -   平台管理员能够管理平台级系统配置
    -   租户管理员能够管理租户级系统配置
    -   配置修改后能够立即生效（热更新）

### 7.3.2 P2版本交付清单

+   P2版本交付企业集成能力
+   P2版本交付的Story如下表所示

    | 功能模块 | Feature   | Feature名称 | Story编号  | Story名称    |
    | -------- | --------- | ----------- | ---------- | ------------ |
    | 认证管理 | FT-IAM-02 | 登录认证    | US-IAM-008 | SSO单点登录  |
    | 认证管理 | FT-IAM-02 | 登录认证    | US-IAM-009 | LDAP认证登录 |
    | 授权管理 | FT-IAM-10 | 权限配置    | US-IAM-047 | 权限继承配置 |
    | **合计** | **2**     | -           | **3**      | -            |

    表 7.3.2-1 P2版本交付清单

+   P2版本验收标准：
    -   租户能够配置SSO集成，用户通过企业IdP登录
    -   租户能够配置LDAP集成，用户通过AD域账号登录
    -   管理员能够配置角色继承关系

### 7.3.3 P3版本交付清单

+   P3版本交付C端体验增强能力
+   P3版本交付的Story如下表所示

    | 功能模块 | Feature   | Feature名称    | Story编号  | Story名称    |
    | -------- | --------- | -------------- | ---------- | ------------ |
    | 用户管理 | FT-IAM-01 | 用户注册与激活 | US-IAM-003 | 社交账号注册 |
    | **合计** | **1**     | -              | **1**      | -            |

    表 7.3.3-1 P3版本交付清单

+   P3版本验收标准：
    -   C端用户能够通过微信扫码注册和登录

### 7.3.4 P4-P6版本规划

+   P4-P6版本为远期规划，能力范围如下表所示

    | 版本 | 规划Feature | 能力描述                       | 状态   |
    | ---- | ----------- | ------------------------------ | ------ |
    | P4   | FT-IAM-13   | 自适应认证：风险感知、行为分析 | 规划中 |
    | P5   | FT-IAM-14   | 高级审计：合规报告、细粒度审计 | 规划中 |
    | P6   | FT-IAM-15   | AI辅助：权限推荐、异常预警     | 规划中 |

    表 7.3.4-1 P4-P6版本规划

+   P4-P6版本说明：
    -   具体Story将在P3版本交付后细化
    -   规划内容可能根据市场需求和技术演进调整

## 7.4 依赖关系

+   BC-10与其他BC的依赖关系如下表所示

    | 依赖类型 | 依赖BC         | 依赖内容                    | 依赖方向    | 集成方式 | 目标版本 |
    | -------- | -------------- | --------------------------- | ----------- | -------- | -------- |
    | 上游依赖 | BC-11 租户管理 | 租户开通时调用IAM初始化接口 | BC-11→BC-10 | 同步API  | P1       |
    | 下游依赖 | BC-13 租户落地 | 获取组织架构数据            | BC-10→BC-13 | 同步API  | P1       |
    | 下游依赖 | 所有业务BC     | 认证服务（Token校验）       | BC-10→All   | 同步API  | P1       |
    | 下游依赖 | 所有业务BC     | 授权服务（权限查询）        | BC-10→All   | 同步API  | P1       |
    | 下游依赖 | 所有业务BC     | 用户信息查询服务            | BC-10→All   | 同步API  | P1       |

    表 7.4-1 BC依赖关系

+   依赖关系说明：
    -   BC-10作为通用域BC，通过OHS模式向所有业务BC提供服务
    -   所有依赖关系在P1版本建立，后续版本保持稳定

    表 7.4-1 BC依赖关系

+   BC-10内部Feature依赖关系如下图所示

    ```graph
    ┌────────────────────────────────────────────────────────────────────────────────┐
    │                       BC-10 Feature依赖关系                                    │
    ├────────────────────────────────────────────────────────────────────────────────┤
    │                                                                                │
    │  ┌─────────────────────────────────────────────────────────────────────────┐   │
    │  │                          基础层（无依赖）                               │   │
    │  │  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐             │   │
    │  │  │ FT-IAM-12      │  │ FT-IAM-08      │  │ FT-IAM-11      │             │   │
    │  │  │ 租户IAM初始化  │  │ 组织架构管理   │  │ 审计日志       │             │   │
    │  │  └───────┬────────┘  └───────┬────────┘  └────────────────┘             │   │
    │  └──────────┼───────────────────┼──────────────────────────────────────────┘   │
    │             │                   │                                              │
    │             ▼                   ▼                                              │
    │  ┌─────────────────────────────────────────────────────────────────────────┐   │
    │  │                          核心层（依赖基础层）                           │   │
    │  │  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐             │   │
    │  │  │ FT-IAM-09      │  │ FT-IAM-05/06/07│  │ FT-IAM-01      │             │   │
    │  │  │ 角色管理       │  │ 用户管理       │  │ 用户注册       │             │   │
    │  │  └───────┬────────┘  └───────┬────────┘  └───────┬────────┘             │   │
    │  └──────────┼───────────────────┼───────────────────┼──────────────────────┘   │
    │             │                   │                   │                          │
    │             ▼                   ▼                   ▼                          │
    │  ┌─────────────────────────────────────────────────────────────────────────┐   │
    │  │                          应用层（依赖核心层）                           │   │
    │  │  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐             │   │
    │  │  │ FT-IAM-10      │  │ FT-IAM-02      │  │ FT-IAM-03/04   │             │   │
    │  │  │ 权限配置       │  │ 登录认证       │  │ 密码/会话管理  │             │   │
    │  │  └────────────────┘  └────────────────┘  └────────────────┘             │   │
    │  └─────────────────────────────────────────────────────────────────────────┘   │
    │                                                                                │
    │  依赖方向：基础层 ← 核心层 ← 应用层                                            │
    │                                                                                │
    └────────────────────────────────────────────────────────────────────────────────┘
    ```

    图 7.4-1 BC-10 Feature依赖关系

# 附录

## 附录A 术语表

+   BC-10相关术语定义如下表所示

    | 术语     | 英文                                  | 定义                           |
    | -------- | ------------------------------------- | ------------------------------ |
    | IAM      | Identity and Access Management        | 身份与访问管理                 |
    | 认证     | Authentication                        | 验证用户身份的过程             |
    | 授权     | Authorization                         | 确定用户可访问资源的过程       |
    | RBAC     | Role-Based Access Control             | 基于角色的访问控制             |
    | ABAC     | Attribute-Based Access Control        | 基于属性的访问控制             |
    | SSO      | Single Sign-On                        | 单点登录                       |
    | MFA      | Multi-Factor Authentication           | 多因素认证                     |
    | Token    | -                                     | 访问令牌，用于标识用户身份     |
    | JWT      | JSON Web Token                        | 一种开放标准的Token格式        |
    | LDAP     | Lightweight Directory Access Protocol | 轻量目录访问协议               |
    | OIDC     | OpenID Connect                        | 基于OAuth2.0的身份认证协议     |
    | OAuth2.0 | -                                     | 开放授权协议                   |
    | SAML     | Security Assertion Markup Language    | 安全断言标记语言               |
    | UP       | User Pool - Platform                  | 平台运营用户群                 |
    | UR       | User Pool - Tenant                    | 租户用户群                     |
    | UC       | User Pool - Consumer                  | C端消费者用户群                |
    | 会话     | Session                               | 用户登录后的状态保持           |
    | 数据权限 | Data Permission                       | 控制用户可访问的数据范围       |
    | 功能权限 | Function Permission                   | 控制用户可访问的功能菜单和按钮 |

    表 A-1 术语表

## 附录B 接口清单

+   BC-10对外提供的核心接口清单如下表所示

    | 接口编号    | 接口名称         | 接口路径                 | 方法 | 调用方      |
    | ----------- | ---------------- | ------------------------ | ---- | ----------- |
    | API-IAM-001 | 用户登录         | /api/auth/login          | POST | 所有前端    |
    | API-IAM-002 | 用户登出         | /api/auth/logout         | POST | 所有前端    |
    | API-IAM-003 | Token刷新        | /api/auth/refresh        | POST | 所有前端    |
    | API-IAM-004 | 获取当前用户信息 | /api/auth/userinfo       | GET  | 所有前端    |
    | API-IAM-005 | 获取用户权限     | /api/auth/permissions    | GET  | 所有前端    |
    | API-IAM-006 | Token校验        | /api/auth/verify         | POST | 网关/其他BC |
    | API-IAM-007 | 租户IAM初始化    | /api/iam/tenant/init     | POST | BC-11       |
    | API-IAM-008 | 获取组织架构     | /api/iam/org/tree        | GET  | BC-13       |
    | API-IAM-009 | 获取部门用户     | /api/iam/dept/{id}/users | GET  | BC-13       |
    | API-IAM-010 | 获取岗位列表     | /api/iam/posts           | GET  | BC-13       |
    | API-IAM-011 | 用户信息查询     | /api/iam/users/{id}      | GET  | 所有BC      |
    | API-IAM-012 | 批量用户信息查询 | /api/iam/users/batch     | POST | 所有BC      |

    表 B-1 接口清单

## 附录C 数据实体

+   BC-10核心数据实体如下表所示

    | 实体名称     | 表名                 | 存储位置      | 说明                          |
    | ------------ | -------------------- | ------------- | ----------------------------- |
    | 用户         | iam_user             | 按用户群分库  | 存储用户基本信息              |
    | 角色         | iam_role             | 平台库+租户库 | 预置角色平台库，自定义租户库  |
    | 权限         | iam_permission       | 平台库        | 存储菜单、按钮、API权限       |
    | 用户角色关联 | iam_user_role        | 按用户群分库  | 用户与角色的多对多关联        |
    | 角色权限关联 | iam_role_permission  | 平台库+租户库 | 预置角色平台库，自定义租户库  |
    | 部门         | iam_department       | 租户库        | 存储部门信息，支持树形结构    |
    | 岗位         | iam_position         | 租户库        | 存储岗位定义                  |
    | 人员         | iam_person           | 租户库        | 存储组织成员信息              |
    | 任职         | iam_employment       | 租户库        | 人员与岗位的关联（主岗/兼岗） |
    | 登录日志     | iam_login_log        | 按用户群分库  | 存储用户登录日志              |
    | 操作日志     | iam_operation_log    | 按用户群分库  | 存储用户操作日志              |
    | 安全事件     | iam_security_event   | 按用户群分库  | 存储安全事件记录              |
    | 密码历史     | iam_password_history | 按用户群分库  | 存储用户密码修改历史          |
    | Token黑名单  | iam_token_blacklist  | 平台库        | 存储已失效的Token（全局）     |
    | 系统配置     | iam_system_config    | 平台库        | 存储平台级系统配置            |
    | 租户配置     | iam_tenant_config    | 租户库        | 存储租户级配置覆盖            |
    | LDAP配置     | iam_ldap_config      | 租户库        | 存储租户LDAP连接配置          |

    表 C-1 数据实体清单

+   数据实体存储位置说明：
    -   **平台库**：clarisphere_platform，存储全局共享数据
    -   **租户库**：clarisphere_<tenant_code>，每个租户独立数据库
    -   **C端库**：clarisphere_consumer，存储个人用户数据
    -   **按用户群分库**：UP→平台库，UR→租户库，UC→C端库

## 附录D 预置数据

### D.1 UP用户群预置角色

+   UP（运营用户群）预置角色如下表所示

    | 角色编码          | 角色名称   | 数据权限 | 功能权限范围         | 对应宏观角色 |
    | ----------------- | ---------- | -------- | -------------------- | ------------ |
    | platform_admin    | 平台管理员 | 全部     | 全部平台管理功能     | UP-08, UP-09 |
    | platform_operator | 平台运营员 | 全部     | 租户管理、用户管理   | UP-06        |
    | platform_auditor  | 平台审计员 | 全部     | 审计日志查询（只读） | -            |
    | content_admin     | 内容管理员 | 全部     | 内容生产管理功能     | UP-01~UP-05  |
    | ops_admin         | 运维管理员 | 全部     | 平台运维管理功能     | UP-07        |

    表 D.1-1 UP用户群预置角色

### D.2 UR用户群预置角色

+   UR（租户用户群）预置角色如下表所示

    | 角色编码       | 角色名称   | 数据权限     | 功能权限范围         | 对应宏观角色 |
    | -------------- | ---------- | ------------ | -------------------- | ------------ |
    | tenant_admin   | 租户管理员 | 全部数据     | 全部租户管理功能     | UR-10        |
    | dept_admin     | 部门管理员 | 本部门及下级 | 部门内用户、组织管理 | -            |
    | security_admin | 安全管理员 | 全部数据     | 审计日志、安全配置   | UR-01 (CISO) |
    | normal_user    | 普通用户   | 仅本人数据   | 基础业务功能         | UR-02~UR-09  |

    表 D.2-1 UR用户群预置角色

### D.3 UC用户群预置角色

+   UC（C端用户群）预置角色基于订阅级别自动分配，如下表所示

    | 角色编码      | 角色名称 | 对应订阅级别 | 功能权限范围           | 内容访问范围      |
    | ------------- | -------- | ------------ | ---------------------- | ----------------- |
    | uc_guest      | 访客     | GUEST        | 仅浏览公开内容         | 公开内容          |
    | uc_free       | 免费用户 | FREE         | 基础搜索、有限浏览     | 公开+部分免费内容 |
    | uc_basic      | 基础会员 | BASIC        | 标准搜索、下载配额     | 基础内容库        |
    | uc_premium    | 高级会员 | PREMIUM      | 高级搜索、更高下载配额 | 全部内容库        |
    | uc_enterprise | 企业会员 | ENTERPRISE   | 全功能、API访问        | 全部内容+API      |

    表 D.3-1 UC用户群预置角色

+   UC用户角色分配规则：
    -   **BR-UC-ROLE-01**：用户注册时默认分配uc_free角色
    -   **BR-UC-ROLE-02**：用户订阅升级时自动切换到对应角色
    -   **BR-UC-ROLE-03**：订阅到期后自动降级到uc_free角色
    -   **BR-UC-ROLE-04**：UC用户角色不支持手动分配，仅由订阅状态决定

## 附录E 检查清单

+   BC-10详细需求检查清单如下表所示

    | 序号 | 检查项       | 检查内容                      | 检查结果 |
    | ---- | ------------ | ----------------------------- | -------- |
    | 1    | Epic覆盖     | 是否覆盖EP-37所有能力         | ✓        |
    | 2    | 场景覆盖     | 是否覆盖16个业务场景          | ✓        |
    | 3    | 场景来源     | 场景是否有明确的需求来源追溯  | ✓        |
    | 4    | 模块分组     | 场景和Feature是否按模块分组   | ✓        |
    | 5    | Feature完整  | 14个Feature是否可独立交付     | ✓        |
    | 6    | INVEST原则   | 68个Story是否满足INVEST原则   | ✓        |
    | 7    | AC可测试     | 约380条AC是否可测试           | ✓        |
    | 8    | 业务规则完整 | 50+条业务规则是否完整         | ✓        |
    | 9    | 规则关联     | 业务规则是否关联到Story       | ✓        |
    | 10   | 版本规划     | 是否覆盖P1-P6全部版本         | ✓        |
    | 11   | 版本归属     | 每个Story是否有明确的目标版本 | ✓        |
    | 12   | 规模合理     | 是否无XL级Story               | ✓        |
    | 13   | 边界清晰     | 是否无越界需求                | ✓        |
    | 14   | 非功能细化   | 非功能需求是否有具体指标      | ✓        |
    | 15   | 格式规范     | 是否符合《格式规范》要求      | ✓        |
    | 16   | 用户类型完整 | 5种用户类型是否定义完整       | ✓        |
    | 17   | 状态机完整   | 用户状态机是否定义完整        | ✓        |
    | 18   | 组织概念完整 | 部门/岗位/人员/任职是否定义   | ✓        |

    表 E-1 详细需求检查清单

+   检查清单说明：
    -   第3项"场景来源"：验证场景与宏观需求的追溯关系
    -   第4项"模块分组"：验证按认证/用户/授权/审计/系统五模块组织
    -   第10项"版本规划"：验证覆盖P1-P6完整版本路线图
    -   第11项"版本归属"：验证不再使用优先级概念，仅使用目标版本
